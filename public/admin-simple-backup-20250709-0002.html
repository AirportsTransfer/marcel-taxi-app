<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcel's Taxi - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .admin-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #2c3e50;
            color: white;
            padding: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #2c3e50;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            border-bottom: 1px solid #34495e;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #34495e;
            color: white;
        }

        .nav-submenu {
            background: #1a252f;
            display: none;
        }

        .nav-submenu.show {
            display: block;
        }

        .nav-submenu .nav-link {
            padding: 12px 20px 12px 52px;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            background: #f5f7fa;
        }

        .header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-area {
            padding: 30px;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-section.active {
            display: block;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .test-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #dee2e6;
        }

        /* Booking Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 22px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .edit-section {
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }

        .edit-section h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 10px;
        }

        .edit-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .edit-field {
            display: flex;
            flex-direction: column;
        }

        .edit-field label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .edit-field input,
        .edit-field select,
        .edit-field textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .edit-field input:focus,
        .edit-field select:focus,
        .edit-field textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .modal-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: #007bff;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #0056b3;
        }

        .modal-btn-success {
            background: #28a745;
            color: white;
        }

        .modal-btn-success:hover {
            background: #1e7e34;
        }

        .modal-btn-danger {
            background: #dc3545;
            color: white;
        }

        .modal-btn-danger:hover {
            background: #c82333;
        }

        .modal-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .modal-btn-secondary:hover {
            background: #545b62;
        }

        /* Status Dropdown */
        .status-dropdown {
            position: relative;
            display: inline-block;
        }

        .status-badge {
            background: #ffc107;
            color: #856404;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .status-badge.confirmed {
            background: #28a745;
            color: white;
        }

        .status-badge.confirmed:hover {
            background: #1e7e34;
        }

        .status-badge.cancelled {
            background: #dc3545;
            color: white;
        }

        .status-badge.cancelled:hover {
            background: #c82333;
        }

        .status-dropdown-menu {
            position: fixed;
            min-width: 180px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 99999;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-dropdown-menu.show {
            display: block;
        }

        .status-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-option:hover {
            background: #f8f9fa;
        }

        .status-option:first-child {
            border-radius: 6px 6px 0 0;
        }

        .status-option:last-child {
            border-radius: 0 0 6px 6px;
        }

        .status-option.current {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
        }

        .status-option .status-icon {
            width: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>🚗 Marcel's Taxi Pro</h2>
                <p>Professional Admin Panel</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('dispatch')">
                        🚨 Dispatch
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('bookings')">
                        📋 Bookings
                    </a>
                    <ul class="nav-submenu" id="bookings-menu">
                        <li><a class="nav-link" onclick="showSection('next-24h')">Next 24h</a></li>
                        <li><a class="nav-link" onclick="showSection('latest')">Latest</a></li>
                        <li><a class="nav-link" onclick="showSection('unconfirmed')">Unconfirmed</a></li>
                        <li><a class="nav-link" onclick="showSection('completed')">Completed</a></li>
                        <li><a class="nav-link" onclick="showSection('cancelled')">Cancelled</a></li>
                        <li><a class="nav-link" onclick="showSection('all-bookings')">All</a></li>
                        <li><a class="nav-link" onclick="showSection('trash')">Trash</a></li>
                        <li><a class="nav-link" onclick="showSection('calendar')">Calendar</a></li>
                        <li><a class="nav-link" onclick="showSection('add-new')">Add New</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('reports')">
                        📈 Reports
                    </a>
                    <ul class="nav-submenu" id="reports-menu">
                        <li><a class="nav-link" onclick="showSection('driver-report')">Driver Report</a></li>
                        <li><a class="nav-link" onclick="showSection('payment-report')">Payment Report</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('users')">
                        👥 Users
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('vehicle-manager')">
                        🚗 Vehicle Manager
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('feedback')">
                        💬 Feedback
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('settings')">
                        ⚙️ Settings
                    </a>
                    <ul class="nav-submenu" id="settings-menu">
                        <li><a class="nav-link" onclick="showSection('general')">⚙️ General Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('types-of-vehicles')">🚗 Types of Vehicles</a></li>
                        <li><a class="nav-link" onclick="showSection('payment-methods')">💳 Payment Methods</a></li>
                        <li><a class="nav-link" onclick="showSection('notifications')">🔔 Notifications</a></li>
                        <li><a class="nav-link" onclick="showSection('mail')">📧 Email Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('booking-settings')">📋 Booking Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('locations')">📍 Locations</a></li>
                        <li><a class="nav-link" onclick="showSection('services')">🎯 Services</a></li>
                        <li><a class="nav-link" onclick="showSection('users-settings')">👥 User Management</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('pricing')">
                        💰 Pricing
                    </a>
                    <ul class="nav-submenu" id="pricing-menu">
                        <li><a class="nav-link" onclick="showSection('deposit-payments')">Deposit Payments</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-time')">Distance & Time</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-modifier')">Distance Modifier</a></li>
                        <li><a class="nav-link" onclick="showSection('driver-income')">Driver Income</a></li>
                        <li><a class="nav-link" onclick="showSection('fixed-prices')">Fixed Prices</a></li>
                        <li><a class="nav-link" onclick="showSection('holiday-surcharge')">Holiday Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('item-surcharge')">Item Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('location-surcharge')">Location Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('night-surcharge')">Night Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('other-discounts')">Other Discounts</a></li>
                        <li><a class="nav-link" onclick="showSection('tax')">Tax</a></li>
                        <li><a class="nav-link" onclick="showSection('voucher-discounts')">Voucher Discounts</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('knowledge-base')">
                        📚 Knowledge Base
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('updates')">
                        🔄 Updates
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('profile')">
                        👤 Profile
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="logout()">
                        🚪 Sign Out
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Dispatch</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="window.open('/booking-exact.html', '_blank')">👀 View Booking System</button>
                </div>
            </div>

            <div class="content-area">

                <!-- Dispatch Section -->
                <div id="dispatch-section" class="content-section active">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #dc3545, #c82333); padding: 12px; border-radius: 12px; color: white;">
                            🚨
                        </div>
                        <div>
                            <h1 style="margin: 0; font-size: 36px; font-weight: 700; color: #2c3e50;">Dispatch Center</h1>
                            <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 18px;">Manual taxi booking and dispatch system</p>
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 40px; margin-bottom: 30px;">
                        <h2 style="font-size: 28px; font-weight: 600; color: #2c3e50; margin-bottom: 30px;">Booking Form</h2>
                        
                        <form id="dispatchBookingForm" style="display: grid; gap: 30px; max-width: 800px; margin: 0 auto;">
                            <!-- Trip Details Section -->
                            <div style="display: grid; gap: 25px;">
                                <!-- Pickup Location -->
                                <input type="text" id="dispatchPickup" placeholder="📍 Van waar..." 
                                       style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">

                                <!-- Extra Stops Container -->
                                <div id="dispatchExtraStopsContainer" style="display: grid; gap: 15px;">
                                    <!-- Extra stops will be added here dynamically -->
                                </div>

                                <!-- Add Extra Stop Button -->
                                <button type="button" onclick="addDispatchExtraStop()" 
                                        style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; 
                                               padding: 15px 25px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; 
                                               transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
                                               box-shadow: 0 4px 15px rgba(0,123,255,0.2); max-width: 200px;"
                                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(0,123,255,0.3)'"
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.2)'">
                                    ➕ Extra Stop
                                </button>

                                <!-- Destination -->
                                <input type="text" id="dispatchDestination" placeholder="📍 Naar waar..." 
                                       style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">

                                <!-- Date & Time -->
                                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 20px; align-items: center;">
                                    <!-- Date Picker -->
                                    <div style="position: relative;">
                                        <input type="text" id="dispatchDate" placeholder="📅 Kies datum" readonly
                                               style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                      cursor: pointer; transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                               onclick="toggleDispatchCalendar()"
                                               onmouseover="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                               onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        
                                        <!-- Calendar Popup -->
                                        <div id="dispatchCalendar" style="position: absolute; top: 100%; left: 0; z-index: 1000; background: white; border: 2px solid #e9ecef; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); padding: 25px; display: none; min-width: 350px;">
                                            <div style="text-align: center; margin-bottom: 20px;">
                                                <button type="button" onclick="changeDispatchMonth(-1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">←</button>
                                                <span id="dispatchCalendarTitle" style="font-weight: 700; margin: 0 25px; font-size: 18px; color: #2c3e50;">November 2023</span>
                                                <button type="button" onclick="changeDispatchMonth(1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">→</button>
                                            </div>
                                            <div id="dispatchCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center;">
                                                <!-- Calendar will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Hour Selector -->
                                    <select id="dispatchHour" style="padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                                      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="">⏰ Uur</option>
                                    </select>
                                    
                                    <!-- Minute Selector -->
                                    <select id="dispatchMinute" style="padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                                        background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="">⏰ Min</option>
                                    </select>
                                </div>

                                <!-- Return Trip Section -->
                                <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 12px; border: 2px solid #2196f3;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <button type="button" id="dispatchRetourBtn" onclick="toggleDispatchRetour()" 
                                                    style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none; 
                                                           padding: 12px 20px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; 
                                                           transition: all 0.3s; display: flex; align-items: center; gap: 8px;"
                                                    onmouseover="this.style.transform='scale(1.05)'"
                                                    onmouseout="this.style.transform='scale(1)'">
                                                🔄 Retour
                                            </button>
                                            <span style="font-weight: 600; color: #1976d2; font-size: 16px;">Return Trip?</span>
                                        </div>
                                        <span id="dispatchRetourStatus" style="color: #666; font-style: italic;">Not activated</span>
                                    </div>
                                    
                                    <!-- Return Details (Hidden by default) -->
                                    <div id="dispatchRetourDetails" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #2196f3;">
                                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center;">
                                            <!-- Return Date Picker -->
                                            <div style="position: relative;">
                                                <input type="text" id="dispatchReturnDate" placeholder="📅 Retour datum" readonly
                                                       style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                              cursor: pointer; transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                                       onclick="toggleDispatchReturnCalendar()"
                                                       onmouseover="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                       onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                
                                                <!-- Return Calendar Popup -->
                                                <div id="dispatchReturnCalendar" style="position: absolute; top: 100%; left: 0; z-index: 1000; background: white; border: 2px solid #e9ecef; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); padding: 25px; display: none; min-width: 350px;">
                                                    <div style="text-align: center; margin-bottom: 20px;">
                                                        <button type="button" onclick="changeDispatchReturnMonth(-1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">←</button>
                                                        <span id="dispatchReturnCalendarTitle" style="font-weight: 700; margin: 0 25px; font-size: 18px; color: #2c3e50;">November 2023</span>
                                                        <button type="button" onclick="changeDispatchReturnMonth(1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">→</button>
                                                    </div>
                                                    <div id="dispatchReturnCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center;">
                                                        <!-- Calendar will be populated by JavaScript -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Return Hour Selector -->
                                            <select id="dispatchReturnHour" style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                    background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                                    onfocus="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                    onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                <option value="">⏰ Uur</option>
                                            </select>
                                            
                                            <!-- Return Minute Selector -->
                                            <select id="dispatchReturnMinute" style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                                    onfocus="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                    onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                <option value="">⏰ Min</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Details Section -->
                            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; border: 1px solid #dee2e6;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                                    <input type="text" id="dispatchFirstName" placeholder="👤 First Name" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                    
                                    <input type="text" id="dispatchLastName" placeholder="👤 Last Name" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                                    <input type="email" id="dispatchEmail" placeholder="✉️ Email Address" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                    
                                    <input type="tel" id="dispatchPhone" placeholder="📞 Phone Number" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 25px;">
                                    <select id="dispatchPassengers" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                               background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="1">👥 1 Passenger</option>
                                        <option value="2">👥 2 Passengers</option>
                                        <option value="3">👥 3 Passengers</option>
                                        <option value="4">👥 4 Passengers</option>
                                        <option value="5">👥 5 Passengers</option>
                                        <option value="6">👥 6 Passengers</option>
                                        <option value="7">👥 7 Passengers</option>
                                        <option value="8">👥 8 Passengers</option>
                                    </select>
                                    
                                    <select id="dispatchVehicleType" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                              background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="saloon">🚗 Saloon</option>
                                        <option value="estate">🚙 Estate</option>
                                        <option value="minivan">🚐 Minivan</option>
                                        <option value="minivan_long">🚌 Minivan Long</option>
                                    </select>
                                    
                                    <select id="dispatchPaymentMethod" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="cash">💵 Cash</option>
                                        <option value="card">💳 Credit Card</option>
                                        <option value="paypal">🅿️ PayPal</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Create Booking Button -->
                            <button type="submit" onclick="createDispatchBooking(event)" 
                                    style="width: 100%; padding: 25px; background: linear-gradient(135deg, #28a745, #20c997); 
                                           color: white; border: none; border-radius: 15px; font-size: 20px; font-weight: 700; 
                                           cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 12px;
                                           box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3); text-transform: uppercase; letter-spacing: 1px;"
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 35px rgba(40, 167, 69, 0.4)'"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(40, 167, 69, 0.3)'">
                                📞 Create Booking
                            </button>
                        </form>
                    </div>

                    <!-- Status Display -->
                    <div id="dispatchStatus" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;"></div>
                </div>

                <!-- Settings Section -->
                <div id="general-section" class="content-section">
                    <h2>⚙️ General Settings</h2>
                    <p>Configure general system settings</p>
                </div>

                <div id="vehicle-manager-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>🚗 Vehicle Manager</h2>
                            <p>Complete vehicle fleet management and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openVehicleManagerModal()">
                            ➕ Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleManagerSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleManagerErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Image</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Name</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Description</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Capacity</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Hourly Rate</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Status</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleManagerTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Manager Modal -->
                <div id="vehicleManagerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleManagerModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleManagerModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleManagerForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Name *</label>
                                        <input type="text" id="vehicleManagerName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Driver</label>
                                        <select id="vehicleManagerDriver" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
                                            <option value="All">All Drivers</option>
                                            <option value="John Smith">John Smith</option>
                                            <option value="Mike Johnson">Mike Johnson</option>
                                            <option value="Sarah Wilson">Sarah Wilson</option>
                                        </select>
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Description</label>
                                    <textarea id="vehicleManagerDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service with premium comfort"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Passengers</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', -1)">-</button>
                                            <input type="number" id="vehicleManagerPassengers" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="4" min="1" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Luggage</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hand Luggage</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerHandLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hourly Rate (€)</label>
                                        <input type="number" id="vehicleManagerHourlyRate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="25" min="0" step="5">
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleManagerImageInput').click()">
                                        <img id="vehicleManagerImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleManagerUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                                            <div>Click to upload vehicle image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleManagerImageInput" accept="image/*" style="display: none;" onchange="handleVehicleManagerImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleManagerModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="types-of-vehicles-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>🚗 Types of Vehicles</h2>
                            <p>Manage your vehicle fleet and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openAddVehicleModal()">
                            ➕ Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Image</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Name</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Description</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Capacity</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Status</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Add/Edit Modal -->
                <div id="vehicleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleForm">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Name *</label>
                                    <input type="text" id="vehicleName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Description</label>
                                    <textarea id="vehicleDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Passengers</label>
                                        <input type="number" id="vehiclePassengers" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="4" min="1" max="20">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Luggage</label>
                                        <input type="number" id="vehicleLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hand Luggage</label>
                                        <input type="number" id="vehicleHandLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleImageInput').click()">
                                        <img id="vehicleImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                                            <div>Click to upload image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleImageInput" accept="image/*" style="display: none;" onchange="handleVehicleImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="mail-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ⚙️ Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">📧 Email Settings</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>Current Configuration</h3>
                        <div style="margin: 15px 0;">
                            <div><strong>Status:</strong> <span id="configStatus">Not configured</span></div>
                            <div><strong>SMTP Host:</strong> <span id="configHost">smtp.gmail.com</span></div>
                            <div><strong>From Email:</strong> <span id="configEmail">info@airporttransfer.be</span></div>
                        </div>
                    </div>

                    <form id="adminEmailSettingsForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">From name</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromName" value="Airport Transfer" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">From email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromEmail" value="info@airporttransfer.be" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Reply to email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminReplyToEmail" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Admin email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminAdminEmail" value="marceltataev@gmail.com" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Connection type</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminConnectionType">
                                    <option value="smtp">SMTP - Your mail server</option>
                                    <option value="sendmail">Sendmail</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Provider</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminProvider">
                                    <option value="gmail">Gmail</option>
                                    <option value="outlook">Outlook</option>
                                    <option value="yahoo">Yahoo</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP host</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpHost" value="smtp.gmail.com" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP port</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPort">
                                    <option value="587" selected>587</option>
                                    <option value="465">465</option>
                                    <option value="25">25</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP username</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpUsername" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP password</label>
                                <div style="position: relative;">
                                    <input type="password" style="width: 100%; padding: 12px; padding-right: 50px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPassword" placeholder="Enter your Gmail App Password" required>
                                    <button type="button" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px;" onclick="toggleAdminPassword()">👁</button>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP security</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="none"> None
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="ssl"> SSL
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="tls" checked> TLS
                                </label>
                            </div>
                        </div>

                        <div style="border-top: 1px solid #e1e5e9; padding-top: 20px; margin-top: 20px;">
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                                <div style="flex: 1;">
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Send a test email</label>
                                    <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminTestEmail" placeholder="Enter your email address">
                                </div>
                                <button type="button" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 32px;" onclick="sendAdminTestEmail()">Send</button>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                💾 Save Email Settings
                            </button>
                        </div>
                    </form>

                    <div id="adminEmailStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Bookings Sections -->
                <div id="next-24h-section" class="content-section">
                    <h2>📋 Next 24 Hours</h2>
                    <p>Confirmed bookings for the next 24 hours</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadNext24hBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📤 <span style="margin-left: 5px;">Export</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="next24hCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 confirmed</span>
                        </div>
                    </div>
                    
                    <div id="next24hBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="next24hTableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading confirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="latest-section" class="content-section">
                    <h2>📋 Latest Bookings</h2>
                    <p>Most recent booking requests</p>
                </div>

                <div id="unconfirmed-section" class="content-section">
                    <h2>📋 Unconfirmed Bookings</h2>
                    <p>New bookings awaiting confirmation</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <button style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;" onclick="window.location.href='booking-exact.html'">
                            ➕ Add new booking
                        </button>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadUnconfirmedBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📥 <span style="margin-left: 5px;">Import</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📤 <span style="margin-left: 5px;">Export</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <input type="text" placeholder="Filter / Search" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px; width: 200px;">
                            <select style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px;">
                                <option>🔄 Sync source</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="unconfirmedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">
                                        <input type="checkbox" style="margin-right: 8px;">Info
                                    </th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Payments</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status ⓘ</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle type</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver income ⓘ</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Passenger charge ⓘ</th>
                                </tr>
                            </thead>
                            <tbody id="unconfirmedTableBody">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading unconfirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pricing Sections -->
                <div id="distance-time-section" class="content-section">
                    <h2>💰 Distance & Time Pricing</h2>
                    <p>Configure pricing for each vehicle type - prices will be used in the booking system</p>
                    
                    <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="loadVehiclePricing()">🔄 Load Vehicle Pricing</button>
                        <button class="btn btn-success" onclick="saveAllPricing()">💾 Save All Changes</button>
                        <button class="btn" style="background: #6c757d; color: white;" onclick="resetToDefaults()">🔄 Reset to Defaults</button>
                    </div>
                    
                    <div id="vehiclePricingContainer" style="margin-top: 30px;">
                        <div style="text-align: center; padding: 40px; color: #6c757d; border: 2px dashed #dee2e6; border-radius: 8px;">
                            <h3>🚗 Loading vehicles from Types of Vehicles...</h3>
                            <p>Vehicle pricing cards will appear here automatically</p>
                        </div>
                    </div>
                </div>

                <div id="deposit-payments-section" class="content-section">
                    <h2>💰 Deposit Payments</h2>
                    <p>Configure security deposit settings</p>
                </div>

                <!-- Other sections -->
                <div id="cancelled-section" class="content-section">
                    <h2>❌ Cancelled Bookings</h2>
                    <p>Cancelled and deleted bookings</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCancelledBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCancelled()">
                                🗑️ <span style="margin-left: 5px;">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="cancelledCount" style="padding: 8px 12px; background: #dc3545; color: white; border-radius: 4px; font-weight: 500;">0 cancelled</span>
                        </div>
                    </div>
                    
                    <div id="cancelledBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Reason</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Cancelled Date</th>
                                </tr>
                            </thead>
                            <tbody id="cancelledTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading cancelled bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Bookings Section -->
                <div id="all-bookings-section" class="content-section">
                    <h2>📋 All Bookings</h2>
                    <p>Complete history of all bookings from customer and dispatch systems</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadAllBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <select id="allBookingsFilter" onchange="filterAllBookings()" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px;">
                                <option value="all">All Bookings</option>
                                <option value="customer">Customer Bookings</option>
                                <option value="dispatch">Dispatch Bookings</option>
                                <option value="confirmed">Confirmed Only</option>
                                <option value="unconfirmed">Unconfirmed Only</option>
                                <option value="cancelled">Cancelled Only</option>
                            </select>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="allBookingsCount" style="padding: 8px 12px; background: #007bff; color: white; border-radius: 4px; font-weight: 500;">0 bookings</span>
                        </div>
                    </div>
                    
                    <div id="allBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Customer Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Route</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Source</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Created</th>
                                </tr>
                            </thead>
                            <tbody id="allBookingsTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading all bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Completed Bookings Section -->
                <div id="completed-section" class="content-section">
                    <h2>✅ Completed Bookings</h2>
                    <p>Successfully completed trips and services</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCompletedBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCompleted()">
                                🗑️ <span style="margin-left: 5px;">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="completedCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 completed</span>
                        </div>
                    </div>
                    
                    <div id="completedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Customer Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Route</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Completed Date</th>
                                </tr>
                            </thead>
                            <tbody id="completedTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading completed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="users-section" class="content-section">
                    <h2>👥 Users</h2>
                    <p>Manage users, drivers, and administrators</p>
                </div>

                <div id="feedback-section" class="content-section">
                    <h2>💬 Customer Feedback</h2>
                    <p>View and manage customer feedback</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Edit Modal -->
    <div class="modal-overlay" id="bookingEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📝 Edit Booking - <span id="modalBookingId">BK123456</span></h2>
                <button class="modal-close" onclick="closeBookingModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Customer Information -->
                <div class="edit-section">
                    <h3>👤 Customer Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>First Name</label>
                            <input type="text" id="editFirstName" placeholder="Enter first name">
                        </div>
                        <div class="edit-field">
                            <label>Last Name</label>
                            <input type="text" id="editLastName" placeholder="Enter last name">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Email Address</label>
                            <input type="email" id="editEmail" placeholder="customer@email.com">
                        </div>
                        <div class="edit-field">
                            <label>Phone Number</label>
                            <input type="tel" id="editPhone" placeholder="+32 xxx xx xx xx">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Number of Passengers</label>
                            <select id="editPassengers">
                                <option value="1">1 Passenger</option>
                                <option value="2">2 Passengers</option>
                                <option value="3">3 Passengers</option>
                                <option value="4">4 Passengers</option>
                                <option value="5">5 Passengers</option>
                                <option value="6">6 Passengers</option>
                                <option value="7">7 Passengers</option>
                                <option value="8">8 Passengers</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Payment Method</label>
                            <select id="editPaymentMethod">
                                <option value="cash">Cash</option>
                                <option value="card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Trip Information -->
                <div class="edit-section">
                    <h3>🚗 Trip Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>From Location</label>
                            <input type="text" id="editFromLocation" placeholder="Pickup address">
                        </div>
                        <div class="edit-field">
                            <label>To Location</label>
                            <input type="text" id="editToLocation" placeholder="Destination address">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Travel Date</label>
                            <input type="date" id="editTravelDate">
                        </div>
                        <div class="edit-field">
                            <label>Travel Time</label>
                            <input type="time" id="editTravelTime">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Vehicle Type</label>
                            <select id="editVehicleType">
                                <option value="saloon">Saloon</option>
                                <option value="estate">Estate</option>
                                <option value="minivan">Minivan</option>
                                <option value="minivan_long">Minivan Long</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Return Trip</label>
                            <select id="editReturnTrip">
                                <option value="false">One Way</option>
                                <option value="true">Return Trip</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Booking Details -->
                <div class="edit-section">
                    <h3>📋 Booking Details</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Booking Status</label>
                            <select id="editBookingStatus">
                                <option value="unconfirmed">Unconfirmed</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Price (€)</label>
                            <input type="number" id="editPrice" step="0.01" placeholder="50.00">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Driver</label>
                            <input type="text" id="editDriver" placeholder="Assign driver">
                        </div>
                    </div>
                    <div class="edit-field">
                        <label>Special Instructions</label>
                        <textarea id="editSpecialInstructions" rows="3" placeholder="Add any special instructions or notes..."></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeBookingModal()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="deleteBooking()">Delete Booking</button>
                <button class="modal-btn modal-btn-success" onclick="confirmBookingFromModal()">✅ Confirm Booking</button>
                <button class="modal-btn modal-btn-primary" onclick="saveBookingChanges()">💾 Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        console.log('🚀 Admin panel JavaScript loaded');

        function showSection(sectionName) {
            console.log('📍 Showing section:', sectionName);
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                document.getElementById('pageTitle').textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                console.log('✅ Section shown:', sectionName);
                
                // If showing distance-time section, load vehicle pricing
                if (sectionName === 'distance-time') {
                    console.log('🚗 Loading Distance & Time pricing section...');
                    updateTestResults('🚗 Opening Distance & Time pricing...');
                    setTimeout(() => {
                        loadVehiclePricing(); // Load dynamic pricing from Types of Vehicles
                    }, 200);
                }
                
                // If showing unconfirmed section, load bookings
                if (sectionName === 'unconfirmed') {
                    console.log('📋 Loading Unconfirmed bookings section...');
                    setTimeout(() => {
                        loadUnconfirmedBookings();
                    }, 200);
                }
                
                // If showing next 24h section, load confirmed bookings
                if (sectionName === 'next-24h') {
                    console.log('📅 Loading Next 24h bookings section...');
                    setTimeout(() => {
                        loadNext24hBookings();
                    }, 200);
                }
                
                // If showing cancelled section, load cancelled bookings
                if (sectionName === 'cancelled') {
                    console.log('❌ Loading Cancelled bookings section...');
                    setTimeout(() => {
                        loadCancelledBookings();
                    }, 200);
                }
                
                // Update test results
                updateTestResults('✅ Section "' + sectionName + '" successfully loaded');
            } else {
                console.error('❌ Section not found:', sectionName + '-section');
                updateTestResults('❌ Section "' + sectionName + '" not found');
            }
        }

        function toggleMenu(menuName) {
            console.log('🔧 Toggling menu:', menuName);
            
            const menu = document.getElementById(menuName + '-menu');
            if (!menu) {
                console.error('❌ Menu not found:', menuName + '-menu');
                updateTestResults('❌ Menu "' + menuName + '" not found');
                return;
            }
            
            // Close other menus
            const allMenus = document.querySelectorAll('.nav-submenu');
            allMenus.forEach(m => {
                if (m.id !== menuName + '-menu') {
                    m.classList.remove('show');
                }
            });
            
            // Toggle current menu
            const isVisible = menu.classList.contains('show');
            if (isVisible) {
                menu.classList.remove('show');
                console.log('❌ Menu hidden:', menuName);
                updateTestResults('❌ Menu "' + menuName + '" hidden');
            } else {
                menu.classList.add('show');
                console.log('✅ Menu shown:', menuName);
                updateTestResults('✅ Menu "' + menuName + '" shown');
            }
        }

        function updateTestResults(message) {
            const results = document.getElementById('testResults');
            if (results) {
                const timestamp = new Date().toLocaleTimeString();
                results.innerHTML = `[${timestamp}] ${message}<br>${results.innerHTML}`;
            }
        }


        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                window.location.href = '/';
            }
        }

        // Vehicle Pricing System Functions
        function loadVehiclePricing() {
            console.log('🔄 Loading vehicle pricing from Types of Vehicles...');
            updateTestResults('🔄 Loading vehicles from Types of Vehicles...');
            
            // Load vehicles from Types of Vehicles admin panel
            const savedVehicles = localStorage.getItem('taxiVehicles');
            let vehicles = [];
            
            if (savedVehicles) {
                try {
                    vehicles = JSON.parse(savedVehicles);
                    console.log('✅ Loaded', vehicles.length, 'vehicles from Types of Vehicles');
                    updateTestResults(`✅ Found ${vehicles.length} vehicles in Types of Vehicles`);
                } catch (e) {
                    console.error('❌ Error parsing saved vehicles:', e);
                    updateTestResults('❌ Error loading vehicles from Types of Vehicles');
                }
            }
            
            // If no vehicles found, show message to add vehicles first
            if (vehicles.length === 0) {
                updateTestResults('⚠️ No vehicles found - need to add vehicles first');
                const container = document.getElementById('vehiclePricingContainer');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px 40px; border: 2px dashed #dee2e6; border-radius: 12px; background: #f8f9fa;">
                            <div style="font-size: 48px; margin-bottom: 20px;">🚗</div>
                            <h3 style="color: #495057; margin-bottom: 15px;">Geen voertuigen gevonden</h3>
                            <p style="color: #6c757d; margin-bottom: 25px; font-size: 16px;">
                                Je moet eerst voertuigen toevoegen in <strong>Types of Vehicles</strong><br>
                                voordat je prijzen kunt instellen.
                            </p>
                            <button class="btn btn-primary" onclick="showSection('types-of-vehicles')" style="margin-right: 10px;">
                                🚗 Ga naar Types of Vehicles
                            </button>
                            <button class="btn" style="background: #6c757d; color: white;" onclick="window.open('admin-vehicles.html', '_blank')">
                                🔧 Open Vehicle Manager
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            // Load saved pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            const pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            const container = document.getElementById('vehiclePricingContainer');
            if (!container) {
                console.error('❌ Container not found!');
                return;
            }
            
            // Create dynamic pricing cards based on actual vehicles from Types of Vehicles
            let htmlContent = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">';
            
            vehicles.forEach(vehicle => {
                // Get existing pricing or set defaults
                const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                
                // Determine vehicle image source - NEVER overwrite custom uploads
                let vehicleImage = '🚗'; // fallback emoji
                if (vehicle.image) {
                    if (vehicle.image.startsWith('data:')) {
                        // Base64 image uploaded from laptop - PROTECTED!
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`📷 PROTECTED: Using custom uploaded image for ${vehicle.name}`);
                    } else if (vehicle.image.startsWith('http') && !vehicle.image.includes('unsplash')) {
                        // Custom external URL image - not default
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`🌐 Using custom external image for ${vehicle.name}`);
                    } else if (vehicle.image.includes('unsplash')) {
                        // Skip default unsplash images - use emoji instead
                        vehicleImage = '🚗';
                        updateTestResults(`⚠️ Skipping default image for ${vehicle.name} - using emoji`);
                    }
                } else {
                    updateTestResults(`📷 No image set for ${vehicle.name} - using emoji`);
                }
                
                htmlContent += `
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; margin-bottom: 20px;">
                            <div style="width: 100px; height: 70px; background: #f8f9fa; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; overflow: hidden; border: 1px solid #dee2e6;">
                                ${vehicleImage}
                            </div>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #2c3e50;">${vehicle.name}</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">${vehicle.description || 'Professional taxi service'}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Minimum prijs</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', -0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="minimum_${vehicle.id}" value="${pricing.minimumPrice.toFixed(2)}" 
                                           step="0.50" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'minimum', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', 0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Prijs per km</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', -0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="perKm_${vehicle.id}" value="${pricing.pricePerKm.toFixed(2)}" 
                                           step="0.10" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'perKm', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', 0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f1f3f4; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #6c757d;">
                                Capaciteit: ${vehicle.capacity?.passengers || 4} personen
                            </span>
                            <span style="font-size: 12px; color: ${vehicle.active ? '#28a745' : '#dc3545'}; font-weight: 500;">
                                ${vehicle.active ? '✅ Actief' : '❌ Inactief'}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            htmlContent += '</div>';
            container.innerHTML = htmlContent;
            
            console.log(`✅ Created pricing cards for ${vehicles.length} vehicles from Types of Vehicles`);
            updateTestResults(`✅ Pricing loaded for ${vehicles.length} vehicles from Types of Vehicles`);
        }
        
        function adjustDynamicPrice(vehicleId, type, amount) {
            const inputId = type === 'minimum' ? `minimum_${vehicleId}` : `perKm_${vehicleId}`;
            const input = document.getElementById(inputId);
            if (input) {
                const currentValue = parseFloat(input.value) || 0;
                const newValue = Math.max(0, currentValue + amount);
                input.value = newValue.toFixed(2);
                updateDynamicPricing(vehicleId, type, newValue);
                
                // Get vehicle name for display
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const vehicle = vehicles.find(v => v.id === vehicleId);
                const vehicleName = vehicle ? vehicle.name : vehicleId;
                
                updateTestResults(`💰 ${vehicleName} ${type} price: €${newValue.toFixed(2)}`);
            }
        }
        
        function updateDynamicPricing(vehicleId, type, value) {
            // Load current pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            let pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            // Initialize vehicle pricing if not exists
            if (!pricingData[vehicleId]) {
                pricingData[vehicleId] = { minimumPrice: 15.00, pricePerKm: 1.50 };
            }
            
            // Update the specific price
            if (type === 'minimum') {
                pricingData[vehicleId].minimumPrice = parseFloat(value) || 0;
            } else if (type === 'perKm') {
                pricingData[vehicleId].pricePerKm = parseFloat(value) || 0;
            }
            
            // Save back to localStorage
            localStorage.setItem('vehiclePricing', JSON.stringify(pricingData));
            
            // Trigger sync to booking system
            syncDynamicPricingToBookingSystem();
            
            console.log(`Updated ${type} pricing for vehicle ${vehicleId}: €${value}`);
        }
        
        function syncDynamicPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data using real vehicle data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Also create vehicle data for booking system - PROTECT custom images
            const bookingSystemVehicles = vehicles
                .filter(v => v.active && (v.display === 'Frontend & Backend' || v.display === 'Frontend only'))
                .map(v => {
                    const pricing = pricingData[v.id] || { minimumPrice: 25.00, pricePerKm: 2.50 };
                    
                    // Protect custom uploaded images - never overwrite them
                    let protectedImage = v.image;
                    if (v.image && v.image.includes('unsplash')) {
                        // Remove default unsplash images - let booking system handle fallback
                        protectedImage = null;
                    }
                    
                    return {
                        id: v.id,
                        name: v.name,
                        price: pricing.minimumPrice, // Use minimum price as base price
                        passengers: `1-${v.capacity?.passengers || 4} passengers`,
                        luggage: `1-${v.capacity?.luggage || 2} large bags`,
                        handLuggage: `1-${v.capacity?.handLuggage || 2} small bags`,
                        image: protectedImage, // Protected from overwrites
                        capacity: {
                            passengers: v.capacity?.passengers || 4,
                            luggage: v.capacity?.luggage || 2,
                            handLuggage: v.capacity?.handLuggage || 2,
                            wheelchairs: v.capacity?.wheelchairs || 0,
                            childSeats: v.capacity?.childSeats || 0
                        },
                        description: v.description || '',
                        active: v.active,
                        lastUpdated: new Date().toISOString()
                    };
                });
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingSystemVehicles));
            
            console.log('💰 Dynamic pricing synced to booking system:', bookingSystemPricing);
            console.log('🚗 Vehicle data synced to booking system:', bookingSystemVehicles.length, 'vehicles');
            updateTestResults(`🔄 Synced ${Object.keys(bookingSystemPricing).length} vehicles with pricing + ${bookingSystemVehicles.length} vehicles to booking system`);
            
            // Update timestamp to trigger booking system refresh
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Trigger immediate refresh in booking system if it's open
            try {
                window.postMessage({ 
                    type: 'PRICING_UPDATED', 
                    vehicles: bookingSystemVehicles,
                    pricing: bookingSystemPricing,
                    timestamp: Date.now()
                }, '*');
                console.log('📡 Sent pricing update message to booking system');
            } catch (e) {
                console.log('⚠️ Could not send refresh message:', e.message);
            }
        }
        
        function saveAllPricing() {
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            let savedCount = 0;
            
            vehicles.forEach(vehicle => {
                const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                
                if (minimumInput && perKmInput) {
                    updateDynamicPricing(vehicle.id, 'minimum', minimumInput.value);
                    updateDynamicPricing(vehicle.id, 'perKm', perKmInput.value);
                    savedCount++;
                }
            });
            
            alert(`✅ Alle prijzen opgeslagen!\n\n${savedCount} voertuigen bijgewerkt\nPrijzen zijn gesynchroniseerd met het boekingssysteem.`);
            updateTestResults(`✅ Saved pricing for ${savedCount} vehicles from Types of Vehicles`);
        }
        
        function resetToDefaults() {
            if (confirm('Weet je zeker dat je alle prijzen wilt resetten naar de standaardwaarden?')) {
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                
                vehicles.forEach(vehicle => {
                    const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                    const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                    
                    if (minimumInput && perKmInput) {
                        minimumInput.value = '15.00';
                        perKmInput.value = '1.50';
                        updateDynamicPricing(vehicle.id, 'minimum', 15.00);
                        updateDynamicPricing(vehicle.id, 'perKm', 1.50);
                    }
                });
                
                alert('✅ Prijzen gereset naar standaardwaarden (€15 min, €1.50/km)');
                updateTestResults('🔄 All vehicles reset to default pricing');
            }
        }
        
        function syncPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            console.log('Pricing synced to booking system:', bookingSystemPricing);
        }
        
        
        function adjustStaticPrice(fieldId, amount) {
            // This function is no longer used - vehicles are loaded dynamically from Types of Vehicles
            console.log('ℹ️ Please use the dynamic vehicles from Types of Vehicles instead');
        }
        
        function savePricing() {
            // This function is no longer used with dynamic pricing
            console.log('ℹ️ Using dynamic pricing - no static save needed');
        }

        // Unconfirmed Bookings Functions
        function loadUnconfirmedBookings() {
            console.log('📋 Loading unconfirmed bookings...');
            
            const tableBody = document.getElementById('unconfirmedTableBody');
            
            if (!tableBody) {
                console.error('❌ Unconfirmed table body not found');
                return;
            }
            
            // Get unconfirmed bookings from localStorage
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            console.log('📋 Found unconfirmed bookings:', unconfirmedBookings.length);
            
            if (unconfirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Unconfirmed Bookings</h3>
                            <p>New bookings will appear here when customers make reservations</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            unconfirmedBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Get actual price from booking
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                
                // Payment method display
                const paymentDisplay = booking.customer.paymentMethod === 'cash' ? 
                    '<span style="color: #28a745;">(Cash)</span> - Pending' : 
                    `<span style="color: #007bff;">(${booking.customer.paymentMethod})</span> - Pending`;
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <input type="checkbox" style="margin-right: 8px;">
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.trip.travelDate}</div>
                            <div style="color: #666; font-size: 12px;">${booking.trip.travelHour}:${booking.trip.travelMinute}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="color: #e67e22; font-weight: 500;">Unpaid 👁</div>
                            <div style="font-size: 12px;">€${total} ${paymentDisplay}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div class="status-dropdown">
                                <span class="status-badge" onclick="toggleStatusDropdown('${booking.bookingId}')" id="statusBadge_${booking.bookingId}">
                                    Unconfirmed
                                </span>
                                <div class="status-dropdown-menu" id="statusDropdown_${booking.bookingId}">
                                    <div class="status-option selected" onclick="changeBookingStatus('${booking.bookingId}', 'unconfirmed')">
                                        ✓ Unconfirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'confirmed')">
                                        Confirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'request_quote')">
                                        Request Quote
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'assigned')">
                                        Assigned
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_accepted')">
                                        Job Accepted
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_rejected')">
                                        Job Rejected
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_route')">
                                        On Route
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'arrived')">
                                        Arrived
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_board')">
                                        On Board
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'no_show')">
                                        No Show
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'completed')">
                                        Completed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'cancelled')">
                                        Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'driver_cancelled')">
                                        Driver Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'incomplete')">
                                        Incomplete
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 12px;">
                            <button style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Assign driver ➕
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>€0.00 ✏️</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>€0.00 ✏️</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            console.log('✅ Unconfirmed bookings loaded successfully');
        }
        
        function confirmBooking(bookingId) {
            if (!confirm(`Confirm booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to confirmed
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                
                // Move to confirmed
                confirmedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Reload the display
                loadUnconfirmedBookings();
                
                alert(`✅ Booking ${bookingId} confirmed successfully!`);
                console.log('✅ Booking confirmed:', bookingId);
            }
        }
        
        function cancelBooking(bookingId) {
            if (!confirm(`Cancel booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to cancelled
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'cancelled';
                booking.cancelledAt = new Date().toISOString();
                
                // Move to cancelled
                cancelledBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                
                // Reload the display
                loadUnconfirmedBookings();
                
                alert(`❌ Booking ${bookingId} cancelled successfully!`);
                console.log('❌ Booking cancelled:', bookingId);
            }
        }
        
        function confirmAllBookings() {
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            if (unconfirmedBookings.length === 0) {
                alert('No unconfirmed bookings to confirm.');
                return;
            }
            
            if (!confirm(`Confirm all ${unconfirmedBookings.length} unconfirmed bookings?`)) {
                return;
            }
            
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            // Move all unconfirmed to confirmed
            unconfirmedBookings.forEach(booking => {
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                confirmedBookings.unshift(booking);
            });
            
            // Clear unconfirmed and save confirmed
            localStorage.setItem('unconfirmedBookings', JSON.stringify([]));
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            // Reload the display
            loadUnconfirmedBookings();
            
            alert(`✅ All ${unconfirmedBookings.length} bookings confirmed successfully!`);
            console.log('✅ All bookings confirmed');
        }
        
        // Global variable to store current booking being edited
        let currentEditingBooking = null;

        function showBookingActions(bookingId) {
            console.log('📝 Opening edit modal for booking:', bookingId);
            
            // Debug: Check if modal exists
            const modal = document.getElementById('bookingEditModal');
            if (!modal) {
                console.error('❌ Modal element not found!');
                alert('❌ Modal element not found! Please refresh the page.');
                return;
            }
            
            // Find the booking in all localStorage sections
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            console.log('🔍 Searching in sections:');
            console.log('- Unconfirmed:', unconfirmedBookings.length);
            console.log('- Confirmed:', confirmedBookings.length);
            console.log('- Completed:', completedBookings.length);
            console.log('- Cancelled:', cancelledBookings.length);
            
            // Search in all sections
            let booking = unconfirmedBookings.find(b => b.bookingId === bookingId) ||
                         confirmedBookings.find(b => b.bookingId === bookingId) ||
                         completedBookings.find(b => b.bookingId === bookingId) ||
                         cancelledBookings.find(b => b.bookingId === bookingId);
            
            if (!booking) {
                alert('❌ Booking not found in any section\n\nBooking ID: ' + bookingId);
                console.error('❌ Booking not found:', bookingId);
                console.log('Available booking IDs:');
                console.log('- Unconfirmed:', unconfirmedBookings.map(b => b.bookingId));
                console.log('- Confirmed:', confirmedBookings.map(b => b.bookingId));
                console.log('- Completed:', completedBookings.map(b => b.bookingId));
                console.log('- Cancelled:', cancelledBookings.map(b => b.bookingId));
                return;
            }
            
            console.log('✅ Found booking:', booking);
            console.log('✅ Booking status:', booking.status || 'unconfirmed');
            
            // Store current booking for editing
            currentEditingBooking = booking;
            
            // Open the modal
            try {
                openBookingEditModal(booking);
                console.log('✅ Modal should be open now');
            } catch (error) {
                console.error('❌ Error opening modal:', error);
                alert('❌ Error opening modal. Check console for details.');
            }
        }

        function openBookingEditModal(booking) {
            console.log('📝 Loading booking data into modal:', booking.bookingId);
            
            try {
                // Helper function to safely set element value
                const setElementValue = (elementId, value) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.value = value || '';
                    } else {
                        console.warn(`⚠️ Element not found: ${elementId}`);
                    }
                };
                
                const setElementText = (elementId, text) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = text || '';
                    } else {
                        console.warn(`⚠️ Element not found: ${elementId}`);
                    }
                };
                
                // Set booking ID in modal header
                setElementText('modalBookingId', booking.bookingId);
                
                // Fill customer information
                setElementValue('editFirstName', booking.customer?.firstName);
                setElementValue('editLastName', booking.customer?.lastName);
                setElementValue('editEmail', booking.customer?.email);
                setElementValue('editPhone', booking.customer?.phone);
                setElementValue('editPassengers', booking.customer?.passengers || '1');
                setElementValue('editPaymentMethod', booking.customer?.paymentMethod || 'cash');
                
                // Fill trip information
                setElementValue('editFromLocation', booking.trip?.fromLocation);
                setElementValue('editToLocation', booking.trip?.toLocation);
                
                // Convert date format from DD/MM/YYYY to YYYY-MM-DD for date input
                const travelDate = booking.trip?.travelDate || '';
                if (travelDate && travelDate.includes('/')) {
                    const dateParts = travelDate.split('/');
                    if (dateParts.length === 3) {
                        const formattedDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
                        setElementValue('editTravelDate', formattedDate);
                    }
                } else {
                    setElementValue('editTravelDate', travelDate);
                }
                
                // Set travel time
                const travelTime = `${booking.trip?.travelHour || '00'}:${booking.trip?.travelMinute || '00'}`;
                setElementValue('editTravelTime', travelTime);
                
                // Set vehicle type
                const vehicleType = booking.vehicle?.vehicle?.id || booking.vehicle?.vehicleId || 'saloon';
                setElementValue('editVehicleType', vehicleType);
                
                // Set return trip
                setElementValue('editReturnTrip', booking.trip?.returnActive || 'false');
                
                // Fill booking details
                setElementValue('editBookingStatus', booking.status || 'unconfirmed');
                
                // Set price from vehicle pricing
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                setElementValue('editPrice', parseFloat(price).toFixed(2));
                
                // Set optional fields
                setElementValue('editDriver', booking.driver);
                
                // Set special instructions (textarea)
                const specialInstructionsElement = document.getElementById('editSpecialInstructions');
                if (specialInstructionsElement) {
                    specialInstructionsElement.value = booking.specialInstructions || '';
                }
                
                // Show the modal
                const modal = document.getElementById('bookingEditModal');
                if (modal) {
                    modal.classList.add('show');
                    console.log('✅ Modal opened with booking data loaded');
                } else {
                    throw new Error('Modal element not found');
                }
                
            } catch (error) {
                console.error('❌ Error in openBookingEditModal:', error);
                alert('❌ Error opening booking details. Some fields may be missing.');
            }
        }

        function closeBookingModal() {
            console.log('❌ Closing booking edit modal');
            document.getElementById('bookingEditModal').classList.remove('show');
            currentEditingBooking = null;
        }

        function saveBookingChanges() {
            if (!currentEditingBooking) {
                alert('❌ No booking data to save');
                return;
            }
            
            console.log('💾 Saving booking changes for:', currentEditingBooking.bookingId);
            
            // Validate required fields
            const firstName = document.getElementById('editFirstName').value.trim();
            const lastName = document.getElementById('editLastName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const fromLocation = document.getElementById('editFromLocation').value.trim();
            const toLocation = document.getElementById('editToLocation').value.trim();
            
            if (!firstName || !lastName || !email || !phone || !fromLocation || !toLocation) {
                alert('❌ Please fill in all required fields');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('❌ Please enter a valid email address');
                return;
            }
            
            // Update booking data
            const updatedBooking = {
                ...currentEditingBooking,
                customer: {
                    ...currentEditingBooking.customer,
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    passengers: document.getElementById('editPassengers').value,
                    paymentMethod: document.getElementById('editPaymentMethod').value
                },
                trip: {
                    ...currentEditingBooking.trip,
                    fromLocation: fromLocation,
                    toLocation: toLocation,
                    travelDate: convertDateToDisplayFormat(document.getElementById('editTravelDate').value),
                    travelHour: document.getElementById('editTravelTime').value.split(':')[0],
                    travelMinute: document.getElementById('editTravelTime').value.split(':')[1],
                    returnActive: document.getElementById('editReturnTrip').value
                },
                vehicle: {
                    ...currentEditingBooking.vehicle,
                    vehicle: {
                        ...currentEditingBooking.vehicle?.vehicle,
                        id: document.getElementById('editVehicleType').value,
                        name: getVehicleName(document.getElementById('editVehicleType').value)
                    },
                    pricing: {
                        ...currentEditingBooking.vehicle?.pricing,
                        minimumPrice: parseFloat(document.getElementById('editPrice').value)
                    }
                },
                status: document.getElementById('editBookingStatus').value,
                driver: document.getElementById('editDriver').value,
                specialInstructions: document.getElementById('editSpecialInstructions').value,
                lastUpdated: new Date().toISOString()
            };
            
            // Update in localStorage
            updateBookingInStorage(updatedBooking);
            
            // Close modal and refresh display
            closeBookingModal();
            loadUnconfirmedBookings();
            
            alert('✅ Booking updated successfully!');
            console.log('✅ Booking saved:', updatedBooking);
        }

        function updateBookingInStorage(updatedBooking) {
            // Get all booking lists
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            // Find which list contains the booking
            let foundInList = null;
            let bookingIndex = -1;
            
            bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
            if (bookingIndex !== -1) {
                foundInList = 'unconfirmed';
            } else {
                bookingIndex = confirmedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                if (bookingIndex !== -1) {
                    foundInList = 'confirmed';
                } else {
                    bookingIndex = completedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                    if (bookingIndex !== -1) {
                        foundInList = 'completed';
                    } else {
                        bookingIndex = cancelledBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                        if (bookingIndex !== -1) {
                            foundInList = 'cancelled';
                        }
                    }
                }
            }
            
            if (!foundInList) {
                console.error('❌ Booking not found in any list:', updatedBooking.bookingId);
                return;
            }
            
            console.log('📍 Found booking in:', foundInList, 'list');
            
            // Remove from current list
            switch (foundInList) {
                case 'unconfirmed':
                    unconfirmedBookings.splice(bookingIndex, 1);
                    break;
                case 'confirmed':
                    confirmedBookings.splice(bookingIndex, 1);
                    break;
                case 'completed':
                    completedBookings.splice(bookingIndex, 1);
                    break;
                case 'cancelled':
                    cancelledBookings.splice(bookingIndex, 1);
                    break;
            }
            
            // Add to new list based on status
            switch (updatedBooking.status) {
                case 'unconfirmed':
                    unconfirmedBookings.unshift(updatedBooking);
                    break;
                case 'confirmed':
                case 'job_accepted':
                case 'assigned':
                case 'on_route':
                case 'arrived':
                case 'on_board':
                    confirmedBookings.unshift(updatedBooking);
                    break;
                case 'completed':
                    completedBookings.unshift(updatedBooking);
                    break;
                case 'cancelled':
                case 'driver_cancelled':
                case 'no_show':
                case 'job_rejected':
                    cancelledBookings.unshift(updatedBooking);
                    break;
                default:
                    // If status is unclear, update in same list
                    switch (foundInList) {
                        case 'unconfirmed':
                            unconfirmedBookings.unshift(updatedBooking);
                            break;
                        case 'confirmed':
                            confirmedBookings.unshift(updatedBooking);
                            break;
                        case 'completed':
                            completedBookings.unshift(updatedBooking);
                            break;
                        case 'cancelled':
                            cancelledBookings.unshift(updatedBooking);
                            break;
                    }
            }
            
            // Save all lists
            localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
            localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            
            console.log('✅ Booking updated and moved to:', updatedBooking.status, 'list');
            
            // Reload the appropriate section
            if (document.getElementById('unconfirmed-section').classList.contains('active')) {
                loadUnconfirmedBookings();
            } else if (document.getElementById('next-24h-section').classList.contains('active')) {
                loadNext24hBookings();
            } else if (document.getElementById('completed-section').classList.contains('active')) {
                loadCompletedBookings();
            } else if (document.getElementById('cancelled-section').classList.contains('active')) {
                loadCancelledBookings();
            } else if (document.getElementById('all-section').classList.contains('active')) {
                loadAllBookings();
            }
        }

        function convertDateToDisplayFormat(dateString) {
            // Convert from YYYY-MM-DD to DD/MM/YYYY
            if (!dateString) return '';
            const dateParts = dateString.split('-');
            if (dateParts.length === 3) {
                return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            }
            return dateString;
        }

        function getVehicleName(vehicleId) {
            const vehicleNames = {
                'saloon': 'Saloon',
                'estate': 'Estate',
                'minivan': 'Minivan',
                'minivan_long': 'Minivan Long'
            };
            return vehicleNames[vehicleId] || 'Unknown';
        }

        function confirmBookingFromModal() {
            if (!currentEditingBooking) {
                alert('❌ No booking to confirm');
                return;
            }
            
            // Update status to confirmed
            document.getElementById('editBookingStatus').value = 'confirmed';
            
            // Save changes
            saveBookingChanges();
            
            console.log('✅ Booking confirmed from modal');
        }

        function deleteBooking() {
            if (!currentEditingBooking) {
                alert('❌ No booking to delete');
                return;
            }
            
            if (!confirm(`⚠️ Are you sure you want to permanently delete booking ${currentEditingBooking.bookingId}?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            // Remove from all lists
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            unconfirmedBookings = unconfirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            confirmedBookings = confirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            completedBookings = completedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
            
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            cancelledBookings = cancelledBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            
            // Close modal and refresh
            closeBookingModal();
            
            // Reload the active section
            if (document.getElementById('unconfirmed-section').classList.contains('active')) {
                loadUnconfirmedBookings();
            } else if (document.getElementById('next-24h-section').classList.contains('active')) {
                loadNext24hBookings();
            } else if (document.getElementById('completed-section').classList.contains('active')) {
                loadCompletedBookings();
            } else if (document.getElementById('cancelled-section').classList.contains('active')) {
                loadCancelledBookings();
            } else if (document.getElementById('all-section').classList.contains('active')) {
                loadAllBookings();
            }
            
            alert('✅ Booking deleted successfully');
            console.log('🗑️ Booking deleted:', currentEditingBooking.bookingId);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('bookingEditModal');
            if (event.target === modal) {
                closeBookingModal();
            }
        });

        // Next 24h Bookings Functions
        function loadNext24hBookings() {
            console.log('📅 Loading next 24h bookings...');
            
            const tableBody = document.getElementById('next24hTableBody');
            const countDisplay = document.getElementById('next24hCount');
            
            if (!tableBody) {
                console.error('❌ Next 24h table body not found');
                return;
            }
            
            // Get confirmed bookings from localStorage
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            console.log('📅 Found confirmed bookings:', confirmedBookings.length);
            
            // Filter for next 24 hours
            const now = new Date();
            const next24h = new Date(now.getTime() + (24 * 60 * 60 * 1000));
            
            const upcomingBookings = confirmedBookings.filter(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                return travelDate >= now && travelDate <= next24h;
            });
            
            countDisplay.textContent = `${upcomingBookings.length} confirmed`;
            
            if (upcomingBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📅 No Bookings in Next 24 Hours</h3>
                            <p>Confirmed bookings for the next 24 hours will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by travel date/time
            upcomingBookings.sort((a, b) => {
                const dateA = parseTravelDate(a.trip.travelDate, a.trip.travelHour, a.trip.travelMinute);
                const dateB = parseTravelDate(b.trip.travelDate, b.trip.travelHour, b.trip.travelMinute);
                return dateA - dateB;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            upcomingBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = travelDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(price).toFixed(2);
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="editConfirmedBooking('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">${booking.trip.fromLocation} → ${booking.trip.toLocation}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                Confirmed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.driver || 'Not assigned'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${booking.specialInstructions || '-'}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Next 24h bookings loaded successfully');
        }

        // Cancelled Bookings Functions
        function loadCancelledBookings() {
            console.log('❌ Loading cancelled bookings...');
            
            const tableBody = document.getElementById('cancelledTableBody');
            const countDisplay = document.getElementById('cancelledCount');
            
            if (!tableBody) {
                console.error('❌ Cancelled table body not found');
                return;
            }
            
            // Get cancelled bookings from localStorage
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            console.log('❌ Found cancelled bookings:', cancelledBookings.length);
            
            countDisplay.textContent = `${cancelledBookings.length} cancelled`;
            
            if (cancelledBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>❌ No Cancelled Bookings</h3>
                            <p>Cancelled and deleted bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by cancelled date (most recent first)
            cancelledBookings.sort((a, b) => {
                const dateA = new Date(a.cancelledAt || a.lastUpdated);
                const dateB = new Date(b.cancelledAt || b.lastUpdated);
                return dateB - dateA;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            cancelledBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = travelDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                
                const cancelledDate = new Date(booking.cancelledAt || booking.lastUpdated);
                const formattedCancelledDate = cancelledDate.toLocaleDateString('nl-BE');
                
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(price).toFixed(2);
                
                const reason = booking.cancellationReason || 'Manual cancellation';
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6; background: #fef5e7;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="restoreBooking('${booking.bookingId}')">
                                ↩️ Restore
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">${booking.trip.fromLocation} → ${booking.trip.toLocation}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div>${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${reason}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; text-decoration: line-through; color: #6c757d;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${formattedCancelledDate}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Cancelled bookings loaded successfully');
        }

        // Helper Functions
        function parseTravelDate(dateString, hour, minute) {
            // Parse DD/MM/YYYY format
            const dateParts = dateString.split('/');
            if (dateParts.length === 3) {
                const day = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
                const year = parseInt(dateParts[2]);
                const hourInt = parseInt(hour || 0);
                const minuteInt = parseInt(minute || 0);
                
                return new Date(year, month, day, hourInt, minuteInt);
            }
            return new Date();
        }

        function editConfirmedBooking(bookingId) {
            console.log('📝 Editing confirmed booking:', bookingId);
            
            // Find booking in confirmed list
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const booking = confirmedBookings.find(b => b.bookingId === bookingId);
            
            if (booking) {
                currentEditingBooking = booking;
                openBookingEditModal(booking);
            } else {
                alert('❌ Booking not found');
            }
        }

        function restoreBooking(bookingId) {
            if (!confirm(`Restore booking ${bookingId} to unconfirmed status?`)) {
                return;
            }
            
            // Move from cancelled back to unconfirmed
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            const bookingIndex = cancelledBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = cancelledBookings[bookingIndex];
                booking.status = 'unconfirmed';
                booking.restoredAt = new Date().toISOString();
                delete booking.cancelledAt;
                delete booking.cancellationReason;
                
                // Move to unconfirmed
                unconfirmedBookings.unshift(booking);
                cancelledBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                // Reload the display
                loadCancelledBookings();
                
                alert(`✅ Booking ${bookingId} restored to unconfirmed status!`);
                console.log('↩️ Booking restored:', bookingId);
            }
        }

        function clearAllCancelled() {
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            if (cancelledBookings.length === 0) {
                alert('No cancelled bookings to clear.');
                return;
            }
            
            if (!confirm(`⚠️ Permanently delete all ${cancelledBookings.length} cancelled bookings?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            localStorage.setItem('cancelledBookings', JSON.stringify([]));
            loadCancelledBookings();
            
            alert(`✅ All ${cancelledBookings.length} cancelled bookings cleared!`);
            console.log('🗑️ All cancelled bookings cleared');
        }

        // Email Settings Functions
        function toggleAdminPassword() {
            const passwordInput = document.getElementById('adminSmtpPassword');
            const toggleBtn = event.target;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = '👁';
            }
        }

        async function sendAdminTestEmail() {
            const testEmail = document.getElementById('adminTestEmail').value;
            if (!testEmail) {
                showAdminEmailStatus('Please enter an email address', 'error');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                const config = getAdminEmailConfig();
                const response = await fetch('/api/test-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ testEmail: testEmail, config: config })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAdminEmailStatus('✅ Test email sent successfully!', 'success');
                } else {
                    showAdminEmailStatus('❌ Failed to send test email: ' + result.error, 'error');
                }
            } catch (error) {
                showAdminEmailStatus('❌ Error: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        function getAdminEmailConfig() {
            const securityValue = document.querySelector('input[name="adminSmtpSecurity"]:checked').value;
            
            return {
                fromName: document.getElementById('adminFromName').value,
                fromEmail: document.getElementById('adminFromEmail').value,
                replyToEmail: document.getElementById('adminReplyToEmail').value,
                adminEmail: document.getElementById('adminAdminEmail').value,
                connectionType: document.getElementById('adminConnectionType').value,
                provider: document.getElementById('adminProvider').value,
                smtpHost: document.getElementById('adminSmtpHost').value,
                smtpPort: document.getElementById('adminSmtpPort').value,
                smtpUsername: document.getElementById('adminSmtpUsername').value,
                smtpPassword: document.getElementById('adminSmtpPassword').value,
                smtpSecurity: securityValue
            };
        }

        function showAdminEmailStatus(message, type) {
            const indicator = document.getElementById('adminEmailStatus');
            indicator.textContent = message;
            
            // Set colors based on type
            if (type === 'success') {
                indicator.style.background = '#d4edda';
                indicator.style.color = '#155724';
                indicator.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                indicator.style.background = '#f8d7da';
                indicator.style.color = '#721c24';
                indicator.style.border = '1px solid #f5c6cb';
            } else {
                indicator.style.background = '#d1ecf1';
                indicator.style.color = '#0c5460';
                indicator.style.border = '1px solid #bee5eb';
            }
            
            indicator.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 5000);
        }

        // Email form submission
        document.addEventListener('DOMContentLoaded', function() {
            const emailForm = document.getElementById('adminEmailSettingsForm');
            if (emailForm) {
                emailForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const config = getAdminEmailConfig();
                    
                    if (!config.smtpPassword) {
                        showAdminEmailStatus('❌ SMTP password is required', 'error');
                        return;
                    }

                    const btn = document.querySelector('#adminEmailSettingsForm button[type="submit"]');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.textContent = 'Saving...';

                    try {
                        // Save configuration to localStorage
                        localStorage.setItem('emailConfig', JSON.stringify(config));
                        
                        // Update status display
                        document.getElementById('configStatus').textContent = 'Configured ✅';
                        document.getElementById('configHost').textContent = config.smtpHost;
                        document.getElementById('configEmail').textContent = config.fromEmail;
                        
                        showAdminEmailStatus('✅ Email configuration saved successfully!', 'success');
                    } catch (error) {
                        showAdminEmailStatus('❌ Error saving configuration: ' + error.message, 'error');
                    } finally {
                        btn.disabled = false;
                        btn.textContent = originalText;
                    }
                });
            }
        });

        // Status Dropdown Functions
        function toggleStatusDropdown(bookingId) {
            console.log('🔍 Toggling dropdown for booking:', bookingId);
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            const badge = document.getElementById(`statusBadge_${bookingId}`);
            
            if (!dropdown || !badge) {
                console.error('❌ Dropdown or badge not found for booking:', bookingId);
                return;
            }
            
            console.log('📋 Dropdown element found:', dropdown);
            
            // Close all other dropdowns first
            document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                if (menu.id !== `statusDropdown_${bookingId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Calculate position for fixed positioning
            const rect = badge.getBoundingClientRect();
            const isOpen = dropdown.classList.contains('show');
            
            if (!isOpen) {
                // Position dropdown below the badge
                dropdown.style.top = (rect.bottom + 4) + 'px';
                dropdown.style.left = rect.left + 'px';
                dropdown.classList.add('show');
                console.log('✅ Dropdown opened at position:', rect.left, rect.bottom + 4);
            } else {
                dropdown.classList.remove('show');
                console.log('✅ Dropdown closed');
            }
        }

        function changeBookingStatus(bookingId, newStatus) {
            console.log('📋 Changing booking status:', bookingId, 'to', newStatus);
            
            // Get current bookings
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            
            if (bookingIndex === -1) {
                alert('❌ Booking not found');
                return;
            }
            
            const booking = unconfirmedBookings[bookingIndex];
            const oldStatus = booking.status || 'unconfirmed';
            
            // Update booking status and timestamp
            booking.status = newStatus;
            booking.lastUpdated = new Date().toISOString();
            
            // Handle status changes that require moving between sections
            if (newStatus === 'confirmed') {
                // Move to confirmed section (Next 24h)
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                booking.confirmedAt = new Date().toISOString();
                confirmedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                alert(`✅ Booking ${bookingId} confirmed and moved to Next 24h section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else if (newStatus === 'completed') {
                // Move to completed section
                let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                booking.completedAt = new Date().toISOString();
                completedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                alert(`✅ Booking ${bookingId} completed and moved to Completed section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else if (newStatus === 'cancelled' || newStatus === 'driver_cancelled') {
                // Move to cancelled section
                let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                booking.cancelledAt = new Date().toISOString();
                booking.cancellationReason = newStatus === 'driver_cancelled' ? 'Driver Cancelled' : 'Cancelled';
                cancelledBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                const reason = newStatus === 'driver_cancelled' ? 'driver cancellation' : 'cancellation';
                alert(`❌ Booking ${bookingId} ${reason} and moved to Cancelled section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else {
                // Keep in unconfirmed section but update status
                unconfirmedBookings[bookingIndex] = booking;
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                // Update the status badge in the UI
                const statusBadge = document.getElementById(`statusBadge_${bookingId}`);
                if (statusBadge) {
                    statusBadge.textContent = getStatusDisplayName(newStatus);
                    statusBadge.className = `status-badge ${getStatusClass(newStatus)}`;
                }
                
                // Update the dropdown to show current selection
                updateDropdownSelection(bookingId, newStatus);
                
                alert(`✅ Booking ${bookingId} status updated to: ${getStatusDisplayName(newStatus)}`);
            }
            
            // Close dropdown
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            console.log('✅ Status changed from', oldStatus, 'to', newStatus);
        }

        function getStatusDisplayName(status) {
            const statusNames = {
                'unconfirmed': 'Unconfirmed',
                'confirmed': 'Confirmed',
                'request_quote': 'Request Quote',
                'assigned': 'Assigned',
                'job_accepted': 'Job Accepted',
                'job_rejected': 'Job Rejected',
                'on_route': 'On Route',
                'arrived': 'Arrived',
                'on_board': 'On Board',
                'no_show': 'No Show',
                'completed': 'Completed',
                'cancelled': 'Cancelled',
                'driver_cancelled': 'Driver Cancelled',
                'incomplete': 'Incomplete'
            };
            return statusNames[status] || status;
        }

        function getStatusClass(status) {
            if (['confirmed', 'job_accepted', 'completed'].includes(status)) {
                return 'confirmed';
            } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(status)) {
                return 'cancelled';
            }
            return ''; // Default (unconfirmed) styling
        }

        function updateDropdownSelection(bookingId, currentStatus) {
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (!dropdown) return;
            
            // Update all options
            const options = dropdown.querySelectorAll('.status-option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.textContent.trim().replace('✓ ', '') === getStatusDisplayName(currentStatus)) {
                    option.classList.add('selected');
                    option.innerHTML = `✓ ${getStatusDisplayName(currentStatus)}`;
                } else {
                    option.innerHTML = option.textContent.replace('✓ ', '');
                }
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.status-dropdown')) {
                document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Dispatch Calendar Variables
        let dispatchCurrentDate = new Date();
        let dispatchSelectedDate = null;
        let dispatchReturnCurrentDate = new Date();
        let dispatchReturnSelectedDate = null;
        let dispatchExtraStopCount = 0;
        let dispatchRetourActive = false;

        // Initialize Dispatch Calendar and Time
        function initDispatchDateTime() {
            // Populate hour options (00-23)
            const hourSelect = document.getElementById('dispatchHour');
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                hourSelect.appendChild(option);
            }
            
            // Populate minute options (00, 15, 30, 45)
            const minuteSelect = document.getElementById('dispatchMinute');
            ['00', '15', '30', '45'].forEach(minute => {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                minuteSelect.appendChild(option);
            });
            
            // Set default to current time + 1 hour
            const now = new Date();
            const defaultHour = (now.getHours() + 1) % 24;
            hourSelect.value = defaultHour.toString().padStart(2, '0');
            minuteSelect.value = '00';
            
            // Initialize calendar
            generateDispatchCalendar();
            
            // Initialize return time selectors
            initDispatchReturnTime();
        }

        function initDispatchReturnTime() {
            // Populate return hour options (00-23)
            const returnHourSelect = document.getElementById('dispatchReturnHour');
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                returnHourSelect.appendChild(option);
            }
            
            // Populate return minute options (00, 15, 30, 45)
            const returnMinuteSelect = document.getElementById('dispatchReturnMinute');
            ['00', '15', '30', '45'].forEach(minute => {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                returnMinuteSelect.appendChild(option);
            });
        }

        // Extra Stops Functions
        function addDispatchExtraStop() {
            if (dispatchExtraStopCount >= 7) {
                alert('Maximum 7 extra stops allowed');
                return;
            }
            
            dispatchExtraStopCount++;
            const container = document.getElementById('dispatchExtraStopsContainer');
            
            const stopDiv = document.createElement('div');
            stopDiv.id = `dispatchExtraStop${dispatchExtraStopCount}`;
            stopDiv.style.cssText = 'display: flex; gap: 15px; align-items: center;';
            
            stopDiv.innerHTML = `
                <input type="text" id="dispatchExtraStopAddress${dispatchExtraStopCount}" placeholder="📍 Extra stop ${dispatchExtraStopCount}..." 
                       style="flex: 1; padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                <button type="button" onclick="removeDispatchExtraStop(${dispatchExtraStopCount})" 
                        style="background: #dc3545; color: white; border: none; padding: 18px; border-radius: 10px; 
                               cursor: pointer; transition: all 0.3s; font-size: 16px; font-weight: 600;"
                        onmouseover="this.style.background='#c82333'"
                        onmouseout="this.style.background='#dc3545'">
                    ❌
                </button>
            `;
            
            container.appendChild(stopDiv);
            
            console.log('Added extra stop:', dispatchExtraStopCount);
        }

        function removeDispatchExtraStop(stopNumber) {
            const stopDiv = document.getElementById(`dispatchExtraStop${stopNumber}`);
            if (stopDiv) {
                stopDiv.remove();
                dispatchExtraStopCount--;
                
                // Renumber remaining stops
                const container = document.getElementById('dispatchExtraStopsContainer');
                const remainingStops = container.children;
                
                for (let i = 0; i < remainingStops.length; i++) {
                    const stop = remainingStops[i];
                    const newNumber = i + 1;
                    stop.id = `dispatchExtraStop${newNumber}`;
                    
                    const input = stop.querySelector('input');
                    input.id = `dispatchExtraStopAddress${newNumber}`;
                    input.placeholder = `📍 Extra stop ${newNumber}...`;
                    
                    const button = stop.querySelector('button');
                    button.setAttribute('onclick', `removeDispatchExtraStop(${newNumber})`);
                }
                
                dispatchExtraStopCount = remainingStops.length;
                console.log('Removed extra stop, remaining:', dispatchExtraStopCount);
            }
        }

        // Retour Functions
        function toggleDispatchRetour() {
            dispatchRetourActive = !dispatchRetourActive;
            const details = document.getElementById('dispatchRetourDetails');
            const status = document.getElementById('dispatchRetourStatus');
            const btn = document.getElementById('dispatchRetourBtn');
            
            if (dispatchRetourActive) {
                details.style.display = 'block';
                status.textContent = 'Activated ✅';
                status.style.color = '#28a745';
                btn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
            } else {
                details.style.display = 'none';
                status.textContent = 'Not activated';
                status.style.color = '#666';
                btn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';
                
                // Clear return values
                document.getElementById('dispatchReturnDate').value = '';
                document.getElementById('dispatchReturnHour').value = '';
                document.getElementById('dispatchReturnMinute').value = '';
                dispatchReturnSelectedDate = null;
            }
            
            console.log('Retour toggled:', dispatchRetourActive);
        }

        function toggleDispatchCalendar() {
            const calendar = document.getElementById('dispatchCalendar');
            const isVisible = calendar.style.display === 'block';
            
            // Close all other calendars/dropdowns
            document.querySelectorAll('[id*="Calendar"]').forEach(cal => {
                if (cal.id !== 'dispatchCalendar') cal.style.display = 'none';
            });
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchCalendar();
            }
        }

        function generateDispatchCalendar() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchCalendarTitle');
            const grid = document.getElementById('dispatchCalendarGrid');
            
            title.textContent = `${monthNames[dispatchCurrentDate.getMonth()]} ${dispatchCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7; // Convert Sunday=0 to Monday=0
            
            // Add empty cells for days before first day
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#007bff';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchSelectedDate && cellDate.toDateString() === dispatchSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchSelectedDate || cellDate.toDateString() !== dispatchSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        function changeDispatchMonth(direction) {
            dispatchCurrentDate.setMonth(dispatchCurrentDate.getMonth() + direction);
            generateDispatchCalendar();
        }

        function selectDispatchDate(date) {
            dispatchSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchDate').value = formattedDate;
            document.getElementById('dispatchCalendar').style.display = 'none';
            
            generateDispatchCalendar(); // Refresh to show selection
        }

        // Return Calendar Functions
        function toggleDispatchReturnCalendar() {
            const calendar = document.getElementById('dispatchReturnCalendar');
            const isVisible = calendar.style.display === 'block';
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchReturnCalendar();
            }
        }

        function generateDispatchReturnCalendar() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchReturnCalendarTitle');
            const grid = document.getElementById('dispatchReturnCalendarGrid');
            
            title.textContent = `${monthNames[dispatchReturnCurrentDate.getMonth()]} ${dispatchReturnCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7;
            
            // Add empty cells
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#2196f3';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchReturnSelectedDate && cellDate.toDateString() === dispatchReturnSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchReturnDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchReturnSelectedDate || cellDate.toDateString() !== dispatchReturnSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        function changeDispatchReturnMonth(direction) {
            dispatchReturnCurrentDate.setMonth(dispatchReturnCurrentDate.getMonth() + direction);
            generateDispatchReturnCalendar();
        }

        function selectDispatchReturnDate(date) {
            dispatchReturnSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchReturnDate').value = formattedDate;
            document.getElementById('dispatchReturnCalendar').style.display = 'none';
            
            generateDispatchReturnCalendar();
        }

        // Close calendars when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#dispatchCalendar') && !event.target.closest('#dispatchDate')) {
                document.getElementById('dispatchCalendar').style.display = 'none';
            }
            if (!event.target.closest('#dispatchReturnCalendar') && !event.target.closest('#dispatchReturnDate')) {
                document.getElementById('dispatchReturnCalendar').style.display = 'none';
            }
        });

        // Dispatch Booking Functions
        async function createDispatchBooking(event) {
            event.preventDefault();
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '⏳ Creating Booking...';
            
            try {
                // Get form data
                const dispatchData = {
                    pickup: document.getElementById('dispatchPickup').value.trim(),
                    destination: document.getElementById('dispatchDestination').value.trim(),
                    date: document.getElementById('dispatchDate').value.trim(),
                    hour: document.getElementById('dispatchHour').value,
                    minute: document.getElementById('dispatchMinute').value,
                    firstName: document.getElementById('dispatchFirstName').value.trim(),
                    lastName: document.getElementById('dispatchLastName').value.trim(),
                    email: document.getElementById('dispatchEmail').value.trim(),
                    phone: document.getElementById('dispatchPhone').value.trim(),
                    passengers: document.getElementById('dispatchPassengers').value,
                    vehicleType: document.getElementById('dispatchVehicleType').value,
                    paymentMethod: document.getElementById('dispatchPaymentMethod').value,
                    extraStopCount: dispatchExtraStopCount,
                    returnActive: dispatchRetourActive,
                    returnDate: dispatchRetourActive ? document.getElementById('dispatchReturnDate').value.trim() : '',
                    returnHour: dispatchRetourActive ? document.getElementById('dispatchReturnHour').value : '',
                    returnMinute: dispatchRetourActive ? document.getElementById('dispatchReturnMinute').value : ''
                };
                
                // Get extra stops
                const extraStops = [];
                for (let i = 1; i <= dispatchExtraStopCount; i++) {
                    const stopInput = document.getElementById(`dispatchExtraStopAddress${i}`);
                    if (stopInput && stopInput.value.trim()) {
                        extraStops.push(stopInput.value.trim());
                    }
                }
                
                // Validate required fields
                if (!dispatchData.pickup || !dispatchData.destination || !dispatchData.date || 
                    !dispatchData.hour || !dispatchData.minute || !dispatchData.firstName || 
                    !dispatchData.lastName || !dispatchData.email || !dispatchData.phone) {
                    showDispatchStatus('❌ Please fill in all required fields', 'error');
                    return;
                }
                
                // Get vehicle data from localStorage
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const selectedVehicle = vehicles.find(v => v.id === dispatchData.vehicleType) || 
                                      { id: dispatchData.vehicleType, name: dispatchData.vehicleType, price: 50.00 };
                
                // Get pricing data
                const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
                const pricing = pricingData[dispatchData.vehicleType] || { minimumPrice: 50.00, pricePerKm: 2.50 };
                
                // Generate booking ID
                const bookingId = 'BK' + Date.now();
                
                // Create main booking object (heen trip)
                const mainBooking = {
                    bookingId: bookingId,
                    customer: {
                        firstName: dispatchData.firstName,
                        lastName: dispatchData.lastName,
                        email: dispatchData.email,
                        phone: dispatchData.phone,
                        passengers: dispatchData.passengers,
                        paymentMethod: dispatchData.paymentMethod,
                        koffers: 1, // Default
                        handbagage: 1 // Default
                    },
                    trip: {
                        fromLocation: dispatchData.pickup,
                        toLocation: dispatchData.destination,
                        travelDate: dispatchData.date,
                        travelHour: dispatchData.hour,
                        travelMinute: dispatchData.minute,
                        extraStopCount: dispatchData.extraStopCount,
                        extraStops: extraStops,
                        returnActive: 'false', // Main trip doesn't have return status
                        tripType: 'heen',
                        direction: 'outbound'
                    },
                    vehicle: {
                        vehicle: selectedVehicle,
                        pricing: pricing
                    },
                    status: 'confirmed', // Admin bookings are pre-confirmed
                    source: 'dispatch', // Mark as dispatch booking
                    createdAt: new Date().toISOString(),
                    confirmedAt: new Date().toISOString(),
                    bookingDate: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                // Save main booking to confirmed bookings
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings.unshift(mainBooking);
                
                // Create return booking if return trip is active
                let returnBooking = null;
                if (dispatchData.returnActive && dispatchData.returnDate && dispatchData.returnHour && dispatchData.returnMinute) {
                    const returnBookingId = 'BK' + (Date.now() + 1); // Slightly different timestamp
                    
                    returnBooking = {
                        bookingId: returnBookingId,
                        customer: {
                            firstName: dispatchData.firstName,
                            lastName: dispatchData.lastName,
                            email: dispatchData.email,
                            phone: dispatchData.phone,
                            passengers: dispatchData.passengers,
                            paymentMethod: dispatchData.paymentMethod,
                            koffers: 1, // Default
                            handbagage: 1 // Default
                        },
                        trip: {
                            fromLocation: dispatchData.destination, // Reversed: from destination back to origin
                            toLocation: dispatchData.pickup, // Reversed: to origin from destination
                            travelDate: dispatchData.returnDate,
                            travelHour: dispatchData.returnHour,
                            travelMinute: dispatchData.returnMinute,
                            extraStopCount: 0, // No extra stops for return trip
                            extraStops: [],
                            returnActive: 'false', // Return trip doesn't have another return
                            tripType: 'terug',
                            direction: 'inbound',
                            relatedBookingId: bookingId // Link to main booking
                        },
                        vehicle: {
                            vehicle: selectedVehicle,
                            pricing: pricing
                        },
                        status: 'confirmed', // Admin bookings are pre-confirmed
                        source: 'dispatch', // Mark as dispatch booking
                        createdAt: new Date().toISOString(),
                        confirmedAt: new Date().toISOString(),
                        bookingDate: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    };
                    
                    // Add return booking to confirmed bookings
                    confirmedBookings.unshift(returnBooking);
                }
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Send email notification for main booking
                try {
                    const emailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mainBooking)
                    });
                    
                    // Send email for return booking if exists
                    if (returnBooking) {
                        const returnEmailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(returnBooking)
                        });
                    }
                    
                    if (emailResponse.ok) {
                        console.log('✅ Email notifications sent successfully');
                    } else {
                        console.log('⚠️ Email sending failed, but booking created');
                    }
                } catch (emailError) {
                    console.log('⚠️ Email server not available, but booking created');
                }
                
                // Show success message
                let successMessage = `✅ Dispatch Booking${returnBooking ? 's' : ''} Created Successfully!

HEEN REIS: ${bookingId}
Van: ${dispatchData.pickup}
Naar: ${dispatchData.destination}
Datum: ${dispatchData.date} om ${dispatchData.hour}:${dispatchData.minute}`;

                if (returnBooking) {
                    successMessage += `

TERUG REIS: ${returnBooking.bookingId}
Van: ${dispatchData.destination}
Naar: ${dispatchData.pickup}
Datum: ${dispatchData.returnDate} om ${dispatchData.returnHour}:${dispatchData.returnMinute}`;
                }

                successMessage += `

Both bookings added to confirmed bookings list!`;
                
                showDispatchStatus(successMessage, 'success');
                
                // Clear form
                document.getElementById('dispatchBookingForm').reset();
                
                // Reset extra stops
                document.getElementById('dispatchExtraStopsContainer').innerHTML = '';
                dispatchExtraStopCount = 0;
                
                // Reset retour
                if (dispatchRetourActive) {
                    toggleDispatchRetour(); // Turn off retour
                }
                
                // Reset selected dates
                dispatchSelectedDate = null;
                dispatchReturnSelectedDate = null;
                
                console.log('✅ Dispatch booking(s) created:', mainBooking.bookingId, returnBooking ? `& ${returnBooking.bookingId}` : '');
                
            } catch (error) {
                console.error('❌ Error creating dispatch booking:', error);
                showDispatchStatus('❌ Error creating booking: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function showDispatchStatus(message, type) {
            const statusDiv = document.getElementById('dispatchStatus');
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // Set colors based on type
            if (type === 'success') {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            } else {
                statusDiv.style.background = '#d1ecf1';
                statusDiv.style.color = '#0c5460';
                statusDiv.style.border = '1px solid #bee5eb';
            }
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Load functions for all sections
        function loadNext24hBookings() {
            console.log('📋 Loading Next 24h bookings...');
            
            const tableBody = document.getElementById('next24hTableBody');
            if (!tableBody) {
                console.error('❌ Next 24h table body not found');
                return;
            }
            
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            document.getElementById('next24hCount').textContent = `${confirmedBookings.length} confirmed`;
            
            if (confirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Confirmed Bookings</h3>
                            <p>Confirmed bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            confirmedBookings.forEach((booking, index) => {
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge confirmed" style="font-size: 11px; padding: 4px 8px;">
                                Confirmed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">-</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Next 24h bookings loaded successfully');
        }

        function loadCompletedBookings() {
            console.log('📋 Loading completed bookings...');
            
            const tableBody = document.getElementById('completedTableBody');
            if (!tableBody) {
                console.error('❌ Completed table body not found');
                return;
            }
            
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            document.getElementById('completedCount').textContent = `${completedBookings.length} completed`;
            
            if (completedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>✅ No Completed Bookings</h3>
                            <p>Completed trips will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            completedBookings.forEach((booking, index) => {
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                const completedDate = new Date(booking.completedAt || booking.lastUpdated);
                const formattedCompletedDate = completedDate.toLocaleDateString('nl-BE');
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.trip.fromLocation}</div>
                            <div style="font-size: 12px; color: #666;">→ ${booking.trip.toLocation}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge confirmed" style="font-size: 11px; padding: 4px 8px; background: #28a745;">
                                Completed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">${formattedCompletedDate}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Completed bookings loaded successfully');
        }

        function clearAllCompleted() {
            if (confirm('Are you sure you want to clear all completed bookings?')) {
                localStorage.setItem('completedBookings', JSON.stringify([]));
                loadCompletedBookings();
                alert('✅ All completed bookings cleared');
            }
        }

        // All Bookings Functions
        function loadAllBookings() {
            console.log('📋 Loading all bookings...');
            
            const tableBody = document.getElementById('allBookingsTableBody');
            if (!tableBody) {
                console.error('❌ All bookings table body not found');
                return;
            }
            
            // Collect all bookings from different sources
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            // Combine all bookings and sort by creation date (newest first)
            const allBookings = [
                ...unconfirmedBookings.map(b => ({...b, section: 'unconfirmed'})),
                ...confirmedBookings.map(b => ({...b, section: 'confirmed'})),
                ...completedBookings.map(b => ({...b, section: 'completed'})),
                ...cancelledBookings.map(b => ({...b, section: 'cancelled'}))
            ].sort((a, b) => new Date(b.createdAt || b.bookingDate) - new Date(a.createdAt || a.bookingDate));
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${allBookings.length} bookings`;
            
            if (allBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Bookings Found</h3>
                            <p>All customer and dispatch bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            allBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Get actual price
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                
                // Determine source
                const source = booking.source === 'dispatch' ? 
                    '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">DISPATCH</span>' :
                    '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">CUSTOMER</span>';
                
                // Status styling
                let statusClass = '';
                let statusText = booking.status || 'unconfirmed';
                if (['confirmed', 'job_accepted', 'completed'].includes(statusText)) {
                    statusClass = 'confirmed';
                } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(statusText)) {
                    statusClass = 'cancelled';
                }
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            <div style="font-size: 12px; color: #666;">✉️ ${booking.customer.email}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.trip.fromLocation}</div>
                            <div style="font-size: 12px; color: #666;">→ ${booking.trip.toLocation}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                            <div style="font-size: 12px; color: #666;">Created: ${formattedDate} ${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge ${statusClass}" style="font-size: 11px; padding: 4px 8px;">
                                ${getStatusDisplayName(statusText)}
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            ${source}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                            <div style="font-size: 12px; color: #666;">${booking.customer.passengers} passengers</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                            <div style="font-size: 12px; color: #666;">${booking.customer.paymentMethod}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">${formattedDate}</div>
                            <div style="font-size: 11px; color: #666;">${formattedTime}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ All bookings loaded successfully:', allBookings.length);
        }

        function filterAllBookings() {
            const filter = document.getElementById('allBookingsFilter').value;
            console.log('🔍 Filtering all bookings by:', filter);
            
            // Get all bookings
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            let filteredBookings = [];
            
            switch(filter) {
                case 'customer':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...confirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...completedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...cancelledBookings.filter(b => !b.source || b.source !== 'dispatch')
                    ];
                    break;
                case 'dispatch':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => b.source === 'dispatch'),
                        ...confirmedBookings.filter(b => b.source === 'dispatch'),
                        ...completedBookings.filter(b => b.source === 'dispatch'),
                        ...cancelledBookings.filter(b => b.source === 'dispatch')
                    ];
                    break;
                case 'confirmed':
                    filteredBookings = confirmedBookings;
                    break;
                case 'unconfirmed':
                    filteredBookings = unconfirmedBookings;
                    break;
                case 'completed':
                    filteredBookings = completedBookings;
                    break;
                case 'cancelled':
                    filteredBookings = cancelledBookings;
                    break;
                default: // 'all'
                    filteredBookings = [...unconfirmedBookings, ...confirmedBookings, ...completedBookings, ...cancelledBookings];
                    break;
            }
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${filteredBookings.length} bookings`;
            
            // Force reload with filtered data
            // For simplicity, we'll just reload all and then apply client-side filtering
            loadAllBookings();
        }

        // Vehicle Management Functions
        let vehicles = [];
        let editingVehicleIndex = -1;

        function loadVehiclesForTypesSection() {
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
            } else {
                // Create default vehicles if none exist
                vehicles = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        active: true,
                        capacity: { passengers: 4, luggage: 2 },
                        image: null
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        active: true,
                        capacity: { passengers: 4, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        active: true,
                        capacity: { passengers: 6, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        active: true,
                        capacity: { passengers: 8, luggage: 6 },
                        image: null
                    }
                ];
                localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            }
            renderVehicleTable();
        }

        function renderVehicleTable() {
            const tableBody = document.getElementById('vehicleTableBody');
            if (!tableBody) return;

            if (vehicles.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>🚗 No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicles.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;">🚗</span>';

                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 15px;">${imageDisplay}</td>
                        <td style="padding: 15px; font-weight: 500;">${vehicle.name}</td>
                        <td style="padding: 15px; color: #666;">${vehicle.description || 'No description'}</td>
                        <td style="padding: 15px;">
                            <div>👥 ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div style="font-size: 12px; color: #666;">🧳 ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div style="font-size: 12px; color: #666;">👜 ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td style="padding: 15px;">
                            <span style="color: ${statusColor}; font-weight: 500;">
                                ${vehicle.active ? '✅' : '❌'} ${statusText}
                            </span>
                        </td>
                        <td style="padding: 15px;">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="editVehicle(${index})">✏️ Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="toggleVehicleStatus(${index})">${vehicle.active ? '❌ Disable' : '✅ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;" onclick="deleteVehicle(${index})">🗑️ Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openAddVehicleModal() {
            editingVehicleIndex = -1;
            document.getElementById('vehicleModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleForm').reset();
            document.getElementById('vehicleImagePreview').style.display = 'none';
            document.getElementById('vehicleUploadText').style.display = 'block';
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function editVehicle(index) {
            editingVehicleIndex = index;
            const vehicle = vehicles[index];
            
            document.getElementById('vehicleModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('vehicleDescription').value = vehicle.description || '';
            document.getElementById('vehiclePassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            
            if (vehicle.image) {
                document.getElementById('vehicleImagePreview').src = vehicle.image;
                document.getElementById('vehicleImagePreview').style.display = 'block';
                document.getElementById('vehicleUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function closeVehicleModal() {
            document.getElementById('vehicleModal').style.display = 'none';
        }

        function handleVehicleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleImagePreview').src = e.target.result;
                    document.getElementById('vehicleImagePreview').style.display = 'block';
                    document.getElementById('vehicleUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteVehicle(index) {
            if (confirm(`Are you sure you want to delete "${vehicles[index].name}"?`)) {
                vehicles.splice(index, 1);
                saveVehicles();
                renderVehicleTable();
                showVehicleSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleStatus(index) {
            vehicles[index].active = !vehicles[index].active;
            saveVehicles();
            renderVehicleTable();
            showVehicleSuccess(`Vehicle ${vehicles[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicles() {
            localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            
            // Also sync to booking system
            const bookingVehicles = vehicles.filter(v => v.active).map(v => ({
                id: v.id,
                name: v.name,
                description: v.description,
                active: v.active,
                capacity: v.capacity,
                image: v.image
            }));
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
            console.log('✅ Vehicles saved and synced to booking system');
        }

        function showVehicleSuccess(message) {
            const el = document.getElementById('vehicleSuccessMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showVehicleError(message) {
            const el = document.getElementById('vehicleErrorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Handle vehicle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleForm = document.getElementById('vehicleForm');
            if (vehicleForm) {
                vehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleName').value;
                    const description = document.getElementById('vehicleDescription').value;
                    const passengers = parseInt(document.getElementById('vehiclePassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleHandLuggage').value);
                    const imagePreview = document.getElementById('vehicleImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicles[editingVehicleIndex].id,
                        name: name,
                        description: description,
                        active: true,
                        capacity: { passengers: passengers, luggage: luggage, handLuggage: handLuggage },
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleIndex === -1) {
                        vehicles.push(vehicleData);
                        showVehicleSuccess('Vehicle added successfully');
                    } else {
                        vehicles[editingVehicleIndex] = { ...vehicles[editingVehicleIndex], ...vehicleData };
                        showVehicleSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicles();
                    renderVehicleTable();
                    closeVehicleModal();
                });
            }
        });

        // Update the section show function to load vehicles when Types of Vehicles is opened
        const originalShowSection = window.showSection;
        window.showSection = function(sectionName) {
            if (originalShowSection) {
                originalShowSection(sectionName);
            }
            
            if (sectionName === 'types-of-vehicles') {
                setTimeout(() => {
                    loadVehiclesForTypesSection();
                }, 100);
            }
        };

        // Vehicle Manager Functions
        let vehicleManagerData = [];
        let editingVehicleManagerIndex = -1;

        function loadVehicleManagerData() {
            console.log('🚗 Loading Vehicle Manager data...');
            
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                vehicleManagerData = JSON.parse(savedVehicles);
            } else {
                // Create default vehicles if none exist
                vehicleManagerData = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 2, handLuggage: 2 },
                        hourlyRate: 25,
                        image: 'https://images.unsplash.com/photo-1550355291-bbee04a92027?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 4, handLuggage: 2 },
                        hourlyRate: 30,
                        image: 'https://images.unsplash.com/photo-1494905998402-395d579af36f?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 6, luggage: 4, handLuggage: 3 },
                        hourlyRate: 35,
                        image: 'https://images.unsplash.com/photo-1544636331-e26879cd4d9b?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 8, luggage: 6, handLuggage: 4 },
                        hourlyRate: 45,
                        image: 'https://images.unsplash.com/photo-1570125909517-53cb21c89ff2?w=300&h=200&fit=crop&q=80'
                    }
                ];
                saveVehicleManagerData();
            }
            renderVehicleManagerTable();
        }

        function renderVehicleManagerTable() {
            const tableBody = document.getElementById('vehicleManagerTableBody');
            if (!tableBody) return;

            if (vehicleManagerData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>🚗 No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicleManagerData.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;">🚗</span>';

                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 15px;">${imageDisplay}</td>
                        <td style="padding: 15px; font-weight: 500;">${vehicle.name}</td>
                        <td style="padding: 15px; color: #666;">${vehicle.description || 'No description'}</td>
                        <td style="padding: 15px;">
                            <div>👥 ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div style="font-size: 12px; color: #666;">🧳 ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div style="font-size: 12px; color: #666;">👜 ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td style="padding: 15px; font-weight: 500;">€${vehicle.hourlyRate || 25}/hour</td>
                        <td style="padding: 15px;">
                            <span style="color: ${statusColor}; font-weight: 500;">
                                ${vehicle.active ? '✅' : '❌'} ${statusText}
                            </span>
                        </td>
                        <td style="padding: 15px;">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer; font-size: 12px;" onclick="editVehicleManager(${index})">✏️ Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer; font-size: 12px;" onclick="toggleVehicleManagerStatus(${index})">${vehicle.active ? '❌ Disable' : '✅ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="deleteVehicleManager(${index})">🗑️ Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openVehicleManagerModal() {
            editingVehicleManagerIndex = -1;
            document.getElementById('vehicleManagerModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleManagerForm').reset();
            document.getElementById('vehicleManagerImagePreview').style.display = 'none';
            document.getElementById('vehicleManagerUploadText').style.display = 'block';
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function editVehicleManager(index) {
            editingVehicleManagerIndex = index;
            const vehicle = vehicleManagerData[index];
            
            document.getElementById('vehicleManagerModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleManagerName').value = vehicle.name;
            document.getElementById('vehicleManagerDriver').value = vehicle.driver || 'All';
            document.getElementById('vehicleManagerDescription').value = vehicle.description || '';
            document.getElementById('vehicleManagerPassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleManagerLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleManagerHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            document.getElementById('vehicleManagerHourlyRate').value = vehicle.hourlyRate || 25;
            
            if (vehicle.image) {
                document.getElementById('vehicleManagerImagePreview').src = vehicle.image;
                document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                document.getElementById('vehicleManagerUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function closeVehicleManagerModal() {
            document.getElementById('vehicleManagerModal').style.display = 'none';
        }

        function adjustVehicleManagerValue(field, change) {
            const input = document.getElementById(`vehicleManager${field.charAt(0).toUpperCase() + field.slice(1)}`);
            if (input) {
                const currentValue = parseInt(input.value) || 0;
                const newValue = Math.max(0, currentValue + change);
                input.value = newValue;
            }
        }

        function handleVehicleManagerImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleManagerError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleManagerImagePreview').src = e.target.result;
                    document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                    document.getElementById('vehicleManagerUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteVehicleManager(index) {
            if (confirm(`Are you sure you want to delete "${vehicleManagerData[index].name}"?`)) {
                vehicleManagerData.splice(index, 1);
                saveVehicleManagerData();
                renderVehicleManagerTable();
                showVehicleManagerSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleManagerStatus(index) {
            vehicleManagerData[index].active = !vehicleManagerData[index].active;
            saveVehicleManagerData();
            renderVehicleManagerTable();
            showVehicleManagerSuccess(`Vehicle ${vehicleManagerData[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicleManagerData() {
            localStorage.setItem('taxiVehicles', JSON.stringify(vehicleManagerData));
            
            // Also sync to booking system
            const bookingVehicles = vehicleManagerData.filter(v => v.active).map(v => ({
                id: v.id,
                name: v.name,
                description: v.description,
                active: v.active,
                capacity: v.capacity,
                hourlyRate: v.hourlyRate,
                image: v.image
            }));
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
            console.log('✅ Vehicle Manager data saved and synced to booking system');
        }

        function showVehicleManagerSuccess(message) {
            const el = document.getElementById('vehicleManagerSuccessMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showVehicleManagerError(message) {
            const el = document.getElementById('vehicleManagerErrorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Handle Vehicle Manager form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleManagerForm = document.getElementById('vehicleManagerForm');
            if (vehicleManagerForm) {
                vehicleManagerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleManagerName').value;
                    const driver = document.getElementById('vehicleManagerDriver').value;
                    const description = document.getElementById('vehicleManagerDescription').value;
                    const passengers = parseInt(document.getElementById('vehicleManagerPassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleManagerLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleManagerHandLuggage').value);
                    const hourlyRate = parseInt(document.getElementById('vehicleManagerHourlyRate').value);
                    const imagePreview = document.getElementById('vehicleManagerImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleManagerError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleManagerIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicleManagerData[editingVehicleManagerIndex].id,
                        name: name,
                        driver: driver,
                        description: description,
                        active: true,
                        capacity: { 
                            passengers: passengers, 
                            luggage: luggage,
                            handLuggage: handLuggage 
                        },
                        hourlyRate: hourlyRate,
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleManagerIndex === -1) {
                        vehicleManagerData.push(vehicleData);
                        showVehicleManagerSuccess('Vehicle added successfully');
                    } else {
                        vehicleManagerData[editingVehicleManagerIndex] = { ...vehicleManagerData[editingVehicleManagerIndex], ...vehicleData };
                        showVehicleManagerSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicleManagerData();
                    renderVehicleManagerTable();
                    closeVehicleManagerModal();
                });
            }
        });

        // Update the existing showSection function to load Vehicle Manager data when opened
        if (window.showSection) {
            const existingShowSection = window.showSection;
            window.showSection = function(sectionName) {
                existingShowSection(sectionName);
                
                if (sectionName === 'types-of-vehicles') {
                    setTimeout(() => {
                        loadVehiclesForTypesSection();
                    }, 100);
                }
                
                if (sectionName === 'vehicle-manager') {
                    setTimeout(() => {
                        loadVehicleManagerData();
                    }, 100);
                }
            };
        }

        // Make functions globally available
        window.showSection = showSection;
        window.toggleMenu = toggleMenu;
        window.showBookingActions = showBookingActions;
        window.confirmBooking = confirmBooking;
        window.cancelBooking = cancelBooking;
        window.confirmAllBookings = confirmAllBookings;
        window.closeBookingModal = closeBookingModal;
        window.saveBookingChanges = saveBookingChanges;
        window.toggleStatusDropdown = toggleStatusDropdown;
        window.changeBookingStatus = changeBookingStatus;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📱 Admin panel initialized');
            
            // Initialize dispatch calendar and time
            initDispatchDateTime();
            
            // Auto-load vehicle pricing when Distance & Time section is opened
            setTimeout(() => {
                const section = document.getElementById('distance-time-section');
                if (section && section.classList.contains('active')) {
                    console.log('🔄 Auto-loading vehicle pricing for Distance & Time...');
                    loadVehiclePricing();
                }
            }, 1000);
        });
    </script>
</body>
</html>