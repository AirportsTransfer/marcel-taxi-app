<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcel's Taxi - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .admin-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #2c3e50;
            color: white;
            padding: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #2c3e50;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            border-bottom: 1px solid #34495e;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #34495e;
            color: white;
        }

        .nav-submenu {
            background: #1a252f;
            display: none;
        }

        .nav-submenu.show {
            display: block;
        }

        .nav-submenu .nav-link {
            padding: 12px 20px 12px 52px;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            background: #f5f7fa;
        }

        .header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-area {
            padding: 30px;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-section.active {
            display: block;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .test-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #dee2e6;
        }

        /* Booking Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 22px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .edit-section {
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }

        .edit-section h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 10px;
        }

        .edit-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .edit-field {
            display: flex;
            flex-direction: column;
        }

        .edit-field label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .edit-field input,
        .edit-field select,
        .edit-field textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .edit-field input:focus,
        .edit-field select:focus,
        .edit-field textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .modal-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: #007bff;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #0056b3;
        }

        .modal-btn-success {
            background: #28a745;
            color: white;
        }

        .modal-btn-success:hover {
            background: #1e7e34;
        }

        .modal-btn-danger {
            background: #dc3545;
            color: white;
        }

        .modal-btn-danger:hover {
            background: #c82333;
        }

        .modal-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .modal-btn-secondary:hover {
            background: #545b62;
        }

        /* Status Dropdown */
        .status-dropdown {
            position: relative;
            display: inline-block;
        }

        .status-badge {
            background: #ffc107;
            color: #856404;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .status-badge.confirmed {
            background: #28a745;
            color: white;
        }

        .status-badge.confirmed:hover {
            background: #1e7e34;
        }

        .status-badge.cancelled {
            background: #dc3545;
            color: white;
        }

        .status-badge.cancelled:hover {
            background: #c82333;
        }

        .status-dropdown-menu {
            position: fixed;
            min-width: 180px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 99999;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-dropdown-menu.show {
            display: block;
        }

        .status-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-option:hover {
            background: #f8f9fa;
        }

        .status-option:first-child {
            border-radius: 6px 6px 0 0;
        }

        .status-option:last-child {
            border-radius: 0 0 6px 6px;
        }

        .status-option.current {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
        }

        .status-option .status-icon {
            width: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>🚗 Marcel's Taxi Pro</h2>
                <p>Professional Admin Panel</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('dispatch')">
                        🚨 Dispatch
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('bookings')">
                        📋 Bookings
                    </a>
                    <ul class="nav-submenu" id="bookings-menu">
                        <li><a class="nav-link" onclick="showSection('next-24h')">Next 24h</a></li>
                        <li><a class="nav-link" onclick="showSection('latest')">Latest</a></li>
                        <li><a class="nav-link" onclick="showSection('unconfirmed')">Unconfirmed</a></li>
                        <li><a class="nav-link" onclick="showSection('completed')">Completed</a></li>
                        <li><a class="nav-link" onclick="showSection('cancelled')">Cancelled</a></li>
                        <li><a class="nav-link" onclick="showSection('all-bookings')">All</a></li>
                        <li><a class="nav-link" onclick="showSection('trash')">Trash</a></li>
                        <li><a class="nav-link" onclick="showSection('calendar')">Calendar</a></li>
                        <li><a class="nav-link" onclick="showSection('add-new')">Add New</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('reports')">
                        📈 Reports
                    </a>
                    <ul class="nav-submenu" id="reports-menu">
                        <li><a class="nav-link" onclick="showSection('driver-report')">Driver Report</a></li>
                        <li><a class="nav-link" onclick="showSection('payment-report')">Payment Report</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('users')">
                        👥 Users
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('vehicle-manager')">
                        🚗 Vehicle Manager
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('feedback')">
                        💬 Feedback
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('settings')">
                        ⚙️ Settings
                    </a>
                    <ul class="nav-submenu" id="settings-menu">
                        <li><a class="nav-link" onclick="showSection('general')">⚙️ General Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('types-of-vehicles')">🚗 Types of Vehicles</a></li>
                        <li><a class="nav-link" onclick="showSection('payment-methods')">💳 Payment Methods</a></li>
                        <li><a class="nav-link" onclick="showSection('item-surcharge')">💰 Item Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('notifications')">🔔 Notifications</a></li>
                        <li><a class="nav-link" onclick="showSection('mail')">📧 Email Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('email-templates')">📝 Email Templates</a></li>
                        <li><a class="nav-link" onclick="showSection('translation')">🌐 Translation</a></li>
                        <li><a class="nav-link" onclick="showSection('booking-settings')">📋 Booking Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('google')">🌐 Google</a></li>
                        <li><a class="nav-link" onclick="showSection('services')">🎯 Services</a></li>
                        <li><a class="nav-link" onclick="showSection('users-settings')">👥 User Management</a></li>
                        <li><a class="nav-link" onclick="showSection('backup-export')">💾 Backup & Export</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('pricing')">
                        💰 Pricing
                    </a>
                    <ul class="nav-submenu" id="pricing-menu">
                        <li><a class="nav-link" onclick="showSection('deposit-payments')">Deposit Payments</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-time')">Distance & Time</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-modifier')">Distance Modifier</a></li>
                        <li><a class="nav-link" onclick="showSection('driver-income')">Driver Income</a></li>
                        <li><a class="nav-link" onclick="showSection('fixed-prices')">Fixed Prices</a></li>
                        <li><a class="nav-link" onclick="showSection('holiday-surcharge')">Holiday Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('item-surcharge')">Item Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('location-surcharge')">Location Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('meet-and-greet')">Meet and Greet</a></li>
                        <li><a class="nav-link" onclick="showSection('night-surcharge')">Night Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('other-discounts')">Other Discounts</a></li>
                        <li><a class="nav-link" onclick="showSection('tax')">Tax</a></li>
                        <li><a class="nav-link" onclick="showSection('voucher-discounts')">Voucher Discounts</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('knowledge-base')">
                        📚 Knowledge Base
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('updates')">
                        🔄 Updates
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('profile')">
                        👤 Profile
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="logout()">
                        🚪 Sign Out
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Dispatch</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="window.open('/booking-exact.html', '_blank')">👀 View Booking System</button>
                </div>
            </div>

            <div class="content-area">

                <!-- Dispatch Section -->
                <div id="dispatch-section" class="content-section active">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #dc3545, #c82333); padding: 12px; border-radius: 12px; color: white;">
                            🚨
                        </div>
                        <div>
                            <h1 style="margin: 0; font-size: 36px; font-weight: 700; color: #2c3e50;">Dispatch Center</h1>
                            <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 18px;">Manual taxi booking and dispatch system</p>
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 40px; margin-bottom: 30px;">
                        <h2 style="font-size: 28px; font-weight: 600; color: #2c3e50; margin-bottom: 30px;">Booking Form</h2>
                        
                        <form id="dispatchBookingForm" style="display: grid; gap: 30px; max-width: 800px; margin: 0 auto;">
                            <!-- Trip Details Section -->
                            <div style="display: grid; gap: 25px;">
                                <!-- Pickup Location -->
                                <input type="text" id="dispatchPickup" placeholder="📍 Van waar..." 
                                       style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">

                                <!-- Extra Stops Container -->
                                <div id="dispatchExtraStopsContainer" style="display: grid; gap: 15px;">
                                    <!-- Extra stops will be added here dynamically -->
                                </div>

                                <!-- Add Extra Stop Button -->
                                <button type="button" onclick="addDispatchExtraStop()" 
                                        style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; 
                                               padding: 15px 25px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; 
                                               transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
                                               box-shadow: 0 4px 15px rgba(0,123,255,0.2); max-width: 200px;"
                                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(0,123,255,0.3)'"
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.2)'">
                                    ➕ Extra Stop
                                </button>

                                <!-- Destination -->
                                <input type="text" id="dispatchDestination" placeholder="📍 Naar waar..." 
                                       style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">

                                <!-- Date & Time -->
                                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 20px; align-items: center;">
                                    <!-- Date Picker -->
                                    <div style="position: relative;">
                                        <input type="text" id="dispatchDate" placeholder="📅 Kies datum" readonly
                                               style="width: 100%; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                      cursor: pointer; transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                               onclick="toggleDispatchCalendar()"
                                               onmouseover="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                               onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        
                                        <!-- Calendar Popup -->
                                        <div id="dispatchCalendar" style="position: absolute; top: 100%; left: 0; z-index: 1000; background: white; border: 2px solid #e9ecef; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); padding: 25px; display: none; min-width: 350px;">
                                            <div style="text-align: center; margin-bottom: 20px;">
                                                <button type="button" onclick="changeDispatchMonth(-1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">←</button>
                                                <span id="dispatchCalendarTitle" style="font-weight: 700; margin: 0 25px; font-size: 18px; color: #2c3e50;">November 2023</span>
                                                <button type="button" onclick="changeDispatchMonth(1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">→</button>
                                            </div>
                                            <div id="dispatchCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center;">
                                                <!-- Calendar will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Hour Selector -->
                                    <select id="dispatchHour" style="padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                                      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="">⏰ Uur</option>
                                    </select>
                                    
                                    <!-- Minute Selector -->
                                    <select id="dispatchMinute" style="padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 18px; 
                                                                        background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="">⏰ Min</option>
                                    </select>
                                </div>

                                <!-- Return Trip Section -->
                                <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 12px; border: 2px solid #2196f3;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <button type="button" id="dispatchRetourBtn" onclick="toggleDispatchRetour()" 
                                                    style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none; 
                                                           padding: 12px 20px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; 
                                                           transition: all 0.3s; display: flex; align-items: center; gap: 8px;"
                                                    onmouseover="this.style.transform='scale(1.05)'"
                                                    onmouseout="this.style.transform='scale(1)'">
                                                🔄 Retour
                                            </button>
                                            <span style="font-weight: 600; color: #1976d2; font-size: 16px;">Return Trip?</span>
                                        </div>
                                        <span id="dispatchRetourStatus" style="color: #666; font-style: italic;">Not activated</span>
                                    </div>
                                    
                                    <!-- Return Details (Hidden by default) -->
                                    <div id="dispatchRetourDetails" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #2196f3;">
                                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center;">
                                            <!-- Return Date Picker -->
                                            <div style="position: relative;">
                                                <input type="text" id="dispatchReturnDate" placeholder="📅 Retour datum" readonly
                                                       style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                              cursor: pointer; transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                                       onclick="toggleDispatchReturnCalendar()"
                                                       onmouseover="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                       onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                
                                                <!-- Return Calendar Popup -->
                                                <div id="dispatchReturnCalendar" style="position: absolute; top: 100%; left: 0; z-index: 1000; background: white; border: 2px solid #e9ecef; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); padding: 25px; display: none; min-width: 350px;">
                                                    <div style="text-align: center; margin-bottom: 20px;">
                                                        <button type="button" onclick="changeDispatchReturnMonth(-1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">←</button>
                                                        <span id="dispatchReturnCalendarTitle" style="font-weight: 700; margin: 0 25px; font-size: 18px; color: #2c3e50;">November 2023</span>
                                                        <button type="button" onclick="changeDispatchReturnMonth(1)" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; font-size: 18px; cursor: pointer; padding: 10px 15px; transition: all 0.3s;">→</button>
                                                    </div>
                                                    <div id="dispatchReturnCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center;">
                                                        <!-- Calendar will be populated by JavaScript -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Return Hour Selector -->
                                            <select id="dispatchReturnHour" style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                    background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                                    onfocus="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                    onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                <option value="">⏰ Uur</option>
                                            </select>
                                            
                                            <!-- Return Minute Selector -->
                                            <select id="dispatchReturnMinute" style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s;"
                                                    onfocus="this.style.borderColor='#2196f3'; this.style.boxShadow='0 4px 15px rgba(33,150,243,0.15)'"
                                                    onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                                <option value="">⏰ Min</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Details Section -->
                            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; border: 1px solid #dee2e6;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                                    <input type="text" id="dispatchFirstName" placeholder="👤 First Name" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                    
                                    <input type="text" id="dispatchLastName" placeholder="👤 Last Name" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                                    <input type="email" id="dispatchEmail" placeholder="✉️ Email Address" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                    
                                    <input type="tel" id="dispatchPhone" placeholder="📞 Phone Number" 
                                           style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                  background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                           onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                           onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 25px;">
                                    <select id="dispatchPassengers" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                               background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="1">👥 1 Passenger</option>
                                        <option value="2">👥 2 Passengers</option>
                                        <option value="3">👥 3 Passengers</option>
                                        <option value="4">👥 4 Passengers</option>
                                        <option value="5">👥 5 Passengers</option>
                                        <option value="6">👥 6 Passengers</option>
                                        <option value="7">👥 7 Passengers</option>
                                        <option value="8">👥 8 Passengers</option>
                                    </select>
                                    
                                    <select id="dispatchVehicleType" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                              background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="saloon">🚗 Saloon</option>
                                        <option value="estate">🚙 Estate</option>
                                        <option value="minivan">🚐 Minivan</option>
                                        <option value="minivan_long">🚌 Minivan Long</option>
                                    </select>
                                    
                                    <select id="dispatchPaymentMethod" style="padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                                                                                background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                                            onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                                            onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                        <option value="cash">💵 Cash</option>
                                        <option value="card">💳 Credit Card</option>
                                        <option value="paypal">🅿️ PayPal</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Create Booking Button -->
                            <button type="submit" onclick="createDispatchBooking(event)" 
                                    style="width: 100%; padding: 25px; background: linear-gradient(135deg, #28a745, #20c997); 
                                           color: white; border: none; border-radius: 15px; font-size: 20px; font-weight: 700; 
                                           cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 12px;
                                           box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3); text-transform: uppercase; letter-spacing: 1px;"
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 35px rgba(40, 167, 69, 0.4)'"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(40, 167, 69, 0.3)'">
                                📞 Create Booking
                            </button>
                        </form>
                    </div>

                    <!-- Status Display -->
                    <div id="dispatchStatus" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;"></div>
                </div>

                <!-- Settings Section -->
                <div id="general-section" class="content-section">
                    <h2>⚙️ General Settings</h2>
                    <p>Configure general system settings</p>
                </div>

                <div id="vehicle-manager-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>🚗 Vehicle Manager</h2>
                            <p>Complete vehicle fleet management and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openVehicleManagerModal()">
                            ➕ Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleManagerSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleManagerErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Image</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Name</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Description</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Capacity</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Hourly Rate</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Status</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleManagerTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Manager Modal -->
                <div id="vehicleManagerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleManagerModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleManagerModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleManagerForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Name *</label>
                                        <input type="text" id="vehicleManagerName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Driver</label>
                                        <select id="vehicleManagerDriver" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
                                            <option value="All">All Drivers</option>
                                            <option value="John Smith">John Smith</option>
                                            <option value="Mike Johnson">Mike Johnson</option>
                                            <option value="Sarah Wilson">Sarah Wilson</option>
                                        </select>
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Description</label>
                                    <textarea id="vehicleManagerDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service with premium comfort"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Passengers</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', -1)">-</button>
                                            <input type="number" id="vehicleManagerPassengers" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="4" min="1" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Luggage</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hand Luggage</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerHandLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hourly Rate (€)</label>
                                        <input type="number" id="vehicleManagerHourlyRate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="25" min="0" step="5">
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleManagerImageInput').click()">
                                        <img id="vehicleManagerImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleManagerUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                                            <div>Click to upload vehicle image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleManagerImageInput" accept="image/*" style="display: none;" onchange="handleVehicleManagerImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleManagerModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="types-of-vehicles-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>🚗 Types of Vehicles</h2>
                            <p>Manage your vehicle fleet and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openAddVehicleModal()">
                            ➕ Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Image</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Name</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Description</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Capacity</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Status</th>
                                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Add/Edit Modal -->
                <div id="vehicleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleForm">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Name *</label>
                                    <input type="text" id="vehicleName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Description</label>
                                    <textarea id="vehicleDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Passengers</label>
                                        <input type="number" id="vehiclePassengers" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="4" min="1" max="20">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Luggage</label>
                                        <input type="number" id="vehicleLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Hand Luggage</label>
                                        <input type="number" id="vehicleHandLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                </div>

                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleImageInput').click()">
                                        <img id="vehicleImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                                            <div>Click to upload image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleImageInput" accept="image/*" style="display: none;" onchange="handleVehicleImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="mail-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ⚙️ Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">📧 Email Settings</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>Current Configuration</h3>
                        <div style="margin: 15px 0;">
                            <div><strong>Status:</strong> <span id="configStatus">Not configured</span></div>
                            <div><strong>SMTP Host:</strong> <span id="configHost">smtp.gmail.com</span></div>
                            <div><strong>From Email:</strong> <span id="configEmail">info@airporttransfer.be</span></div>
                        </div>
                    </div>

                    <form id="adminEmailSettingsForm" onsubmit="saveEmailSettings(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">From name</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromName" value="Airport Transfer" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">From email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromEmail" value="info@airporttransfer.be" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Reply to email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminReplyToEmail" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Admin email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminAdminEmail" value="marceltataev@gmail.com" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Connection type</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminConnectionType">
                                    <option value="smtp">SMTP - Your mail server</option>
                                    <option value="sendmail">Sendmail</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Provider</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminProvider">
                                    <option value="gmail">Gmail</option>
                                    <option value="outlook">Outlook</option>
                                    <option value="yahoo">Yahoo</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP host</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpHost" value="smtp.gmail.com" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP port</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPort">
                                    <option value="587" selected>587</option>
                                    <option value="465">465</option>
                                    <option value="25">25</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP username</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpUsername" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP password</label>
                                <div style="position: relative;">
                                    <input type="password" style="width: 100%; padding: 12px; padding-right: 50px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPassword" placeholder="Enter your Gmail App Password" required>
                                    <button type="button" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px;" onclick="toggleAdminPassword()">👁</button>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">SMTP security</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="none"> None
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="ssl"> SSL
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="tls" checked> TLS
                                </label>
                            </div>
                        </div>

                        <div style="border-top: 1px solid #e1e5e9; padding-top: 20px; margin-top: 20px;">
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                                <div style="flex: 1;">
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Send a test email</label>
                                    <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminTestEmail" placeholder="Enter your email address">
                                </div>
                                <button type="button" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 32px;" onclick="sendAdminTestEmail()">Send</button>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                💾 Save Email Settings
                            </button>
                        </div>
                    </form>

                    <div id="adminEmailStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Email Templates Section -->
                <div id="email-templates-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ⚙️ Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">📝 Email Templates</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>📧 Email Template Configuratie</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Beheer de 3 verschillende email templates die naar klanten worden verstuurd tijdens het boekingsproces.</p>
                    </div>

                    <!-- Template Selector -->
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Selecteer Email Template:</label>
                        <select id="templateSelector" onchange="loadSelectedTemplate()" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 16px;">
                            <option value="pending">📋 Template 1: Wacht op Bevestiging (Direct na reservering)</option>
                            <option value="confirmed">✅ Template 2: Bevestiging Email (Unconfirmed → Confirmed)</option>
                            <option value="cancelled">❌ Template 3: Annulering Email (Unconfirmed → Cancelled)</option>
                        </select>
                    </div>

                    <form id="emailTemplateForm" onsubmit="saveEmailTemplate(event)">
                        <!-- Template 1: Pending Confirmation -->
                        <div id="pendingTemplate" class="template-content">
                            <div style="background: #fff4e6; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffa500;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">📋 Template 1: Wacht op Bevestiging</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt direct verstuurd wanneer een klant een nieuwe boeking maakt.</p>
                            </div>

                            <!-- Subject Line -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">📧 Email Onderwerp</h4>
                                <input type="text" id="pendingSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Uw booking wacht op bevestiging - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Welcome Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">🎉 Welkomstbericht</h4>
                                <textarea id="pendingWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Bedankt voor uw boeking bij Marcel's Taxi!

We hebben uw reservering ontvangen. Ons team zal uw boeking zo spoedig mogelijk beoordelen.</textarea>
                            </div>

                            <!-- Status Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">⏳ Status Bericht</h4>
                                <textarea id="pendingStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">🔄 UW BOEKING WACHT OP BEVESTIGING

Uw boeking wordt binnen 24 uur door ons team beoordeeld. U ontvangt een bevestiging of annulering per email.

Voor urgente boekingen kunt u ons direct bellen.</textarea>
                            </div>
                        </div>

                        <!-- Template 2: Confirmed -->
                        <div id="confirmedTemplate" class="template-content" style="display: none;">
                            <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">✅ Template 2: Bevestiging Email</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt verstuurd wanneer een boeking van 'unconfirmed' naar 'confirmed' wordt gezet.</p>
                            </div>

                            <!-- Subject Line -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">📧 Email Onderwerp</h4>
                                <input type="text" id="confirmedSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="✅ Uw rit is bevestigd - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Welcome Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">🎉 Bevestigingsbericht</h4>
                                <textarea id="confirmedWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Goed nieuws! Uw taxi boeking is bevestigd.

We hebben uw reservering definitief bevestigd. Hieronder vindt u alle details van uw rit.</textarea>
                            </div>

                            <!-- Status Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">✅ Bevestiging Details</h4>
                                <textarea id="confirmedStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">✅ UW RIT IS DEFINITIEF BEVESTIGD

Een chauffeur is aan uw rit toegewezen. U ontvangt 24 uur voor vertrek de contactgegevens van uw chauffeur.

Zorg ervoor dat u op tijd klaar staat op de afgesproken locatie.</textarea>
                            </div>
                        </div>

                        <!-- Template 3: Cancelled -->
                        <div id="cancelledTemplate" class="template-content" style="display: none;">
                            <div style="background: #ffebee; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f44336;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">❌ Template 3: Annulering Email</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt verstuurd wanneer een boeking wordt geannuleerd.</p>
                            </div>

                            <!-- Subject Line -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">📧 Email Onderwerp</h4>
                                <input type="text" id="cancelledSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="❌ Uw rit is geannuleerd - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Cancellation Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">❌ Annuleringsbericht</h4>
                                <textarea id="cancelledWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Helaas moeten wij u mededelen dat uw taxi boeking is geannuleerd.

Hieronder vindt u de details van de geannuleerde rit.</textarea>
                            </div>

                            <!-- Reason Message -->
                            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">📋 Annulering Reden</h4>
                                <textarea id="cancelledStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">❌ UW RIT IS GEANNULEERD

Mogelijke redenen voor annulering:
- Geen beschikbare chauffeurs op het gevraagde tijdstip
- De route valt buiten ons servicegebied
- Technische problemen

Voor vragen kunt u contact met ons opnemen. We helpen u graag met een alternatieve oplossing.</textarea>
                            </div>
                        </div>

                        <!-- Shared Contact Information -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">📞 Contact Informatie</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Telefoon:</label>
                                    <input type="text" id="templatePhone" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="+32 xxx xx xx xx" placeholder="+32 xxx xx xx xx">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">WhatsApp:</label>
                                    <input type="text" id="templateWhatsApp" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="+32 xxx xx xx xx" placeholder="+32 xxx xx xx xx">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Email:</label>
                                <input type="email" id="templateEmail" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="info@airporttransfer.be" placeholder="info@airporttransfer.be">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Extra instructies:</label>
                                <textarea id="templateContactInfo" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Voor vragen of wijzigingen kunt u contact opnemen...">Voor vragen of wijzigingen kunt u ons bereiken via bovenstaande contactgegevens.

Bij no-show of annulering binnen 2 uur voor vertrek kunnen kosten in rekening worden gebracht.</textarea>
                            </div>
                        </div>

                        <!-- Booking Modification Settings -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">✏️ Boeking Wijzigingen</h4>
                            <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #28a745;">
                                <p style="margin: 0; color: #155724; font-size: 14px;">
                                    <strong>📋 Wijziging Link:</strong> In bevestigde emails wordt automatisch een link toegevoegd waarmee klanten hun boeking kunnen wijzigen.
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; align-items: end;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Deadline (uur voor vertrek):</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustModificationDeadline(-1)">-</button>
                                        <input type="number" id="templateModificationDeadline" style="width: 80px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px; text-align: center;" value="24" min="1" max="168" placeholder="24">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustModificationDeadline(1)">+</button>
                                        <span style="color: #6c757d; font-size: 14px;">uur</span>
                                    </div>
                                    <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                        Standaard: 24 uur voor vertrek
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Preview tekst:</label>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; color: #6c757d; font-size: 14px; border: 1px solid #e9ecef;">
                                        "U kunt uw boeking nog wijzigen tot <strong id="deadlinePreview">24</strong> uur voor uw vertrek."
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Company Information -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">🏢 Bedrijfsinformatie</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Bedrijfsnaam:</label>
                                    <input type="text" id="templateCompanyName" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Marcel's Taxi Service" placeholder="Marcel's Taxi Service">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Website:</label>
                                    <input type="text" id="templateWebsite" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="www.airporttransfer.be" placeholder="www.airporttransfer.be">
                                </div>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Footer bericht:</label>
                                <textarea id="templateFooter" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;" placeholder="Marcel's Taxi - Professioneel vervoer sinds...">Marcel's Taxi - Professioneel vervoer
Betrouwbaar • Comfortabel • Op tijd

Bedankt voor het kiezen van onze service!</textarea>
                            </div>
                        </div>

                        <!-- Save and Preview -->
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="button" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin-right: 15px; cursor: pointer;" onclick="previewEmailTemplate()">
                                👁️ Preview Email
                            </button>
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                💾 Save Email Template
                            </button>
                        </div>
                    </form>

                    <div id="emailTemplateStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Translation Section -->
                <div id="translation-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ⚙️ Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">🌐 Translation - Email Teksten</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>📧 Professional Email Layout</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Configureer alle teksten die in de booking emails verschijnen. Deze instellingen bepalen hoe klanten jullie emails ontvangen.</p>
                    </div>

                    <form id="translationForm" onsubmit="saveTranslation(event)">
                        <!-- Company Header -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">🏢 Bedrijf Header</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Bedrijfsnaam in Email Header:</label>
                                    <input type="text" id="translationCompanyName" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Taxi Leuven" placeholder="Taxi Leuven">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Logo URL (optioneel):</label>
                                    <input type="text" id="translationLogoUrl" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" placeholder="https://example.com/logo.png">
                                </div>
                            </div>
                        </div>

                        <!-- Main Message -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">📨 Hoofdbericht</h4>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Status bericht (eerste regel):</label>
                                <input type="text" id="translationStatusLine" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Uw booking wacht op bevestiging." placeholder="Uw booking wacht op bevestiging.">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Bevestigings bericht:</label>
                                <textarea id="translationMainMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;" placeholder="Bedankt voor uw booking bij Taxi Leuven. Uw reservatienummer is...">Bedankt voor uw booking bij Taxi Leuven. Uw reservatienummer is [BOOKING_ID].

Een bevestigingsmail wordt naar uw e-mailadres verzonden binnen 1 uur. ALS U GEEN EMAIL ONTVANGEN HEBT, GELIEVE MET ONS CONTACT OP TE NEMEN!</textarea>
                            </div>
                        </div>

                        <!-- Section Labels -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">🏷️ Sectie Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Reis Sectie:</label>
                                    <input type="text" id="translationTripSection" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Reis" placeholder="Reis">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Klant Sectie:</label>
                                    <input type="text" id="translationClientSection" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Klant" placeholder="Klant">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Reservatie Sectie:</label>
                                    <input type="text" id="translationReservationSection" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Reservatie" placeholder="Reservatie">
                                </div>
                            </div>
                        </div>

                        <!-- Field Labels -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">📝 Veld Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Datum & tijd:</label>
                                    <input type="text" id="translationDateTime" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Datum & tijd:" placeholder="Datum & tijd:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Ophaallocatie:</label>
                                    <input type="text" id="translationPickupLocation" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Ophaallocatie:" placeholder="Ophaallocatie:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Bestemming:</label>
                                    <input type="text" id="translationDestination" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Bestemming:" placeholder="Bestemming:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Voertuig:</label>
                                    <input type="text" id="translationVehicle" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Voertuig:" placeholder="Voertuig:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Passagiers:</label>
                                    <input type="text" id="translationPassengers" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Passagiers:" placeholder="Passagiers:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Naam:</label>
                                    <input type="text" id="translationName" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Naam:" placeholder="Naam:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Telefoonnummer:</label>
                                    <input type="text" id="translationPhone" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Telefoonnummer:" placeholder="Telefoonnummer:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">E-mail:</label>
                                    <input type="text" id="translationEmail" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="E-mail:" placeholder="E-mail:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Referentie-ID:</label>
                                    <input type="text" id="translationReferenceId" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Referentie-ID:" placeholder="Referentie-ID:">
                                </div>
                            </div>
                        </div>

                        <!-- Pricing Labels -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">💰 Prijs Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Boekingsdatum:</label>
                                    <input type="text" id="translationBookingDate" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Boekingsdatum:" placeholder="Boekingsdatum:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Samenvatting:</label>
                                    <input type="text" id="translationSummary" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Samenvatting:" placeholder="Samenvatting:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Totaal:</label>
                                    <input type="text" id="translationTotal" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Totaal:" placeholder="Totaal:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Betalingen:</label>
                                    <input type="text" id="translationPayments" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Betalingen:" placeholder="Betalingen:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Verschuldigd bedrag:</label>
                                    <input type="text" id="translationOwedAmount" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Verschuldigd bedrag:" placeholder="Verschuldigd bedrag:">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 500; margin-bottom: 8px;">Status:</label>
                                    <input type="text" id="translationPaymentStatus" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Pending" placeholder="Pending">
                                </div>
                            </div>
                        </div>

                        <!-- Footer Messages -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">📄 Footer Berichten</h4>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Annulatie regels:</label>
                                <textarea id="translationCancellation" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Annulatie binnen 24 uur...">Annulatie binnen 24 uur: Bij annulering binnen 24 uur voor de geplande rit wordt het volledige bedrag van de rit in rekening gebracht.</textarea>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Wijzigingen regels:</label>
                                <textarea id="translationChanges" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Wijzigingen binnen 24 uur...">Wijzigingen binnen 24 uur: Voor aanpassingen aan een bestaande reservering binnen 24 uur (bijvoorbeeld door het missen van een vlucht) wordt een toeslag van €30 gerekend.</textarea>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Booking advies:</label>
                                <textarea id="translationBookingAdvice" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Het rechtstreeks reserveren van een rit...">Bookingsregels: Het rechtstreeks reserveren van een rit via één van onze chauffeurs is niet toegestaan. Voor een verzekerde en kwaliteitsvolle dienstverlening verzoeken wij u uw taxi uitsluitend via ons officiële systeem te boeken.</textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 8px;">Chauffeur informatie:</label>
                                <textarea id="translationDriverInfo" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Eén dag voor uw vertrek...">Eén dag voor uw vertrek sturen wij u het nummer van de chauffeur, zodra wij onze planning hebben gemaakt.</textarea>
                            </div>
                        </div>

                        <!-- Save and Preview -->
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="button" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin-right: 15px; cursor: pointer;" onclick="previewTranslationEmail()">
                                👁️ Preview Professional Email
                            </button>
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                💾 Save Translation Settings
                            </button>
                        </div>
                    </form>

                    <div id="translationStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Google Section -->
                <div id="google-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ⚙️ Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">🌐 Google API Configuration</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;">🗺️ Google Maps API</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Maps API Key:</label>
                            <input type="text" id="googleMapsApiKey" placeholder="Enter your Google Maps JavaScript API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for map display and route calculations</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Places API Key:</label>
                            <input type="text" id="googlePlacesApiKey" placeholder="Enter your Google Places API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for address autocomplete and place search</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Directions API Key:</label>
                            <input type="text" id="googleDirectionsApiKey" placeholder="Enter your Google Directions API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for route calculation and distance/time estimation</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Geocoding API Key:</label>
                            <input type="text" id="googleGeocodingApiKey" placeholder="Enter your Google Geocoding API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for converting addresses to coordinates</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Default Location:</label>
                            <input type="text" id="defaultLocation" placeholder="Enter default pickup location (e.g., Brussels, Belgium)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Default location for taxi services</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Service Area:</label>
                            <input type="text" id="serviceArea" placeholder="Enter service area (e.g., Brussels Metropolitan Area)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Geographic area where taxi services are available</small>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="saveGoogleSettings()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">💾 Save Settings</button>
                            <button onclick="testGoogleMapsApi()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">🔍 Test Google Maps API</button>
                        </div>
                        
                        <div id="googleStatus" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border: 1px solid #ffeaa7;">
                        <h4 style="color: #856404; margin-bottom: 10px;">ℹ️ Google Maps Setup Instructions</h4>
                        <ol style="color: #856404; margin-bottom: 0;">
                            <li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color: #007bff;">Google Cloud Console</a></li>
                            <li>Create a new project or select existing one</li>
                            <li>Enable Google Maps JavaScript API</li>
                            <li>Create credentials (API key)</li>
                            <li>Add API key restrictions for security</li>
                            <li>Copy the API key and paste it above</li>
                        </ol>
                    </div>
                </div>

                <!-- Bookings Sections -->
                <div id="next-24h-section" class="content-section">
                    <h2>📋 Next 24 Hours</h2>
                    <p>Confirmed bookings for the next 24 hours</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadNext24hBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📤 <span style="margin-left: 5px;">Export</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="next24hCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 confirmed</span>
                        </div>
                    </div>
                    
                    <div id="next24hBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="next24hTableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading confirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="latest-section" class="content-section">
                    <h2>📋 Latest Bookings</h2>
                    <p>Most recent booking requests</p>
                </div>

                <div id="unconfirmed-section" class="content-section">
                    <h2>📋 Unconfirmed Bookings</h2>
                    <p>New bookings awaiting confirmation</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <button style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px;" onclick="window.location.href='booking-exact.html'">
                            ➕ Add new booking
                        </button>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadUnconfirmedBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📥 <span style="margin-left: 5px;">Import</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                📤 <span style="margin-left: 5px;">Export</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <input type="text" placeholder="Filter / Search" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px; width: 200px;">
                            <select style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px;">
                                <option>🔄 Sync source</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="unconfirmedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">
                                        <input type="checkbox" style="margin-right: 8px;">Info
                                    </th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Payments</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status ⓘ</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle type</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver income ⓘ</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Passenger charge ⓘ</th>
                                </tr>
                            </thead>
                            <tbody id="unconfirmedTableBody">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading unconfirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pricing Sections -->
                <div id="distance-time-section" class="content-section">
                    <h2>💰 Distance & Time Pricing</h2>
                    <p>Configure pricing for each vehicle type - prices will be used in the booking system</p>
                    
                    <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="loadVehiclePricing()">🔄 Load Vehicle Pricing</button>
                        <button class="btn btn-success" onclick="saveAllPricing()">💾 Save All Changes</button>
                        <button class="btn" style="background: #6c757d; color: white;" onclick="resetToDefaults()">🔄 Reset to Defaults</button>
                    </div>
                    
                    <div id="vehiclePricingContainer" style="margin-top: 30px;">
                        <div style="text-align: center; padding: 40px; color: #6c757d; border: 2px dashed #dee2e6; border-radius: 8px;">
                            <h3>🚗 Loading vehicles from Types of Vehicles...</h3>
                            <p>Vehicle pricing cards will appear here automatically</p>
                        </div>
                    </div>
                </div>

                <!-- Item Surcharge Section -->
                <div id="item-surcharge-section" class="content-section">
                    <h2>💰 Item Surcharge</h2>
                    <p>All prices are displayed in EUR (€) currency.</p>
                    
                    <!-- Fixed Items -->
                    <div style="margin: 30px 0;">
                        <div id="fixedItemsContainer">
                            <!-- Fixed items will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Additional Options -->
                    <div style="margin: 30px 0;">
                        <h3>Additional options (e.g. Newspaper, Bottle of water, etc.)</h3>
                        <div id="additionalOptionsContainer">
                            <!-- Additional options will be rendered here -->
                        </div>
                        <div style="margin: 20px 0;">
                            <button class="btn btn-success" onclick="addNewSurchargeItem()">+ New</button>
                            <button class="btn btn-primary" onclick="saveSurchargeItems()" style="margin-left: 10px;">💾 Save</button>
                        </div>
                    </div>
                </div>

                <!-- Meet and Greet Section -->
                <div id="meet-and-greet-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin-bottom: 30px; padding-bottom: 20px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - 💰 Pricing</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">🤝 Meet and Greet Locations</h3>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>🤝 Meet and Greet Locatie Beheer</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Voeg luchthavens, stations en hotels toe waar Meet & Greet service beschikbaar is. Het systeem past automatisch de Meet & Greet toeslag toe wanneer iemand boekt vanaf deze locaties.</p>
                    </div>

                    <!-- Connection with Item Surcharge -->
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                        <h4 style="color: #155724; margin-bottom: 10px;">🔗 Verbinding met Item Surcharge</h4>
                        <p style="margin: 5px 0; color: #155724; font-size: 14px;">
                            <strong>Meet & Greet toeslag:</strong> €<span id="meetGreetSurchargePrice">5.00</span> 
                            <span id="meetGreetSurchargeStatus" style="margin-left: 10px; padding: 2px 8px; border-radius: 4px; font-size: 12px;"></span>
                        </p>
                        <p style="margin: 0; color: #155724; font-size: 13px;">
                            Deze prijs wordt automatisch toegepast wanneer de ophaallocatie een geregistreerde Meet & Greet locatie is.
                        </p>
                    </div>

                    <!-- Location Types Tabs -->
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; border-bottom: 2px solid #e9ecef;">
                            <button class="location-tab" data-type="airports" onclick="switchLocationTab('airports')" 
                                    style="padding: 12px 24px; border: none; background: #007bff; color: white; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">
                                ✈️ Luchthavens
                            </button>
                            <button class="location-tab" data-type="stations" onclick="switchLocationTab('stations')" 
                                    style="padding: 12px 24px; border: none; background: #6c757d; color: white; border-radius: 8px 8px 0 0; cursor: pointer; margin-left: 2px;">
                                🚉 Stations
                            </button>
                            <button class="location-tab" data-type="hotels" onclick="switchLocationTab('hotels')" 
                                    style="padding: 12px 24px; border: none; background: #6c757d; color: white; border-radius: 8px 8px 0 0; cursor: pointer; margin-left: 2px;">
                                🏨 Hotels
                            </button>
                        </div>
                    </div>

                    <!-- Location Management Container -->
                    <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div id="airportsTab" class="location-tab-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">✈️ Luchthaven Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('airports')">+ Nieuwe Luchthaven</button>
                            </div>
                            <div id="airportsList" class="locations-list">
                                <!-- Airport locations will be rendered here -->
                            </div>
                        </div>

                        <div id="stationsTab" class="location-tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">🚉 Station Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('stations')">+ Nieuw Station</button>
                            </div>
                            <div id="stationsList" class="locations-list">
                                <!-- Station locations will be rendered here -->
                            </div>
                        </div>

                        <div id="hotelsTab" class="location-tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">🏨 Hotel Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('hotels')">+ Nieuw Hotel</button>
                            </div>
                            <div id="hotelsList" class="locations-list">
                                <!-- Hotel locations will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="saveMeetAndGreetSettings()">
                            💾 Opslaan Meet & Greet Instellingen
                        </button>
                    </div>

                    <div id="meetGreetStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <div id="deposit-payments-section" class="content-section">
                    <h2>💰 Deposit Payments</h2>
                    <p>Configure security deposit settings</p>
                </div>

                <!-- Other sections -->
                <div id="cancelled-section" class="content-section">
                    <h2>❌ Cancelled Bookings</h2>
                    <p>Cancelled and deleted bookings</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCancelledBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCancelled()">
                                🗑️ <span style="margin-left: 5px;">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="cancelledCount" style="padding: 8px 12px; background: #dc3545; color: white; border-radius: 4px; font-weight: 500;">0 cancelled</span>
                        </div>
                    </div>
                    
                    <div id="cancelledBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Reason</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Cancelled Date</th>
                                </tr>
                            </thead>
                            <tbody id="cancelledTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading cancelled bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Bookings Section -->
                <div id="all-bookings-section" class="content-section">
                    <h2>📋 All Bookings</h2>
                    <p>Complete history of all bookings from customer and dispatch systems</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadAllBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <select id="allBookingsFilter" onchange="filterAllBookings()" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px;">
                                <option value="all">All Bookings</option>
                                <option value="customer">Customer Bookings</option>
                                <option value="dispatch">Dispatch Bookings</option>
                                <option value="confirmed">Confirmed Only</option>
                                <option value="unconfirmed">Unconfirmed Only</option>
                                <option value="cancelled">Cancelled Only</option>
                            </select>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="allBookingsCount" style="padding: 8px 12px; background: #007bff; color: white; border-radius: 4px; font-weight: 500;">0 bookings</span>
                        </div>
                    </div>
                    
                    <div id="allBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Customer Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Route</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Source</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Created</th>
                                </tr>
                            </thead>
                            <tbody id="allBookingsTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading all bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Completed Bookings Section -->
                <div id="completed-section" class="content-section">
                    <h2>✅ Completed Bookings</h2>
                    <p>Successfully completed trips and services</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCompletedBookings()">
                                🔄 <span style="margin-left: 5px;">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCompleted()">
                                🗑️ <span style="margin-left: 5px;">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="completedCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 completed</span>
                        </div>
                    </div>
                    
                    <div id="completedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Actions</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Customer Info</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Route</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Date & Time</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Driver</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Vehicle</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Completed Date</th>
                                </tr>
                            </thead>
                            <tbody id="completedTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                        Loading completed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="users-section" class="content-section">
                    <h2>👥 Users</h2>
                    <p>Manage users, drivers, and administrators</p>
                </div>

                <div id="feedback-section" class="content-section">
                    <h2>💬 Customer Feedback</h2>
                    <p>View and manage customer feedback</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Edit Modal -->
    <div class="modal-overlay" id="bookingEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📝 Edit Booking - <span id="modalBookingId">BK123456</span></h2>
                <button class="modal-close" onclick="closeBookingModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Customer Information -->
                <div class="edit-section">
                    <h3>👤 Customer Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>First Name</label>
                            <input type="text" id="editFirstName" placeholder="Enter first name">
                        </div>
                        <div class="edit-field">
                            <label>Last Name</label>
                            <input type="text" id="editLastName" placeholder="Enter last name">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Email Address</label>
                            <input type="email" id="editEmail" placeholder="customer@email.com">
                        </div>
                        <div class="edit-field">
                            <label>Phone Number</label>
                            <input type="tel" id="editPhone" placeholder="+32 xxx xx xx xx">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Number of Passengers</label>
                            <select id="editPassengers">
                                <option value="1">1 Passenger</option>
                                <option value="2">2 Passengers</option>
                                <option value="3">3 Passengers</option>
                                <option value="4">4 Passengers</option>
                                <option value="5">5 Passengers</option>
                                <option value="6">6 Passengers</option>
                                <option value="7">7 Passengers</option>
                                <option value="8">8 Passengers</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Payment Method</label>
                            <select id="editPaymentMethod">
                                <option value="cash">Cash</option>
                                <option value="card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Trip Information -->
                <div class="edit-section">
                    <h3>🚗 Trip Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>From Location</label>
                            <input type="text" id="editFromLocation" placeholder="Pickup address">
                        </div>
                        <div class="edit-field">
                            <label>To Location</label>
                            <input type="text" id="editToLocation" placeholder="Destination address">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Travel Date</label>
                            <input type="date" id="editTravelDate">
                        </div>
                        <div class="edit-field">
                            <label>Travel Time</label>
                            <input type="time" id="editTravelTime">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Vehicle Type</label>
                            <select id="editVehicleType">
                                <option value="saloon">Saloon</option>
                                <option value="estate">Estate</option>
                                <option value="minivan">Minivan</option>
                                <option value="minivan_long">Minivan Long</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Return Trip</label>
                            <select id="editReturnTrip">
                                <option value="false">One Way</option>
                                <option value="true">Return Trip</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Booking Details -->
                <div class="edit-section">
                    <h3>📋 Booking Details</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Booking Status</label>
                            <select id="editBookingStatus">
                                <option value="unconfirmed">Unconfirmed</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Price (€)</label>
                            <input type="number" id="editPrice" step="0.01" placeholder="50.00">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Driver</label>
                            <input type="text" id="editDriver" placeholder="Assign driver">
                        </div>
                    </div>
                    <div class="edit-field">
                        <label>Special Instructions</label>
                        <textarea id="editSpecialInstructions" rows="3" placeholder="Add any special instructions or notes..."></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeBookingModal()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="deleteBooking()">Delete Booking</button>
                <button class="modal-btn modal-btn-success" onclick="confirmBookingFromModal()">✅ Confirm Booking</button>
                <button class="modal-btn modal-btn-primary" onclick="saveBookingChanges()">💾 Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        console.log('🚀 Admin panel JavaScript loaded');
        
        // Define critical functions immediately to prevent "not defined" errors
        window.showSection = function(sectionName) {
            console.log('📍 Showing section:', sectionName);
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    pageTitle.textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                }
                console.log('✅ Section shown:', sectionName);
                
                // Special section loading
                if (sectionName === 'distance-time') {
                    setTimeout(() => loadVehiclePricing(), 200);
                }
                if (sectionName === 'unconfirmed') {
                    setTimeout(() => loadUnconfirmedBookings(), 200);
                }
                if (sectionName === 'next-24h') {
                    setTimeout(() => loadNext24hBookings(), 200);
                }
                if (sectionName === 'cancelled') {
                    setTimeout(() => loadCancelledBookings(), 200);
                }
            } else {
                console.error('❌ Section not found:', sectionName + '-section');
            }
        };

        window.toggleMenu = function(menuName) {
            console.log('🔧 Toggling menu:', menuName);
            
            const menu = document.getElementById(menuName + '-menu');
            if (!menu) {
                console.error('❌ Menu not found:', menuName + '-menu');
                return;
            }
            
            console.log('📋 Menu element found:', menu.id);
            
            // Close other menus
            const allMenus = document.querySelectorAll('.nav-submenu');
            allMenus.forEach(m => {
                if (m.id !== menuName + '-menu') {
                    m.classList.remove('show');
                }
            });
            
            // Toggle current menu
            const isVisible = menu.classList.contains('show');
            if (isVisible) {
                menu.classList.remove('show');
                console.log('❌ Menu hidden:', menuName);
            } else {
                menu.classList.add('show');
                console.log('✅ Menu shown:', menuName);
            }
        };

        // Removed duplicate functions - using window properties above

        function updateTestResults(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            // Try to find test results div, if not found, just log to console
            const results = document.getElementById('testResults');
            if (results) {
                results.innerHTML = `[${timestamp}] ${message}<br>${results.innerHTML}`;
            }
        }

        // Add manual menu test function
        window.testMenus = function() {
            console.log('🧪 Manual menu testing started...');
            
            const menus = ['bookings', 'settings', 'pricing', 'reports'];
            menus.forEach(menuName => {
                console.log(`\n--- Testing ${menuName} menu ---`);
                const menu = document.getElementById(menuName + '-menu');
                if (menu) {
                    console.log(`✅ ${menuName} menu exists`);
                    console.log(`Current classes:`, menu.className);
                    console.log(`Display style:`, window.getComputedStyle(menu).display);
                } else {
                    console.log(`❌ ${menuName} menu NOT found`);
                }
            });
            
            console.log('\n🔍 All available menu IDs:');
            document.querySelectorAll('.nav-submenu').forEach(menu => {
                console.log(`  - ${menu.id}`);
            });
            
            console.log('\n🧪 Manual menu testing completed. Try: testMenus() in console');
        };


        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                window.location.href = '/';
            }
        }

        // Vehicle Pricing System Functions
        function loadVehiclePricing() {
            console.log('🔄 Loading vehicle pricing from Types of Vehicles...');
            updateTestResults('🔄 Loading vehicles from Types of Vehicles...');
            
            // Load vehicles from Types of Vehicles admin panel
            const savedVehicles = localStorage.getItem('taxiVehicles');
            let vehicles = [];
            
            if (savedVehicles) {
                try {
                    vehicles = JSON.parse(savedVehicles);
                    console.log('✅ Loaded', vehicles.length, 'vehicles from Types of Vehicles');
                    updateTestResults(`✅ Found ${vehicles.length} vehicles in Types of Vehicles`);
                } catch (e) {
                    console.error('❌ Error parsing saved vehicles:', e);
                    updateTestResults('❌ Error loading vehicles from Types of Vehicles');
                }
            }
            
            // If no vehicles found, create default vehicles first
            if (vehicles.length === 0) {
                console.log('⚠️ No vehicles found, creating default vehicles...');
                updateTestResults('⚠️ No vehicles found, creating default vehicles...');
                createDefaultVehicles();
                vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            }
            if (vehicles.length === 0) {
                updateTestResults('⚠️ No vehicles found - need to add vehicles first');
                const container = document.getElementById('vehiclePricingContainer');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px 40px; border: 2px dashed #dee2e6; border-radius: 12px; background: #f8f9fa;">
                            <div style="font-size: 48px; margin-bottom: 20px;">🚗</div>
                            <h3 style="color: #495057; margin-bottom: 15px;">Geen voertuigen gevonden</h3>
                            <p style="color: #6c757d; margin-bottom: 25px; font-size: 16px;">
                                Je moet eerst voertuigen toevoegen in <strong>Types of Vehicles</strong><br>
                                voordat je prijzen kunt instellen.
                            </p>
                            <button class="btn btn-primary" onclick="showSection('types-of-vehicles')" style="margin-right: 10px;">
                                🚗 Ga naar Types of Vehicles
                            </button>
                            <button class="btn" style="background: #6c757d; color: white;" onclick="window.open('admin-vehicles.html', '_blank')">
                                🔧 Open Vehicle Manager
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            // Load saved pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            const pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            const container = document.getElementById('vehiclePricingContainer');
            if (!container) {
                console.error('❌ Container not found!');
                return;
            }
            
            // Create dynamic pricing cards based on actual vehicles from Types of Vehicles
            let htmlContent = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">';
            
            vehicles.forEach(vehicle => {
                // Get existing pricing or set defaults
                const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                
                // Determine vehicle image source - NEVER overwrite custom uploads
                let vehicleImage = '🚗'; // fallback emoji
                if (vehicle.image) {
                    if (vehicle.image.startsWith('data:')) {
                        // Base64 image uploaded from laptop - PROTECTED!
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`📷 PROTECTED: Using custom uploaded image for ${vehicle.name}`);
                    } else if (vehicle.image.startsWith('http') && !vehicle.image.includes('unsplash')) {
                        // Custom external URL image - not default
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`🌐 Using custom external image for ${vehicle.name}`);
                    } else if (vehicle.image.includes('unsplash')) {
                        // Skip default unsplash images - use emoji instead
                        vehicleImage = '🚗';
                        updateTestResults(`⚠️ Skipping default image for ${vehicle.name} - using emoji`);
                    }
                } else {
                    updateTestResults(`📷 No image set for ${vehicle.name} - using emoji`);
                }
                
                htmlContent += `
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; margin-bottom: 20px;">
                            <div style="width: 100px; height: 70px; background: #f8f9fa; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; overflow: hidden; border: 1px solid #dee2e6;">
                                ${vehicleImage}
                            </div>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #2c3e50;">${vehicle.name}</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">${vehicle.description || 'Professional taxi service'}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Minimum prijs</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', -0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="minimum_${vehicle.id}" value="${pricing.minimumPrice.toFixed(2)}" 
                                           step="0.50" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'minimum', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', 0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Prijs per km</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', -0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="perKm_${vehicle.id}" value="${pricing.pricePerKm.toFixed(2)}" 
                                           step="0.10" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'perKm', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', 0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f1f3f4; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #6c757d;">
                                Capaciteit: ${vehicle.capacity?.passengers || 4} personen
                            </span>
                            <span style="font-size: 12px; color: ${vehicle.active ? '#28a745' : '#dc3545'}; font-weight: 500;">
                                ${vehicle.active ? '✅ Actief' : '❌ Inactief'}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            htmlContent += '</div>';
            container.innerHTML = htmlContent;
            
            console.log(`✅ Created pricing cards for ${vehicles.length} vehicles from Types of Vehicles`);
            updateTestResults(`✅ Pricing loaded for ${vehicles.length} vehicles from Types of Vehicles`);
        }
        
        function adjustDynamicPrice(vehicleId, type, amount) {
            const inputId = type === 'minimum' ? `minimum_${vehicleId}` : `perKm_${vehicleId}`;
            const input = document.getElementById(inputId);
            if (input) {
                const currentValue = parseFloat(input.value) || 0;
                const newValue = Math.max(0, currentValue + amount);
                input.value = newValue.toFixed(2);
                updateDynamicPricing(vehicleId, type, newValue);
                
                // Get vehicle name for display
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const vehicle = vehicles.find(v => v.id === vehicleId);
                const vehicleName = vehicle ? vehicle.name : vehicleId;
                
                updateTestResults(`💰 ${vehicleName} ${type} price: €${newValue.toFixed(2)}`);
            }
        }
        
        function updateDynamicPricing(vehicleId, type, value) {
            // Load current pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            let pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            // Initialize vehicle pricing if not exists
            if (!pricingData[vehicleId]) {
                pricingData[vehicleId] = { minimumPrice: 15.00, pricePerKm: 1.50 };
            }
            
            // Update the specific price
            if (type === 'minimum') {
                pricingData[vehicleId].minimumPrice = parseFloat(value) || 0;
            } else if (type === 'perKm') {
                pricingData[vehicleId].pricePerKm = parseFloat(value) || 0;
            }
            
            // Save back to localStorage
            localStorage.setItem('vehiclePricing', JSON.stringify(pricingData));
            
            // Trigger sync to booking system
            syncDynamicPricingToBookingSystem();
            
            console.log(`Updated ${type} pricing for vehicle ${vehicleId}: €${value}`);
        }
        
        function syncDynamicPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data using real vehicle data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Also create vehicle data for booking system - PROTECT custom images
            const bookingSystemVehicles = vehicles
                .filter(v => v.active && (v.display === 'Frontend & Backend' || v.display === 'Frontend only'))
                .map(v => {
                    const pricing = pricingData[v.id] || { minimumPrice: 25.00, pricePerKm: 2.50 };
                    
                    // Protect custom uploaded images - never overwrite them
                    let protectedImage = v.image;
                    if (v.image && v.image.includes('unsplash')) {
                        // Remove default unsplash images - let booking system handle fallback
                        protectedImage = null;
                    }
                    
                    return {
                        id: v.id,
                        name: v.name,
                        price: pricing.minimumPrice, // Use minimum price as base price
                        passengers: `1-${v.capacity?.passengers || 4} passengers`,
                        luggage: `1-${v.capacity?.luggage || 2} large bags`,
                        handLuggage: `1-${v.capacity?.handLuggage || 2} small bags`,
                        image: protectedImage, // Protected from overwrites
                        capacity: {
                            passengers: v.capacity?.passengers || 4,
                            luggage: v.capacity?.luggage || 2,
                            handLuggage: v.capacity?.handLuggage || 2,
                            wheelchairs: v.capacity?.wheelchairs || 0,
                            childSeats: v.capacity?.childSeats || 0
                        },
                        description: v.description || '',
                        active: v.active,
                        lastUpdated: new Date().toISOString()
                    };
                });
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingSystemVehicles));
            
            console.log('💰 Dynamic pricing synced to booking system:', bookingSystemPricing);
            console.log('🚗 Vehicle data synced to booking system:', bookingSystemVehicles.length, 'vehicles');
            updateTestResults(`🔄 Synced ${Object.keys(bookingSystemPricing).length} vehicles with pricing + ${bookingSystemVehicles.length} vehicles to booking system`);
            
            // Update timestamp to trigger booking system refresh
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Trigger immediate refresh in booking system if it's open
            try {
                window.postMessage({ 
                    type: 'PRICING_UPDATED', 
                    vehicles: bookingSystemVehicles,
                    pricing: bookingSystemPricing,
                    timestamp: Date.now()
                }, '*');
                console.log('📡 Sent pricing update message to booking system');
            } catch (e) {
                console.log('⚠️ Could not send refresh message:', e.message);
            }
        }
        
        function saveAllPricing() {
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            let savedCount = 0;
            
            vehicles.forEach(vehicle => {
                const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                
                if (minimumInput && perKmInput) {
                    updateDynamicPricing(vehicle.id, 'minimum', minimumInput.value);
                    updateDynamicPricing(vehicle.id, 'perKm', perKmInput.value);
                    savedCount++;
                }
            });
            
            alert(`✅ Alle prijzen opgeslagen!\n\n${savedCount} voertuigen bijgewerkt\nPrijzen zijn gesynchroniseerd met het boekingssysteem.`);
            updateTestResults(`✅ Saved pricing for ${savedCount} vehicles from Types of Vehicles`);
        }
        
        function createDefaultVehicles() {
            console.log('🚗 Creating default vehicles and pricing...');
            
            const defaultVehicles = [
                {
                    id: 'saloon',
                    name: 'Saloon',
                    description: 'Comfortable sedan for city rides',
                    active: true,
                    image: '',
                    passengers: 4,
                    luggage: 2,
                    handBags: 4
                },
                {
                    id: 'estate',
                    name: 'Estate',
                    description: 'Spacious estate car for extra luggage',
                    active: true,
                    image: '',
                    passengers: 4,
                    luggage: 4,
                    handBags: 4
                },
                {
                    id: 'minivan',
                    name: 'Minivan',
                    description: 'Large vehicle for groups',
                    active: true,
                    image: '',
                    passengers: 6,
                    luggage: 4,
                    handBags: 6
                },
                {
                    id: 'minivan_long',
                    name: 'Minivan Long',
                    description: 'Extra large vehicle for big groups',
                    active: true,
                    image: '',
                    passengers: 8,
                    luggage: 6,
                    handBags: 8
                }
            ];
            
            // Save vehicles to localStorage
            localStorage.setItem('taxiVehicles', JSON.stringify(defaultVehicles));
            
            // Create default pricing (whole euros)
            const defaultPricing = {
                saloon: { minimumPrice: 45, pricePerKm: 1.50 },
                estate: { minimumPrice: 55, pricePerKm: 1.80 },
                minivan: { minimumPrice: 65, pricePerKm: 2.00 },
                minivan_long: { minimumPrice: 85, pricePerKm: 2.50 }
            };
            
            // Save pricing to localStorage
            localStorage.setItem('vehiclePricing', JSON.stringify(defaultPricing));
            
            console.log('✅ Default vehicles and pricing created');
            updateTestResults('✅ Created 4 default vehicles with pricing');
        }

        function resetToDefaults() {
            if (confirm('Weet je zeker dat je alle prijzen wilt resetten naar de standaardwaarden?')) {
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                
                vehicles.forEach(vehicle => {
                    const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                    const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                    
                    if (minimumInput && perKmInput) {
                        minimumInput.value = '15.00';
                        perKmInput.value = '1.50';
                        updateDynamicPricing(vehicle.id, 'minimum', 15.00);
                        updateDynamicPricing(vehicle.id, 'perKm', 1.50);
                    }
                });
                
                alert('✅ Prijzen gereset naar standaardwaarden (€15 min, €1.50/km)');
                updateTestResults('🔄 All vehicles reset to default pricing');
            }
        }
        
        function syncPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            console.log('Pricing synced to booking system:', bookingSystemPricing);
        }
        
        
        function adjustStaticPrice(fieldId, amount) {
            // This function is no longer used - vehicles are loaded dynamically from Types of Vehicles
            console.log('ℹ️ Please use the dynamic vehicles from Types of Vehicles instead');
        }
        
        function savePricing() {
            // This function is no longer used with dynamic pricing
            console.log('ℹ️ Using dynamic pricing - no static save needed');
        }

        // Unconfirmed Bookings Functions
        function loadUnconfirmedBookings() {
            console.log('📋 Loading unconfirmed bookings...');
            
            const tableBody = document.getElementById('unconfirmedTableBody');
            
            if (!tableBody) {
                console.error('❌ Unconfirmed table body not found');
                return;
            }
            
            // Get unconfirmed bookings from localStorage
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            console.log('📋 Found unconfirmed bookings:', unconfirmedBookings.length);
            
            if (unconfirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Unconfirmed Bookings</h3>
                            <p>New bookings will appear here when customers make reservations</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            unconfirmedBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Get actual price from booking
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                
                // Payment method display
                const paymentDisplay = booking.customer.paymentMethod === 'cash' ? 
                    '<span style="color: #28a745;">(Cash)</span> - Pending' : 
                    `<span style="color: #007bff;">(${booking.customer.paymentMethod})</span> - Pending`;
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <input type="checkbox" style="margin-right: 8px;">
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.trip.travelDate}</div>
                            <div style="color: #666; font-size: 12px;">${booking.trip.travelHour}:${booking.trip.travelMinute}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="color: #e67e22; font-weight: 500;">Unpaid 👁</div>
                            <div style="font-size: 12px;">€${total} ${paymentDisplay}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div class="status-dropdown">
                                <span class="status-badge" onclick="toggleStatusDropdown('${booking.bookingId}')" id="statusBadge_${booking.bookingId}">
                                    Unconfirmed
                                </span>
                                <div class="status-dropdown-menu" id="statusDropdown_${booking.bookingId}">
                                    <div class="status-option selected" onclick="changeBookingStatus('${booking.bookingId}', 'unconfirmed')">
                                        ✓ Unconfirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'confirmed')">
                                        Confirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'request_quote')">
                                        Request Quote
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'assigned')">
                                        Assigned
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_accepted')">
                                        Job Accepted
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_rejected')">
                                        Job Rejected
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_route')">
                                        On Route
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'arrived')">
                                        Arrived
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_board')">
                                        On Board
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'no_show')">
                                        No Show
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'completed')">
                                        Completed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'cancelled')">
                                        Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'driver_cancelled')">
                                        Driver Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'incomplete')">
                                        Incomplete
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 12px;">
                            <button style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                Assign driver ➕
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>€0.00 ✏️</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>€0.00 ✏️</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            console.log('✅ Unconfirmed bookings loaded successfully');
        }
        
        function confirmBooking(bookingId) {
            if (!confirm(`Confirm booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to confirmed
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                
                // Move to confirmed
                confirmedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Reload the display
                loadUnconfirmedBookings();
                
                alert(`✅ Booking ${bookingId} confirmed successfully!`);
                console.log('✅ Booking confirmed:', bookingId);
            }
        }
        
        function cancelBooking(bookingId) {
            if (!confirm(`Cancel booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to cancelled
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'cancelled';
                booking.cancelledAt = new Date().toISOString();
                
                // Move to cancelled
                cancelledBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                
                // Reload the display
                loadUnconfirmedBookings();
                
                alert(`❌ Booking ${bookingId} cancelled successfully!`);
                console.log('❌ Booking cancelled:', bookingId);
            }
        }
        
        function confirmAllBookings() {
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            if (unconfirmedBookings.length === 0) {
                alert('No unconfirmed bookings to confirm.');
                return;
            }
            
            if (!confirm(`Confirm all ${unconfirmedBookings.length} unconfirmed bookings?`)) {
                return;
            }
            
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            // Move all unconfirmed to confirmed
            unconfirmedBookings.forEach(booking => {
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                confirmedBookings.unshift(booking);
            });
            
            // Clear unconfirmed and save confirmed
            localStorage.setItem('unconfirmedBookings', JSON.stringify([]));
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            // Reload the display
            loadUnconfirmedBookings();
            
            alert(`✅ All ${unconfirmedBookings.length} bookings confirmed successfully!`);
            console.log('✅ All bookings confirmed');
        }
        
        // Global variable to store current booking being edited
        let currentEditingBooking = null;

        function showBookingActions(bookingId) {
            console.log('📝 Opening edit modal for booking:', bookingId);
            
            // Debug: Check if modal exists
            const modal = document.getElementById('bookingEditModal');
            if (!modal) {
                console.error('❌ Modal element not found!');
                alert('❌ Modal element not found! Please refresh the page.');
                return;
            }
            
            // Find the booking in all localStorage sections
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            console.log('🔍 Searching in sections:');
            console.log('- Unconfirmed:', unconfirmedBookings.length);
            console.log('- Confirmed:', confirmedBookings.length);
            console.log('- Completed:', completedBookings.length);
            console.log('- Cancelled:', cancelledBookings.length);
            
            // Search in all sections
            let booking = unconfirmedBookings.find(b => b.bookingId === bookingId) ||
                         confirmedBookings.find(b => b.bookingId === bookingId) ||
                         completedBookings.find(b => b.bookingId === bookingId) ||
                         cancelledBookings.find(b => b.bookingId === bookingId);
            
            if (!booking) {
                alert('❌ Booking not found in any section\n\nBooking ID: ' + bookingId);
                console.error('❌ Booking not found:', bookingId);
                console.log('Available booking IDs:');
                console.log('- Unconfirmed:', unconfirmedBookings.map(b => b.bookingId));
                console.log('- Confirmed:', confirmedBookings.map(b => b.bookingId));
                console.log('- Completed:', completedBookings.map(b => b.bookingId));
                console.log('- Cancelled:', cancelledBookings.map(b => b.bookingId));
                return;
            }
            
            console.log('✅ Found booking:', booking);
            console.log('✅ Booking status:', booking.status || 'unconfirmed');
            
            // Store current booking for editing
            currentEditingBooking = booking;
            
            // Open the modal
            try {
                openBookingEditModal(booking);
                console.log('✅ Modal should be open now');
            } catch (error) {
                console.error('❌ Error opening modal:', error);
                alert('❌ Error opening modal. Check console for details.');
            }
        }

        function openBookingEditModal(booking) {
            console.log('📝 Loading booking data into modal:', booking.bookingId);
            
            try {
                // Helper function to safely set element value
                const setElementValue = (elementId, value) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.value = value || '';
                    } else {
                        console.warn(`⚠️ Element not found: ${elementId}`);
                    }
                };
                
                const setElementText = (elementId, text) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = text || '';
                    } else {
                        console.warn(`⚠️ Element not found: ${elementId}`);
                    }
                };
                
                // Set booking ID in modal header
                setElementText('modalBookingId', booking.bookingId);
                
                // Fill customer information
                setElementValue('editFirstName', booking.customer?.firstName);
                setElementValue('editLastName', booking.customer?.lastName);
                setElementValue('editEmail', booking.customer?.email);
                setElementValue('editPhone', booking.customer?.phone);
                setElementValue('editPassengers', booking.customer?.passengers || '1');
                setElementValue('editPaymentMethod', booking.customer?.paymentMethod || 'cash');
                
                // Fill trip information
                setElementValue('editFromLocation', booking.trip?.fromLocation);
                setElementValue('editToLocation', booking.trip?.toLocation);
                
                // Convert date format from DD/MM/YYYY to YYYY-MM-DD for date input
                const travelDate = booking.trip?.travelDate || '';
                if (travelDate && travelDate.includes('/')) {
                    const dateParts = travelDate.split('/');
                    if (dateParts.length === 3) {
                        const formattedDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
                        setElementValue('editTravelDate', formattedDate);
                    }
                } else {
                    setElementValue('editTravelDate', travelDate);
                }
                
                // Set travel time
                const travelTime = `${booking.trip?.travelHour || '00'}:${booking.trip?.travelMinute || '00'}`;
                setElementValue('editTravelTime', travelTime);
                
                // Set vehicle type
                const vehicleType = booking.vehicle?.vehicle?.id || booking.vehicle?.vehicleId || 'saloon';
                setElementValue('editVehicleType', vehicleType);
                
                // Set return trip
                setElementValue('editReturnTrip', booking.trip?.returnActive || 'false');
                
                // Fill booking details
                setElementValue('editBookingStatus', booking.status || 'unconfirmed');
                
                // Set price from vehicle pricing
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                setElementValue('editPrice', parseFloat(price).toFixed(2));
                
                // Set optional fields
                setElementValue('editDriver', booking.driver);
                
                // Set special instructions (textarea)
                const specialInstructionsElement = document.getElementById('editSpecialInstructions');
                if (specialInstructionsElement) {
                    specialInstructionsElement.value = booking.specialInstructions || '';
                }
                
                // Show the modal
                const modal = document.getElementById('bookingEditModal');
                if (modal) {
                    modal.classList.add('show');
                    console.log('✅ Modal opened with booking data loaded');
                } else {
                    throw new Error('Modal element not found');
                }
                
            } catch (error) {
                console.error('❌ Error in openBookingEditModal:', error);
                alert('❌ Error opening booking details. Some fields may be missing.');
            }
        }

        function closeBookingModal() {
            console.log('❌ Closing booking edit modal');
            document.getElementById('bookingEditModal').classList.remove('show');
            currentEditingBooking = null;
        }

        function saveBookingChanges() {
            if (!currentEditingBooking) {
                alert('❌ No booking data to save');
                return;
            }
            
            console.log('💾 Saving booking changes for:', currentEditingBooking.bookingId);
            
            // Validate required fields
            const firstName = document.getElementById('editFirstName').value.trim();
            const lastName = document.getElementById('editLastName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const fromLocation = document.getElementById('editFromLocation').value.trim();
            const toLocation = document.getElementById('editToLocation').value.trim();
            
            if (!firstName || !lastName || !email || !phone || !fromLocation || !toLocation) {
                alert('❌ Please fill in all required fields');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('❌ Please enter a valid email address');
                return;
            }
            
            // Update booking data
            const updatedBooking = {
                ...currentEditingBooking,
                customer: {
                    ...currentEditingBooking.customer,
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    passengers: document.getElementById('editPassengers').value,
                    paymentMethod: document.getElementById('editPaymentMethod').value
                },
                trip: {
                    ...currentEditingBooking.trip,
                    fromLocation: fromLocation,
                    toLocation: toLocation,
                    travelDate: convertDateToDisplayFormat(document.getElementById('editTravelDate').value),
                    travelHour: document.getElementById('editTravelTime').value.split(':')[0],
                    travelMinute: document.getElementById('editTravelTime').value.split(':')[1],
                    returnActive: document.getElementById('editReturnTrip').value
                },
                vehicle: {
                    ...currentEditingBooking.vehicle,
                    vehicle: {
                        ...currentEditingBooking.vehicle?.vehicle,
                        id: document.getElementById('editVehicleType').value,
                        name: getVehicleName(document.getElementById('editVehicleType').value)
                    },
                    pricing: {
                        ...currentEditingBooking.vehicle?.pricing,
                        minimumPrice: parseFloat(document.getElementById('editPrice').value)
                    }
                },
                status: document.getElementById('editBookingStatus').value,
                driver: document.getElementById('editDriver').value,
                specialInstructions: document.getElementById('editSpecialInstructions').value,
                lastUpdated: new Date().toISOString()
            };
            
            // Update in localStorage
            updateBookingInStorage(updatedBooking);
            
            // Close modal and refresh display
            closeBookingModal();
            loadUnconfirmedBookings();
            
            alert('✅ Booking updated successfully!');
            console.log('✅ Booking saved:', updatedBooking);
        }

        function updateBookingInStorage(updatedBooking) {
            // Get all booking lists
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            // Find which list contains the booking
            let foundInList = null;
            let bookingIndex = -1;
            
            bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
            if (bookingIndex !== -1) {
                foundInList = 'unconfirmed';
            } else {
                bookingIndex = confirmedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                if (bookingIndex !== -1) {
                    foundInList = 'confirmed';
                } else {
                    bookingIndex = completedBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                    if (bookingIndex !== -1) {
                        foundInList = 'completed';
                    } else {
                        bookingIndex = cancelledBookings.findIndex(b => b.bookingId === updatedBooking.bookingId);
                        if (bookingIndex !== -1) {
                            foundInList = 'cancelled';
                        }
                    }
                }
            }
            
            if (!foundInList) {
                console.error('❌ Booking not found in any list:', updatedBooking.bookingId);
                return;
            }
            
            console.log('📍 Found booking in:', foundInList, 'list');
            
            // Remove from current list
            switch (foundInList) {
                case 'unconfirmed':
                    unconfirmedBookings.splice(bookingIndex, 1);
                    break;
                case 'confirmed':
                    confirmedBookings.splice(bookingIndex, 1);
                    break;
                case 'completed':
                    completedBookings.splice(bookingIndex, 1);
                    break;
                case 'cancelled':
                    cancelledBookings.splice(bookingIndex, 1);
                    break;
            }
            
            // Add to new list based on status
            switch (updatedBooking.status) {
                case 'unconfirmed':
                    unconfirmedBookings.unshift(updatedBooking);
                    break;
                case 'confirmed':
                case 'job_accepted':
                case 'assigned':
                case 'on_route':
                case 'arrived':
                case 'on_board':
                    confirmedBookings.unshift(updatedBooking);
                    break;
                case 'completed':
                    completedBookings.unshift(updatedBooking);
                    break;
                case 'cancelled':
                case 'driver_cancelled':
                case 'no_show':
                case 'job_rejected':
                    cancelledBookings.unshift(updatedBooking);
                    break;
                default:
                    // If status is unclear, update in same list
                    switch (foundInList) {
                        case 'unconfirmed':
                            unconfirmedBookings.unshift(updatedBooking);
                            break;
                        case 'confirmed':
                            confirmedBookings.unshift(updatedBooking);
                            break;
                        case 'completed':
                            completedBookings.unshift(updatedBooking);
                            break;
                        case 'cancelled':
                            cancelledBookings.unshift(updatedBooking);
                            break;
                    }
            }
            
            // Save all lists
            localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
            localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            
            console.log('✅ Booking updated and moved to:', updatedBooking.status, 'list');
            
            // Reload the appropriate section
            if (document.getElementById('unconfirmed-section').classList.contains('active')) {
                loadUnconfirmedBookings();
            } else if (document.getElementById('next-24h-section').classList.contains('active')) {
                loadNext24hBookings();
            } else if (document.getElementById('completed-section').classList.contains('active')) {
                loadCompletedBookings();
            } else if (document.getElementById('cancelled-section').classList.contains('active')) {
                loadCancelledBookings();
            } else if (document.getElementById('all-section').classList.contains('active')) {
                loadAllBookings();
            }
        }

        function convertDateToDisplayFormat(dateString) {
            // Convert from YYYY-MM-DD to DD/MM/YYYY
            if (!dateString) return '';
            const dateParts = dateString.split('-');
            if (dateParts.length === 3) {
                return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            }
            return dateString;
        }

        function getVehicleName(vehicleId) {
            const vehicleNames = {
                'saloon': 'Saloon',
                'estate': 'Estate',
                'minivan': 'Minivan',
                'minivan_long': 'Minivan Long'
            };
            return vehicleNames[vehicleId] || 'Unknown';
        }

        function confirmBookingFromModal() {
            if (!currentEditingBooking) {
                alert('❌ No booking to confirm');
                return;
            }
            
            // Update status to confirmed
            document.getElementById('editBookingStatus').value = 'confirmed';
            
            // Save changes
            saveBookingChanges();
            
            console.log('✅ Booking confirmed from modal');
        }

        function deleteBooking() {
            if (!currentEditingBooking) {
                alert('❌ No booking to delete');
                return;
            }
            
            if (!confirm(`⚠️ Are you sure you want to permanently delete booking ${currentEditingBooking.bookingId}?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            // Remove from all lists
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            unconfirmedBookings = unconfirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            confirmedBookings = confirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            completedBookings = completedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
            
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            cancelledBookings = cancelledBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
            localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            
            // Close modal and refresh
            closeBookingModal();
            
            // Reload the active section
            if (document.getElementById('unconfirmed-section').classList.contains('active')) {
                loadUnconfirmedBookings();
            } else if (document.getElementById('next-24h-section').classList.contains('active')) {
                loadNext24hBookings();
            } else if (document.getElementById('completed-section').classList.contains('active')) {
                loadCompletedBookings();
            } else if (document.getElementById('cancelled-section').classList.contains('active')) {
                loadCancelledBookings();
            } else if (document.getElementById('all-section').classList.contains('active')) {
                loadAllBookings();
            }
            
            alert('✅ Booking deleted successfully');
            console.log('🗑️ Booking deleted:', currentEditingBooking.bookingId);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('bookingEditModal');
            if (event.target === modal) {
                closeBookingModal();
            }
        });

        // Next 24h Bookings Functions
        function loadNext24hBookings() {
            console.log('📅 Loading next 24h bookings...');
            
            const tableBody = document.getElementById('next24hTableBody');
            const countDisplay = document.getElementById('next24hCount');
            
            if (!tableBody) {
                console.error('❌ Next 24h table body not found');
                return;
            }
            
            // Get confirmed bookings from localStorage
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            console.log('📅 Found confirmed bookings:', confirmedBookings.length);
            
            // Filter for next 24 hours
            const now = new Date();
            const next24h = new Date(now.getTime() + (24 * 60 * 60 * 1000));
            
            const upcomingBookings = confirmedBookings.filter(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                return travelDate >= now && travelDate <= next24h;
            });
            
            countDisplay.textContent = `${upcomingBookings.length} confirmed`;
            
            if (upcomingBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📅 No Bookings in Next 24 Hours</h3>
                            <p>Confirmed bookings for the next 24 hours will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by travel date/time
            upcomingBookings.sort((a, b) => {
                const dateA = parseTravelDate(a.trip.travelDate, a.trip.travelHour, a.trip.travelMinute);
                const dateB = parseTravelDate(b.trip.travelDate, b.trip.travelHour, b.trip.travelMinute);
                return dateA - dateB;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            upcomingBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = travelDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(price).toFixed(2);
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="editConfirmedBooking('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">${booking.trip.fromLocation} → ${booking.trip.toLocation}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                Confirmed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.driver || 'Not assigned'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${booking.specialInstructions || '-'}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Next 24h bookings loaded successfully');
        }

        // Cancelled Bookings Functions
        function loadCancelledBookings() {
            console.log('❌ Loading cancelled bookings...');
            
            const tableBody = document.getElementById('cancelledTableBody');
            const countDisplay = document.getElementById('cancelledCount');
            
            if (!tableBody) {
                console.error('❌ Cancelled table body not found');
                return;
            }
            
            // Get cancelled bookings from localStorage
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            console.log('❌ Found cancelled bookings:', cancelledBookings.length);
            
            countDisplay.textContent = `${cancelledBookings.length} cancelled`;
            
            if (cancelledBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>❌ No Cancelled Bookings</h3>
                            <p>Cancelled and deleted bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by cancelled date (most recent first)
            cancelledBookings.sort((a, b) => {
                const dateA = new Date(a.cancelledAt || a.lastUpdated);
                const dateB = new Date(b.cancelledAt || b.lastUpdated);
                return dateB - dateA;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            cancelledBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = travelDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                
                const cancelledDate = new Date(booking.cancelledAt || booking.lastUpdated);
                const formattedCancelledDate = cancelledDate.toLocaleDateString('nl-BE');
                
                const price = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(price).toFixed(2);
                
                const reason = booking.cancellationReason || 'Manual cancellation';
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6; background: #fef5e7;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="restoreBooking('${booking.bookingId}')">
                                ↩️ Restore
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">${booking.trip.fromLocation} → ${booking.trip.toLocation}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div>${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${reason}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; text-decoration: line-through; color: #6c757d;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px; color: #666;">${formattedCancelledDate}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Cancelled bookings loaded successfully');
        }

        // Helper Functions
        function parseTravelDate(dateString, hour, minute) {
            // Parse DD/MM/YYYY format
            const dateParts = dateString.split('/');
            if (dateParts.length === 3) {
                const day = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
                const year = parseInt(dateParts[2]);
                const hourInt = parseInt(hour || 0);
                const minuteInt = parseInt(minute || 0);
                
                return new Date(year, month, day, hourInt, minuteInt);
            }
            return new Date();
        }

        function editConfirmedBooking(bookingId) {
            console.log('📝 Editing confirmed booking:', bookingId);
            
            // Find booking in confirmed list
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const booking = confirmedBookings.find(b => b.bookingId === bookingId);
            
            if (booking) {
                currentEditingBooking = booking;
                openBookingEditModal(booking);
            } else {
                alert('❌ Booking not found');
            }
        }

        function restoreBooking(bookingId) {
            if (!confirm(`Restore booking ${bookingId} to unconfirmed status?`)) {
                return;
            }
            
            // Move from cancelled back to unconfirmed
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            const bookingIndex = cancelledBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = cancelledBookings[bookingIndex];
                booking.status = 'unconfirmed';
                booking.restoredAt = new Date().toISOString();
                delete booking.cancelledAt;
                delete booking.cancellationReason;
                
                // Move to unconfirmed
                unconfirmedBookings.unshift(booking);
                cancelledBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                // Reload the display
                loadCancelledBookings();
                
                alert(`✅ Booking ${bookingId} restored to unconfirmed status!`);
                console.log('↩️ Booking restored:', bookingId);
            }
        }

        function clearAllCancelled() {
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            if (cancelledBookings.length === 0) {
                alert('No cancelled bookings to clear.');
                return;
            }
            
            if (!confirm(`⚠️ Permanently delete all ${cancelledBookings.length} cancelled bookings?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            localStorage.setItem('cancelledBookings', JSON.stringify([]));
            loadCancelledBookings();
            
            alert(`✅ All ${cancelledBookings.length} cancelled bookings cleared!`);
            console.log('🗑️ All cancelled bookings cleared');
        }

        // Email Settings Functions
        function toggleAdminPassword() {
            const passwordInput = document.getElementById('adminSmtpPassword');
            const toggleBtn = event.target;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = '👁';
            }
        }

        async function sendAdminTestEmail() {
            const testEmail = document.getElementById('adminTestEmail').value;
            if (!testEmail) {
                showAdminEmailStatus('Please enter an email address', 'error');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                const config = getAdminEmailConfig();
                const response = await fetch('/api/test-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ testEmail: testEmail, config: config })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAdminEmailStatus('✅ Test email sent successfully!', 'success');
                } else {
                    showAdminEmailStatus('❌ Failed to send test email: ' + result.error, 'error');
                }
            } catch (error) {
                showAdminEmailStatus('❌ Error: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        function getAdminEmailConfig() {
            const securityValue = document.querySelector('input[name="adminSmtpSecurity"]:checked').value;
            
            return {
                fromName: document.getElementById('adminFromName').value,
                fromEmail: document.getElementById('adminFromEmail').value,
                replyToEmail: document.getElementById('adminReplyToEmail').value,
                adminEmail: document.getElementById('adminAdminEmail').value,
                connectionType: document.getElementById('adminConnectionType').value,
                provider: document.getElementById('adminProvider').value,
                smtpHost: document.getElementById('adminSmtpHost').value,
                smtpPort: document.getElementById('adminSmtpPort').value,
                smtpUsername: document.getElementById('adminSmtpUsername').value,
                smtpPassword: document.getElementById('adminSmtpPassword').value,
                smtpSecurity: securityValue
            };
        }

        function showAdminEmailStatus(message, type) {
            const indicator = document.getElementById('adminEmailStatus');
            indicator.textContent = message;
            
            // Set colors based on type
            if (type === 'success') {
                indicator.style.background = '#d4edda';
                indicator.style.color = '#155724';
                indicator.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                indicator.style.background = '#f8d7da';
                indicator.style.color = '#721c24';
                indicator.style.border = '1px solid #f5c6cb';
            } else {
                indicator.style.background = '#d1ecf1';
                indicator.style.color = '#0c5460';
                indicator.style.border = '1px solid #bee5eb';
            }
            
            indicator.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 5000);
        }

        // Email form submission
        document.addEventListener('DOMContentLoaded', function() {
            const emailForm = document.getElementById('adminEmailSettingsForm');
            if (emailForm) {
                emailForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const config = getAdminEmailConfig();
                    
                    if (!config.smtpPassword) {
                        showAdminEmailStatus('❌ SMTP password is required', 'error');
                        return;
                    }

                    const btn = document.querySelector('#adminEmailSettingsForm button[type="submit"]');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.textContent = 'Saving...';

                    try {
                        // Save configuration to localStorage
                        localStorage.setItem('emailConfig', JSON.stringify(config));
                        
                        // Update status display
                        document.getElementById('configStatus').textContent = 'Configured ✅';
                        document.getElementById('configHost').textContent = config.smtpHost;
                        document.getElementById('configEmail').textContent = config.fromEmail;
                        
                        showAdminEmailStatus('✅ Email configuration saved successfully!', 'success');
                    } catch (error) {
                        showAdminEmailStatus('❌ Error saving configuration: ' + error.message, 'error');
                    } finally {
                        btn.disabled = false;
                        btn.textContent = originalText;
                    }
                });
            }
        });

        // Status Dropdown Functions
        function toggleStatusDropdown(bookingId) {
            console.log('🔍 Toggling dropdown for booking:', bookingId);
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            const badge = document.getElementById(`statusBadge_${bookingId}`);
            
            if (!dropdown || !badge) {
                console.error('❌ Dropdown or badge not found for booking:', bookingId);
                return;
            }
            
            console.log('📋 Dropdown element found:', dropdown);
            
            // Close all other dropdowns first
            document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                if (menu.id !== `statusDropdown_${bookingId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Calculate position for fixed positioning
            const rect = badge.getBoundingClientRect();
            const isOpen = dropdown.classList.contains('show');
            
            if (!isOpen) {
                // Position dropdown below the badge
                dropdown.style.top = (rect.bottom + 4) + 'px';
                dropdown.style.left = rect.left + 'px';
                dropdown.classList.add('show');
                console.log('✅ Dropdown opened at position:', rect.left, rect.bottom + 4);
            } else {
                dropdown.classList.remove('show');
                console.log('✅ Dropdown closed');
            }
        }

        function changeBookingStatus(bookingId, newStatus) {
            console.log('📋 Changing booking status:', bookingId, 'to', newStatus);
            
            // Get current bookings
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            
            if (bookingIndex === -1) {
                alert('❌ Booking not found');
                return;
            }
            
            const booking = unconfirmedBookings[bookingIndex];
            const oldStatus = booking.status || 'unconfirmed';
            
            // Update booking status and timestamp
            booking.status = newStatus;
            booking.lastUpdated = new Date().toISOString();
            
            // Handle status changes that require moving between sections
            if (newStatus === 'confirmed') {
                // Move to confirmed section (Next 24h)
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                booking.confirmedAt = new Date().toISOString();
                confirmedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                alert(`✅ Booking ${bookingId} confirmed and moved to Next 24h section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else if (newStatus === 'completed') {
                // Move to completed section
                let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                booking.completedAt = new Date().toISOString();
                completedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                alert(`✅ Booking ${bookingId} completed and moved to Completed section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else if (newStatus === 'cancelled' || newStatus === 'driver_cancelled') {
                // Move to cancelled section
                let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                booking.cancelledAt = new Date().toISOString();
                booking.cancellationReason = newStatus === 'driver_cancelled' ? 'Driver Cancelled' : 'Cancelled';
                cancelledBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                const reason = newStatus === 'driver_cancelled' ? 'driver cancellation' : 'cancellation';
                alert(`❌ Booking ${bookingId} ${reason} and moved to Cancelled section!`);
                loadUnconfirmedBookings(); // Refresh current view
                
            } else {
                // Keep in unconfirmed section but update status
                unconfirmedBookings[bookingIndex] = booking;
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                // Update the status badge in the UI
                const statusBadge = document.getElementById(`statusBadge_${bookingId}`);
                if (statusBadge) {
                    statusBadge.textContent = getStatusDisplayName(newStatus);
                    statusBadge.className = `status-badge ${getStatusClass(newStatus)}`;
                }
                
                // Update the dropdown to show current selection
                updateDropdownSelection(bookingId, newStatus);
                
                alert(`✅ Booking ${bookingId} status updated to: ${getStatusDisplayName(newStatus)}`);
            }
            
            // Close dropdown
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            console.log('✅ Status changed from', oldStatus, 'to', newStatus);
        }

        function getStatusDisplayName(status) {
            const statusNames = {
                'unconfirmed': 'Unconfirmed',
                'confirmed': 'Confirmed',
                'request_quote': 'Request Quote',
                'assigned': 'Assigned',
                'job_accepted': 'Job Accepted',
                'job_rejected': 'Job Rejected',
                'on_route': 'On Route',
                'arrived': 'Arrived',
                'on_board': 'On Board',
                'no_show': 'No Show',
                'completed': 'Completed',
                'cancelled': 'Cancelled',
                'driver_cancelled': 'Driver Cancelled',
                'incomplete': 'Incomplete'
            };
            return statusNames[status] || status;
        }

        function getStatusClass(status) {
            if (['confirmed', 'job_accepted', 'completed'].includes(status)) {
                return 'confirmed';
            } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(status)) {
                return 'cancelled';
            }
            return ''; // Default (unconfirmed) styling
        }

        function updateDropdownSelection(bookingId, currentStatus) {
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (!dropdown) return;
            
            // Update all options
            const options = dropdown.querySelectorAll('.status-option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.textContent.trim().replace('✓ ', '') === getStatusDisplayName(currentStatus)) {
                    option.classList.add('selected');
                    option.innerHTML = `✓ ${getStatusDisplayName(currentStatus)}`;
                } else {
                    option.innerHTML = option.textContent.replace('✓ ', '');
                }
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.status-dropdown')) {
                document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Dispatch Calendar Variables
        let dispatchCurrentDate = new Date();
        let dispatchSelectedDate = null;
        let dispatchReturnCurrentDate = new Date();
        let dispatchReturnSelectedDate = null;
        let dispatchExtraStopCount = 0;
        let dispatchRetourActive = false;

        // Initialize Dispatch Calendar and Time
        function initDispatchDateTime() {
            // Populate hour options (00-23)
            const hourSelect = document.getElementById('dispatchHour');
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                hourSelect.appendChild(option);
            }
            
            // Populate minute options (00, 15, 30, 45)
            const minuteSelect = document.getElementById('dispatchMinute');
            ['00', '15', '30', '45'].forEach(minute => {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                minuteSelect.appendChild(option);
            });
            
            // Set default to current time + 1 hour
            const now = new Date();
            const defaultHour = (now.getHours() + 1) % 24;
            hourSelect.value = defaultHour.toString().padStart(2, '0');
            minuteSelect.value = '00';
            
            // Initialize calendar
            generateDispatchCalendar();
            
            // Initialize return time selectors
            initDispatchReturnTime();
        }

        function initDispatchReturnTime() {
            // Populate return hour options (00-23)
            const returnHourSelect = document.getElementById('dispatchReturnHour');
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                returnHourSelect.appendChild(option);
            }
            
            // Populate return minute options (00, 15, 30, 45)
            const returnMinuteSelect = document.getElementById('dispatchReturnMinute');
            ['00', '15', '30', '45'].forEach(minute => {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                returnMinuteSelect.appendChild(option);
            });
        }

        // Extra Stops Functions
        function addDispatchExtraStop() {
            if (dispatchExtraStopCount >= 7) {
                alert('Maximum 7 extra stops allowed');
                return;
            }
            
            dispatchExtraStopCount++;
            const container = document.getElementById('dispatchExtraStopsContainer');
            
            const stopDiv = document.createElement('div');
            stopDiv.id = `dispatchExtraStop${dispatchExtraStopCount}`;
            stopDiv.style.cssText = 'display: flex; gap: 15px; align-items: center;';
            
            stopDiv.innerHTML = `
                <input type="text" id="dispatchExtraStopAddress${dispatchExtraStopCount}" placeholder="📍 Extra stop ${dispatchExtraStopCount}..." 
                       style="flex: 1; padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                <button type="button" onclick="removeDispatchExtraStop(${dispatchExtraStopCount})" 
                        style="background: #dc3545; color: white; border: none; padding: 18px; border-radius: 10px; 
                               cursor: pointer; transition: all 0.3s; font-size: 16px; font-weight: 600;"
                        onmouseover="this.style.background='#c82333'"
                        onmouseout="this.style.background='#dc3545'">
                    ❌
                </button>
            `;
            
            container.appendChild(stopDiv);
            
            console.log('Added extra stop:', dispatchExtraStopCount);
        }

        function removeDispatchExtraStop(stopNumber) {
            const stopDiv = document.getElementById(`dispatchExtraStop${stopNumber}`);
            if (stopDiv) {
                stopDiv.remove();
                dispatchExtraStopCount--;
                
                // Renumber remaining stops
                const container = document.getElementById('dispatchExtraStopsContainer');
                const remainingStops = container.children;
                
                for (let i = 0; i < remainingStops.length; i++) {
                    const stop = remainingStops[i];
                    const newNumber = i + 1;
                    stop.id = `dispatchExtraStop${newNumber}`;
                    
                    const input = stop.querySelector('input');
                    input.id = `dispatchExtraStopAddress${newNumber}`;
                    input.placeholder = `📍 Extra stop ${newNumber}...`;
                    
                    const button = stop.querySelector('button');
                    button.setAttribute('onclick', `removeDispatchExtraStop(${newNumber})`);
                }
                
                dispatchExtraStopCount = remainingStops.length;
                console.log('Removed extra stop, remaining:', dispatchExtraStopCount);
            }
        }

        // Retour Functions
        function toggleDispatchRetour() {
            dispatchRetourActive = !dispatchRetourActive;
            const details = document.getElementById('dispatchRetourDetails');
            const status = document.getElementById('dispatchRetourStatus');
            const btn = document.getElementById('dispatchRetourBtn');
            
            if (dispatchRetourActive) {
                details.style.display = 'block';
                status.textContent = 'Activated ✅';
                status.style.color = '#28a745';
                btn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
            } else {
                details.style.display = 'none';
                status.textContent = 'Not activated';
                status.style.color = '#666';
                btn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';
                
                // Clear return values
                document.getElementById('dispatchReturnDate').value = '';
                document.getElementById('dispatchReturnHour').value = '';
                document.getElementById('dispatchReturnMinute').value = '';
                dispatchReturnSelectedDate = null;
            }
            
            console.log('Retour toggled:', dispatchRetourActive);
        }

        function toggleDispatchCalendar() {
            const calendar = document.getElementById('dispatchCalendar');
            const isVisible = calendar.style.display === 'block';
            
            // Close all other calendars/dropdowns
            document.querySelectorAll('[id*="Calendar"]').forEach(cal => {
                if (cal.id !== 'dispatchCalendar') cal.style.display = 'none';
            });
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchCalendar();
            }
        }

        function generateDispatchCalendar() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchCalendarTitle');
            const grid = document.getElementById('dispatchCalendarGrid');
            
            title.textContent = `${monthNames[dispatchCurrentDate.getMonth()]} ${dispatchCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7; // Convert Sunday=0 to Monday=0
            
            // Add empty cells for days before first day
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#007bff';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchSelectedDate && cellDate.toDateString() === dispatchSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchSelectedDate || cellDate.toDateString() !== dispatchSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        function changeDispatchMonth(direction) {
            dispatchCurrentDate.setMonth(dispatchCurrentDate.getMonth() + direction);
            generateDispatchCalendar();
        }

        function selectDispatchDate(date) {
            dispatchSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchDate').value = formattedDate;
            document.getElementById('dispatchCalendar').style.display = 'none';
            
            generateDispatchCalendar(); // Refresh to show selection
        }

        // Return Calendar Functions
        function toggleDispatchReturnCalendar() {
            const calendar = document.getElementById('dispatchReturnCalendar');
            const isVisible = calendar.style.display === 'block';
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchReturnCalendar();
            }
        }

        function generateDispatchReturnCalendar() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchReturnCalendarTitle');
            const grid = document.getElementById('dispatchReturnCalendarGrid');
            
            title.textContent = `${monthNames[dispatchReturnCurrentDate.getMonth()]} ${dispatchReturnCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7;
            
            // Add empty cells
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#2196f3';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchReturnSelectedDate && cellDate.toDateString() === dispatchReturnSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchReturnDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchReturnSelectedDate || cellDate.toDateString() !== dispatchReturnSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        function changeDispatchReturnMonth(direction) {
            dispatchReturnCurrentDate.setMonth(dispatchReturnCurrentDate.getMonth() + direction);
            generateDispatchReturnCalendar();
        }

        function selectDispatchReturnDate(date) {
            dispatchReturnSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchReturnDate').value = formattedDate;
            document.getElementById('dispatchReturnCalendar').style.display = 'none';
            
            generateDispatchReturnCalendar();
        }

        // Close calendars when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#dispatchCalendar') && !event.target.closest('#dispatchDate')) {
                document.getElementById('dispatchCalendar').style.display = 'none';
            }
            if (!event.target.closest('#dispatchReturnCalendar') && !event.target.closest('#dispatchReturnDate')) {
                document.getElementById('dispatchReturnCalendar').style.display = 'none';
            }
        });

        // Dispatch Booking Functions
        async function createDispatchBooking(event) {
            event.preventDefault();
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '⏳ Creating Booking...';
            
            try {
                // Get form data
                const dispatchData = {
                    pickup: document.getElementById('dispatchPickup').value.trim(),
                    destination: document.getElementById('dispatchDestination').value.trim(),
                    date: document.getElementById('dispatchDate').value.trim(),
                    hour: document.getElementById('dispatchHour').value,
                    minute: document.getElementById('dispatchMinute').value,
                    firstName: document.getElementById('dispatchFirstName').value.trim(),
                    lastName: document.getElementById('dispatchLastName').value.trim(),
                    email: document.getElementById('dispatchEmail').value.trim(),
                    phone: document.getElementById('dispatchPhone').value.trim(),
                    passengers: document.getElementById('dispatchPassengers').value,
                    vehicleType: document.getElementById('dispatchVehicleType').value,
                    paymentMethod: document.getElementById('dispatchPaymentMethod').value,
                    extraStopCount: dispatchExtraStopCount,
                    returnActive: dispatchRetourActive,
                    returnDate: dispatchRetourActive ? document.getElementById('dispatchReturnDate').value.trim() : '',
                    returnHour: dispatchRetourActive ? document.getElementById('dispatchReturnHour').value : '',
                    returnMinute: dispatchRetourActive ? document.getElementById('dispatchReturnMinute').value : ''
                };
                
                // Get extra stops
                const extraStops = [];
                for (let i = 1; i <= dispatchExtraStopCount; i++) {
                    const stopInput = document.getElementById(`dispatchExtraStopAddress${i}`);
                    if (stopInput && stopInput.value.trim()) {
                        extraStops.push(stopInput.value.trim());
                    }
                }
                
                // Validate required fields
                if (!dispatchData.pickup || !dispatchData.destination || !dispatchData.date || 
                    !dispatchData.hour || !dispatchData.minute || !dispatchData.firstName || 
                    !dispatchData.lastName || !dispatchData.email || !dispatchData.phone) {
                    showDispatchStatus('❌ Please fill in all required fields', 'error');
                    return;
                }
                
                // Get vehicle data from localStorage
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const selectedVehicle = vehicles.find(v => v.id === dispatchData.vehicleType) || 
                                      { id: dispatchData.vehicleType, name: dispatchData.vehicleType, price: 50.00 };
                
                // Get pricing data
                const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
                const pricing = pricingData[dispatchData.vehicleType] || { minimumPrice: 50.00, pricePerKm: 2.50 };
                
                // Generate booking ID
                const bookingId = 'BK' + Date.now();
                
                // Create main booking object (heen trip)
                const mainBooking = {
                    bookingId: bookingId,
                    customer: {
                        firstName: dispatchData.firstName,
                        lastName: dispatchData.lastName,
                        email: dispatchData.email,
                        phone: dispatchData.phone,
                        passengers: dispatchData.passengers,
                        paymentMethod: dispatchData.paymentMethod,
                        koffers: 1, // Default
                        handbagage: 1 // Default
                    },
                    trip: {
                        fromLocation: dispatchData.pickup,
                        toLocation: dispatchData.destination,
                        travelDate: dispatchData.date,
                        travelHour: dispatchData.hour,
                        travelMinute: dispatchData.minute,
                        extraStopCount: dispatchData.extraStopCount,
                        extraStops: extraStops,
                        returnActive: 'false', // Main trip doesn't have return status
                        tripType: 'heen',
                        direction: 'outbound'
                    },
                    vehicle: {
                        vehicle: selectedVehicle,
                        pricing: pricing
                    },
                    status: 'confirmed', // Admin bookings are pre-confirmed
                    source: 'dispatch', // Mark as dispatch booking
                    createdAt: new Date().toISOString(),
                    confirmedAt: new Date().toISOString(),
                    bookingDate: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                // Save main booking to confirmed bookings
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings.unshift(mainBooking);
                
                // Create return booking if return trip is active
                let returnBooking = null;
                if (dispatchData.returnActive && dispatchData.returnDate && dispatchData.returnHour && dispatchData.returnMinute) {
                    const returnBookingId = 'BK' + (Date.now() + 1); // Slightly different timestamp
                    
                    returnBooking = {
                        bookingId: returnBookingId,
                        customer: {
                            firstName: dispatchData.firstName,
                            lastName: dispatchData.lastName,
                            email: dispatchData.email,
                            phone: dispatchData.phone,
                            passengers: dispatchData.passengers,
                            paymentMethod: dispatchData.paymentMethod,
                            koffers: 1, // Default
                            handbagage: 1 // Default
                        },
                        trip: {
                            fromLocation: dispatchData.destination, // Reversed: from destination back to origin
                            toLocation: dispatchData.pickup, // Reversed: to origin from destination
                            travelDate: dispatchData.returnDate,
                            travelHour: dispatchData.returnHour,
                            travelMinute: dispatchData.returnMinute,
                            extraStopCount: 0, // No extra stops for return trip
                            extraStops: [],
                            returnActive: 'false', // Return trip doesn't have another return
                            tripType: 'terug',
                            direction: 'inbound',
                            relatedBookingId: bookingId // Link to main booking
                        },
                        vehicle: {
                            vehicle: selectedVehicle,
                            pricing: pricing
                        },
                        status: 'confirmed', // Admin bookings are pre-confirmed
                        source: 'dispatch', // Mark as dispatch booking
                        createdAt: new Date().toISOString(),
                        confirmedAt: new Date().toISOString(),
                        bookingDate: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    };
                    
                    // Add return booking to confirmed bookings
                    confirmedBookings.unshift(returnBooking);
                }
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Send email notification for main booking
                try {
                    const emailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mainBooking)
                    });
                    
                    // Send email for return booking if exists
                    if (returnBooking) {
                        const returnEmailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(returnBooking)
                        });
                    }
                    
                    if (emailResponse.ok) {
                        console.log('✅ Email notifications sent successfully');
                    } else {
                        console.log('⚠️ Email sending failed, but booking created');
                    }
                } catch (emailError) {
                    console.log('⚠️ Email server not available, but booking created');
                }
                
                // Show success message
                let successMessage = `✅ Dispatch Booking${returnBooking ? 's' : ''} Created Successfully!

HEEN REIS: ${bookingId}
Van: ${dispatchData.pickup}
Naar: ${dispatchData.destination}
Datum: ${dispatchData.date} om ${dispatchData.hour}:${dispatchData.minute}`;

                if (returnBooking) {
                    successMessage += `

TERUG REIS: ${returnBooking.bookingId}
Van: ${dispatchData.destination}
Naar: ${dispatchData.pickup}
Datum: ${dispatchData.returnDate} om ${dispatchData.returnHour}:${dispatchData.returnMinute}`;
                }

                successMessage += `

Both bookings added to confirmed bookings list!`;
                
                showDispatchStatus(successMessage, 'success');
                
                // Clear form
                document.getElementById('dispatchBookingForm').reset();
                
                // Reset extra stops
                document.getElementById('dispatchExtraStopsContainer').innerHTML = '';
                dispatchExtraStopCount = 0;
                
                // Reset retour
                if (dispatchRetourActive) {
                    toggleDispatchRetour(); // Turn off retour
                }
                
                // Reset selected dates
                dispatchSelectedDate = null;
                dispatchReturnSelectedDate = null;
                
                console.log('✅ Dispatch booking(s) created:', mainBooking.bookingId, returnBooking ? `& ${returnBooking.bookingId}` : '');
                
            } catch (error) {
                console.error('❌ Error creating dispatch booking:', error);
                showDispatchStatus('❌ Error creating booking: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function showDispatchStatus(message, type) {
            const statusDiv = document.getElementById('dispatchStatus');
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // Set colors based on type
            if (type === 'success') {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            } else {
                statusDiv.style.background = '#d1ecf1';
                statusDiv.style.color = '#0c5460';
                statusDiv.style.border = '1px solid #bee5eb';
            }
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Load functions for all sections
        function loadNext24hBookings() {
            console.log('📋 Loading Next 24h bookings...');
            
            const tableBody = document.getElementById('next24hTableBody');
            if (!tableBody) {
                console.error('❌ Next 24h table body not found');
                return;
            }
            
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            document.getElementById('next24hCount').textContent = `${confirmedBookings.length} confirmed`;
            
            if (confirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Confirmed Bookings</h3>
                            <p>Confirmed bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            confirmedBookings.forEach((booking, index) => {
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge confirmed" style="font-size: 11px; padding: 4px 8px;">
                                Confirmed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">-</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Next 24h bookings loaded successfully');
        }

        function loadCompletedBookings() {
            console.log('📋 Loading completed bookings...');
            
            const tableBody = document.getElementById('completedTableBody');
            if (!tableBody) {
                console.error('❌ Completed table body not found');
                return;
            }
            
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            document.getElementById('completedCount').textContent = `${completedBookings.length} completed`;
            
            if (completedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>✅ No Completed Bookings</h3>
                            <p>Completed trips will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            completedBookings.forEach((booking, index) => {
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                const completedDate = new Date(booking.completedAt || booking.lastUpdated);
                const formattedCompletedDate = completedDate.toLocaleDateString('nl-BE');
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.trip.fromLocation}</div>
                            <div style="font-size: 12px; color: #666;">→ ${booking.trip.toLocation}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge confirmed" style="font-size: 11px; padding: 4px 8px; background: #28a745;">
                                Completed
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            <div>-</div>
                        </td>
                        <td style="padding: 12px;">
                            <div>${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">${formattedCompletedDate}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ Completed bookings loaded successfully');
        }

        function clearAllCompleted() {
            if (confirm('Are you sure you want to clear all completed bookings?')) {
                localStorage.setItem('completedBookings', JSON.stringify([]));
                loadCompletedBookings();
                alert('✅ All completed bookings cleared');
            }
        }

        // All Bookings Functions
        function loadAllBookings() {
            console.log('📋 Loading all bookings...');
            
            const tableBody = document.getElementById('allBookingsTableBody');
            if (!tableBody) {
                console.error('❌ All bookings table body not found');
                return;
            }
            
            // Collect all bookings from different sources
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            // Combine all bookings and sort by creation date (newest first)
            const allBookings = [
                ...unconfirmedBookings.map(b => ({...b, section: 'unconfirmed'})),
                ...confirmedBookings.map(b => ({...b, section: 'confirmed'})),
                ...completedBookings.map(b => ({...b, section: 'completed'})),
                ...cancelledBookings.map(b => ({...b, section: 'cancelled'}))
            ].sort((a, b) => new Date(b.createdAt || b.bookingDate) - new Date(a.createdAt || a.bookingDate));
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${allBookings.length} bookings`;
            
            if (allBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>📋 No Bookings Found</h3>
                            <p>All customer and dispatch bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            allBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Get actual price
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                
                // Determine source
                const source = booking.source === 'dispatch' ? 
                    '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">DISPATCH</span>' :
                    '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">CUSTOMER</span>';
                
                // Status styling
                let statusClass = '';
                let statusText = booking.status || 'unconfirmed';
                if (['confirmed', 'job_accepted', 'completed'].includes(statusText)) {
                    statusClass = 'confirmed';
                } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(statusText)) {
                    statusClass = 'cancelled';
                }
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingActions('${booking.bookingId}')">
                                👁 ⋮
                            </button>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div style="font-size: 12px; color: #666;">📞 ${booking.customer.phone}</div>
                            <div style="font-size: 12px; color: #666;">✉️ ${booking.customer.email}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.trip.fromLocation}</div>
                            <div style="font-size: 12px; color: #666;">→ ${booking.trip.toLocation}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? '🔄 HEEN' : '🔄 TERUG'}</div>` : ''}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${travelDateTime}</div>
                            <div style="font-size: 12px; color: #666;">Created: ${formattedDate} ${formattedTime}</div>
                        </td>
                        <td style="padding: 12px;">
                            <span class="status-badge ${statusClass}" style="font-size: 11px; padding: 4px 8px;">
                                ${getStatusDisplayName(statusText)}
                            </span>
                        </td>
                        <td style="padding: 12px;">
                            ${source}
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500;">${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                            <div style="font-size: 12px; color: #666;">${booking.customer.passengers} passengers</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-weight: 500; color: #28a745;">€${total}</div>
                            <div style="font-size: 12px; color: #666;">${booking.customer.paymentMethod}</div>
                        </td>
                        <td style="padding: 12px;">
                            <div style="font-size: 12px;">${formattedDate}</div>
                            <div style="font-size: 11px; color: #666;">${formattedTime}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            console.log('✅ All bookings loaded successfully:', allBookings.length);
        }

        function filterAllBookings() {
            const filter = document.getElementById('allBookingsFilter').value;
            console.log('🔍 Filtering all bookings by:', filter);
            
            // Get all bookings
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            let filteredBookings = [];
            
            switch(filter) {
                case 'customer':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...confirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...completedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...cancelledBookings.filter(b => !b.source || b.source !== 'dispatch')
                    ];
                    break;
                case 'dispatch':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => b.source === 'dispatch'),
                        ...confirmedBookings.filter(b => b.source === 'dispatch'),
                        ...completedBookings.filter(b => b.source === 'dispatch'),
                        ...cancelledBookings.filter(b => b.source === 'dispatch')
                    ];
                    break;
                case 'confirmed':
                    filteredBookings = confirmedBookings;
                    break;
                case 'unconfirmed':
                    filteredBookings = unconfirmedBookings;
                    break;
                case 'completed':
                    filteredBookings = completedBookings;
                    break;
                case 'cancelled':
                    filteredBookings = cancelledBookings;
                    break;
                default: // 'all'
                    filteredBookings = [...unconfirmedBookings, ...confirmedBookings, ...completedBookings, ...cancelledBookings];
                    break;
            }
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${filteredBookings.length} bookings`;
            
            // Force reload with filtered data
            // For simplicity, we'll just reload all and then apply client-side filtering
            loadAllBookings();
        }

        // Vehicle Management Functions
        let vehicles = [];
        let editingVehicleIndex = -1;

        function loadVehiclesForTypesSection() {
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
            } else {
                // Create default vehicles if none exist
                vehicles = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        active: true,
                        capacity: { passengers: 4, luggage: 2 },
                        image: null
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        active: true,
                        capacity: { passengers: 4, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        active: true,
                        capacity: { passengers: 6, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        active: true,
                        capacity: { passengers: 8, luggage: 6 },
                        image: null
                    }
                ];
                localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            }
            renderVehicleTable();
        }

        function renderVehicleTable() {
            const tableBody = document.getElementById('vehicleTableBody');
            if (!tableBody) return;

            if (vehicles.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>🚗 No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicles.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;">🚗</span>';

                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 15px;">${imageDisplay}</td>
                        <td style="padding: 15px; font-weight: 500;">${vehicle.name}</td>
                        <td style="padding: 15px; color: #666;">${vehicle.description || 'No description'}</td>
                        <td style="padding: 15px;">
                            <div>👥 ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div style="font-size: 12px; color: #666;">🧳 ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div style="font-size: 12px; color: #666;">👜 ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td style="padding: 15px;">
                            <span style="color: ${statusColor}; font-weight: 500;">
                                ${vehicle.active ? '✅' : '❌'} ${statusText}
                            </span>
                        </td>
                        <td style="padding: 15px;">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="editVehicle(${index})">✏️ Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="toggleVehicleStatus(${index})">${vehicle.active ? '❌ Disable' : '✅ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;" onclick="deleteVehicle(${index})">🗑️ Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openAddVehicleModal() {
            editingVehicleIndex = -1;
            document.getElementById('vehicleModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleForm').reset();
            document.getElementById('vehicleImagePreview').style.display = 'none';
            document.getElementById('vehicleUploadText').style.display = 'block';
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function editVehicle(index) {
            editingVehicleIndex = index;
            const vehicle = vehicles[index];
            
            document.getElementById('vehicleModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('vehicleDescription').value = vehicle.description || '';
            document.getElementById('vehiclePassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            
            if (vehicle.image) {
                document.getElementById('vehicleImagePreview').src = vehicle.image;
                document.getElementById('vehicleImagePreview').style.display = 'block';
                document.getElementById('vehicleUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function closeVehicleModal() {
            document.getElementById('vehicleModal').style.display = 'none';
        }

        function handleVehicleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleImagePreview').src = e.target.result;
                    document.getElementById('vehicleImagePreview').style.display = 'block';
                    document.getElementById('vehicleUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteVehicle(index) {
            if (confirm(`Are you sure you want to delete "${vehicles[index].name}"?`)) {
                vehicles.splice(index, 1);
                saveVehicles();
                renderVehicleTable();
                showVehicleSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleStatus(index) {
            vehicles[index].active = !vehicles[index].active;
            saveVehicles();
            renderVehicleTable();
            showVehicleSuccess(`Vehicle ${vehicles[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicles() {
            localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            
            // Set timestamp for booking system to detect updates
            localStorage.setItem('vehicleUpdateTimestamp', Date.now().toString());
            
            // Also sync to booking system
            const bookingVehicles = vehicles.filter(v => v.active).map(v => ({
                id: v.id,
                name: v.name,
                description: v.description,
                active: v.active,
                capacity: v.capacity,
                image: v.image
            }));
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
            console.log('✅ Vehicles saved and synced to booking system');
        }

        function showVehicleSuccess(message) {
            const el = document.getElementById('vehicleSuccessMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showVehicleError(message) {
            const el = document.getElementById('vehicleErrorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Handle vehicle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleForm = document.getElementById('vehicleForm');
            if (vehicleForm) {
                vehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleName').value;
                    const description = document.getElementById('vehicleDescription').value;
                    const passengers = parseInt(document.getElementById('vehiclePassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleHandLuggage').value);
                    const imagePreview = document.getElementById('vehicleImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicles[editingVehicleIndex].id,
                        name: name,
                        description: description,
                        active: true,
                        capacity: { passengers: passengers, luggage: luggage, handLuggage: handLuggage },
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleIndex === -1) {
                        vehicles.push(vehicleData);
                        showVehicleSuccess('Vehicle added successfully');
                    } else {
                        vehicles[editingVehicleIndex] = { ...vehicles[editingVehicleIndex], ...vehicleData };
                        showVehicleSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicles();
                    renderVehicleTable();
                    closeVehicleModal();
                });
            }
        });

        // Update the section show function to load vehicles when Types of Vehicles is opened
        const originalShowSection = window.showSection;
        window.showSection = function(sectionName) {
            if (originalShowSection) {
                originalShowSection(sectionName);
            }
            
            if (sectionName === 'types-of-vehicles') {
                setTimeout(() => {
                    loadVehiclesForTypesSection();
                }, 100);
            }
        };

        // Vehicle Manager Functions
        let vehicleManagerData = [];
        let editingVehicleManagerIndex = -1;

        function loadVehicleManagerData() {
            console.log('🚗 Loading Vehicle Manager data...');
            
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                vehicleManagerData = JSON.parse(savedVehicles);
            } else {
                // Create default vehicles if none exist
                vehicleManagerData = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 2, handLuggage: 2 },
                        hourlyRate: 25,
                        image: 'https://images.unsplash.com/photo-1550355291-bbee04a92027?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 4, handLuggage: 2 },
                        hourlyRate: 30,
                        image: 'https://images.unsplash.com/photo-1494905998402-395d579af36f?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 6, luggage: 4, handLuggage: 3 },
                        hourlyRate: 35,
                        image: 'https://images.unsplash.com/photo-1544636331-e26879cd4d9b?w=300&h=200&fit=crop&q=80'
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 8, luggage: 6, handLuggage: 4 },
                        hourlyRate: 45,
                        image: 'https://images.unsplash.com/photo-1570125909517-53cb21c89ff2?w=300&h=200&fit=crop&q=80'
                    }
                ];
                saveVehicleManagerData();
            }
            renderVehicleManagerTable();
        }

        function renderVehicleManagerTable() {
            const tableBody = document.getElementById('vehicleManagerTableBody');
            if (!tableBody) return;

            if (vehicleManagerData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>🚗 No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicleManagerData.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;">🚗</span>';

                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 15px;">${imageDisplay}</td>
                        <td style="padding: 15px; font-weight: 500;">${vehicle.name}</td>
                        <td style="padding: 15px; color: #666;">${vehicle.description || 'No description'}</td>
                        <td style="padding: 15px;">
                            <div>👥 ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div style="font-size: 12px; color: #666;">🧳 ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div style="font-size: 12px; color: #666;">👜 ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td style="padding: 15px; font-weight: 500;">€${vehicle.hourlyRate || 25}/hour</td>
                        <td style="padding: 15px;">
                            <span style="color: ${statusColor}; font-weight: 500;">
                                ${vehicle.active ? '✅' : '❌'} ${statusText}
                            </span>
                        </td>
                        <td style="padding: 15px;">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer; font-size: 12px;" onclick="editVehicleManager(${index})">✏️ Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer; font-size: 12px;" onclick="toggleVehicleManagerStatus(${index})">${vehicle.active ? '❌ Disable' : '✅ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="deleteVehicleManager(${index})">🗑️ Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openVehicleManagerModal() {
            editingVehicleManagerIndex = -1;
            document.getElementById('vehicleManagerModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleManagerForm').reset();
            document.getElementById('vehicleManagerImagePreview').style.display = 'none';
            document.getElementById('vehicleManagerUploadText').style.display = 'block';
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function editVehicleManager(index) {
            editingVehicleManagerIndex = index;
            const vehicle = vehicleManagerData[index];
            
            document.getElementById('vehicleManagerModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleManagerName').value = vehicle.name;
            document.getElementById('vehicleManagerDriver').value = vehicle.driver || 'All';
            document.getElementById('vehicleManagerDescription').value = vehicle.description || '';
            document.getElementById('vehicleManagerPassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleManagerLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleManagerHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            document.getElementById('vehicleManagerHourlyRate').value = vehicle.hourlyRate || 25;
            
            if (vehicle.image) {
                document.getElementById('vehicleManagerImagePreview').src = vehicle.image;
                document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                document.getElementById('vehicleManagerUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function closeVehicleManagerModal() {
            document.getElementById('vehicleManagerModal').style.display = 'none';
        }

        function adjustVehicleManagerValue(field, change) {
            const input = document.getElementById(`vehicleManager${field.charAt(0).toUpperCase() + field.slice(1)}`);
            if (input) {
                const currentValue = parseInt(input.value) || 0;
                const newValue = Math.max(0, currentValue + change);
                input.value = newValue;
            }
        }

        function handleVehicleManagerImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleManagerError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleManagerImagePreview').src = e.target.result;
                    document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                    document.getElementById('vehicleManagerUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteVehicleManager(index) {
            if (confirm(`Are you sure you want to delete "${vehicleManagerData[index].name}"?`)) {
                vehicleManagerData.splice(index, 1);
                saveVehicleManagerData();
                renderVehicleManagerTable();
                showVehicleManagerSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleManagerStatus(index) {
            vehicleManagerData[index].active = !vehicleManagerData[index].active;
            saveVehicleManagerData();
            renderVehicleManagerTable();
            showVehicleManagerSuccess(`Vehicle ${vehicleManagerData[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicleManagerData() {
            localStorage.setItem('taxiVehicles', JSON.stringify(vehicleManagerData));
            
            // Also sync to booking system
            const bookingVehicles = vehicleManagerData.filter(v => v.active).map(v => ({
                id: v.id,
                name: v.name,
                description: v.description,
                active: v.active,
                capacity: v.capacity,
                hourlyRate: v.hourlyRate,
                image: v.image
            }));
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
            console.log('✅ Vehicle Manager data saved and synced to booking system');
        }

        function showVehicleManagerSuccess(message) {
            const el = document.getElementById('vehicleManagerSuccessMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showVehicleManagerError(message) {
            const el = document.getElementById('vehicleManagerErrorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Handle Vehicle Manager form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleManagerForm = document.getElementById('vehicleManagerForm');
            if (vehicleManagerForm) {
                vehicleManagerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleManagerName').value;
                    const driver = document.getElementById('vehicleManagerDriver').value;
                    const description = document.getElementById('vehicleManagerDescription').value;
                    const passengers = parseInt(document.getElementById('vehicleManagerPassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleManagerLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleManagerHandLuggage').value);
                    const hourlyRate = parseInt(document.getElementById('vehicleManagerHourlyRate').value);
                    const imagePreview = document.getElementById('vehicleManagerImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleManagerError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleManagerIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicleManagerData[editingVehicleManagerIndex].id,
                        name: name,
                        driver: driver,
                        description: description,
                        active: true,
                        capacity: { 
                            passengers: passengers, 
                            luggage: luggage,
                            handLuggage: handLuggage 
                        },
                        hourlyRate: hourlyRate,
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleManagerIndex === -1) {
                        vehicleManagerData.push(vehicleData);
                        showVehicleManagerSuccess('Vehicle added successfully');
                    } else {
                        vehicleManagerData[editingVehicleManagerIndex] = { ...vehicleManagerData[editingVehicleManagerIndex], ...vehicleData };
                        showVehicleManagerSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicleManagerData();
                    renderVehicleManagerTable();
                    closeVehicleManagerModal();
                });
            }
        });

        // Update the existing showSection function to load Vehicle Manager data when opened
        if (window.showSection) {
            const existingShowSection = window.showSection;
            window.showSection = function(sectionName) {
                existingShowSection(sectionName);
                
                if (sectionName === 'types-of-vehicles') {
                    setTimeout(() => {
                        loadVehiclesForTypesSection();
                    }, 100);
                }
                
                if (sectionName === 'vehicle-manager') {
                    setTimeout(() => {
                        loadVehicleManagerData();
                    }, 100);
                }
                
                if (sectionName === 'item-surcharge') {
                    setTimeout(() => {
                        loadSurchargeItems();
                    }, 100);
                }
                
                if (sectionName === 'locations') {
                    setTimeout(() => {
                        loadLocationSettings();
                    }, 100);
                }
            };
        }

        // Item Surcharge Management
        let surchargeItems = {
            fixed: [
                { id: 'meet-greet', name: 'Meet and greet', price: 5, enabled: true },
                { id: 'child-seat', name: 'Child seat', price: 3, enabled: true, hasDropdown: true },
                { id: 'dog', name: 'Dog', price: 3, enabled: true, hasDropdown: true },
                { id: 'wheelchair', name: 'Wheelchair', price: 0, enabled: true },
                { id: 'waiting-time', name: 'Waiting time after landing', price: 0, enabled: true },
                { id: 'stopover', name: 'Stopover (Via)', price: 10, enabled: true }
            ],
            additional: [
                { id: 'golf-material', name: 'Golf-material', price: 5, type: 'Amount', quantity: 1 },
                { id: 'ski-material', name: 'Ski-material', price: 5, type: 'Amount', quantity: 1 },
                { id: 'water', name: 'Water', price: 2, type: 'Amount', quantity: 1, hasDropdown: true },
                { id: 'newspaper', name: 'Newspaper', price: 1, type: 'Amount', quantity: 1, hasDropdown: true },
                { id: 'oversize-luggage', name: 'Oversize luggage', price: 0, type: 'Amount', quantity: 1 },
                { id: 'extra-waiting', name: 'Extra waiting time (1 hour)', price: 30, type: 'Amount', quantity: 1 }
            ]
        };

        function loadSurchargeItems() {
            const saved = localStorage.getItem('surchargeItems');
            if (saved) {
                surchargeItems = JSON.parse(saved);
            }
            renderSurchargeItems();
        }

        function renderSurchargeItems() {
            renderFixedItems();
            renderAdditionalItems();
        }
        
        function updateDropdownOptionName(itemId, optionIndex, newName) {
            const item = surchargeItems.fixed.find(item => item.id === itemId) || surchargeItems.additional.find(item => item.id === itemId);
            if (item && item.dropdownOptions && item.dropdownOptions[optionIndex]) {
                item.dropdownOptions[optionIndex].name = newName;
                console.log('Updated dropdown option name:', newName);
            }
        }
        
        function updateDropdownOptionPrice(itemId, optionIndex, newPrice) {
            const item = surchargeItems.fixed.find(item => item.id === itemId) || surchargeItems.additional.find(item => item.id === itemId);
            if (item && item.dropdownOptions && item.dropdownOptions[optionIndex]) {
                item.dropdownOptions[optionIndex].price = parseFloat(newPrice) || 0;
                console.log('Updated dropdown option price:', newPrice);
            }
        }
        
        function addDropdownOption(itemId) {
            const item = surchargeItems.fixed.find(item => item.id === itemId) || surchargeItems.additional.find(item => item.id === itemId);
            if (item && item.dropdownOptions) {
                const newOption = {
                    id: `custom_${Date.now()}`,
                    name: 'Nieuwe optie',
                    price: 3
                };
                item.dropdownOptions.push(newOption);
                renderSurchargeItems();
                console.log('Added new dropdown option:', newOption);
            }
        }
        
        function removeDropdownOption(itemId, optionIndex) {
            const item = surchargeItems.fixed.find(item => item.id === itemId) || surchargeItems.additional.find(item => item.id === itemId);
            if (item && item.dropdownOptions && item.dropdownOptions.length > 1) {
                item.dropdownOptions.splice(optionIndex, 1);
                renderSurchargeItems();
                console.log('Removed dropdown option at index:', optionIndex);
            } else {
                alert('Minimaal 1 optie moet blijven!');
            }
        }

        function renderFixedItems() {
            const container = document.getElementById('fixedItemsContainer');
            container.innerHTML = '';

            surchargeItems.fixed.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'display: flex; align-items: center; margin-bottom: 15px; padding: 10px; border: 1px solid #e9ecef; border-radius: 8px;';
                
                // Special handling for items with configurable dropdown options
                if (item.hasDropdown && (item.id === 'child-seat' || item.id === 'dog')) {
                    if (!item.dropdownOptions) {
                        if (item.id === 'child-seat') {
                            item.dropdownOptions = [
                                { id: 'maxi_cosi', name: 'Maxi Cosi (baby can\'t sit)', price: 3 },
                                { id: 'baby_seat', name: 'Baby seat', price: 3 },
                                { id: 'verhoostoel', name: 'Verhoostoel', price: 3 }
                            ];
                        } else if (item.id === 'dog') {
                            item.dropdownOptions = [
                                { id: 'kleine_hond', name: 'Kleine hond', price: 3 },
                                { id: 'groten_hond', name: 'Groten hond', price: 5 }
                            ];
                        }
                    }
                    
                    itemDiv.innerHTML = `
                        <div style="flex: 1; color: #6c757d;">
                            ${item.name}
                            <div style="font-size: 12px; color: #868e96; margin-top: 5px;">
                                Dropdown opties configureerbaar:
                            </div>
                            <div id="dropdownOptions_${item.id}" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                                ${item.dropdownOptions.map((option, index) => `
                                    <div style="display: flex; align-items: center; margin-bottom: 8px; gap: 10px;">
                                        <input type="text" value="${option.name}" onchange="updateDropdownOptionName('${item.id}', ${index}, this.value)" style="flex: 1; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                        <span style="font-size: 12px; color: #6c757d;">€</span>
                                        <input type="number" value="${option.price}" step="0.01" onchange="updateDropdownOptionPrice('${item.id}', ${index}, this.value)" style="width: 60px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                        <button onclick="removeDropdownOption('${item.id}', ${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">❌</button>
                                    </div>
                                `).join('')}
                                <button onclick="addDropdownOption('${item.id}')" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; margin-top: 5px;">+ Optie Toevoegen</button>
                            </div>
                        </div>
                        <div style="width: 80px; margin-right: 15px; text-align: center; padding: 8px; color: #6c757d; font-size: 12px;">
                            Individuele<br>prijzen
                        </div>
                        <div style="display: flex; gap: 5px; align-items: center; justify-content: center;">
                            <span style="font-size: 12px; color: #6c757d;">✓ Per optie</span>
                        </div>
                    `;
                } else {
                    itemDiv.innerHTML = `
                        <div style="flex: 1; color: #6c757d;">${item.name}</div>
                        <div style="width: 80px; margin-right: 15px;">
                            <input type="number" value="${item.price}" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; text-align: center;" 
                                   onchange="updateFixedItemPrice('${item.id}', this.value)">
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button style="width: 30px; height: 30px; border: 1px solid #e9ecef; background: white; border-radius: 4px; cursor: pointer;" 
                                    onclick="adjustFixedItemPrice('${item.id}', 1)">+</button>
                            <button style="width: 30px; height: 30px; border: 1px solid #e9ecef; background: white; border-radius: 4px; cursor: pointer;" 
                                    onclick="adjustFixedItemPrice('${item.id}', -1)">-</button>
                        </div>
                    `;
                }
                
                container.appendChild(itemDiv);
            });
        }

        function renderAdditionalItems() {
            const container = document.getElementById('additionalOptionsContainer');
            container.innerHTML = `
                <div style="display: flex; background: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-weight: 600;">
                    <div style="flex: 1;">Name</div>
                    <div style="width: 100px;">Price</div>
                    <div style="width: 100px;">Type</div>
                    <div style="width: 80px;">Options</div>
                    <div style="width: 50px;"></div>
                </div>
            `;

            surchargeItems.additional.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'margin-bottom: 15px; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px;';
                
                // Special handling for items with dropdown options
                if (item.hasDropdown) {
                    if (!item.dropdownOptions) {
                        if (item.id === 'dog') {
                            item.dropdownOptions = [
                                { id: 'kleine_hond', name: 'Kleine hond', price: 3 },
                                { id: 'groten_hond', name: 'Groten hond', price: 5 }
                            ];
                        } else if (item.id === 'water') {
                            item.dropdownOptions = [
                                { id: 'still', name: 'Still water', price: 2 },
                                { id: 'sparkling', name: 'Sparkling water', price: 3 }
                            ];
                        } else if (item.id === 'newspaper') {
                            item.dropdownOptions = [
                                { id: 'local', name: 'Lokale krant', price: 1 },
                                { id: 'national', name: 'Nationale krant', price: 2 }
                            ];
                        }
                    }
                    
                    itemDiv.innerHTML = `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <div style="flex: 1; color: #6c757d;">
                                <input type="text" value="${item.name}" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-weight: 600;" 
                                       onchange="updateAdditionalItem(${index}, 'name', this.value)">
                                <div style="font-size: 12px; color: #868e96; margin-top: 5px;">
                                    Dropdown opties configureerbaar:
                                </div>
                                <div id="dropdownOptions_${item.id}" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                                    ${item.dropdownOptions.map((option, optionIndex) => `
                                        <div style="display: flex; align-items: center; margin-bottom: 8px; gap: 10px;">
                                            <input type="text" value="${option.name}" onchange="updateDropdownOptionName('${item.id}', ${optionIndex}, this.value)" style="flex: 1; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                            <span style="font-size: 12px; color: #6c757d;">€</span>
                                            <input type="number" value="${option.price}" step="0.01" onchange="updateDropdownOptionPrice('${item.id}', ${optionIndex}, this.value)" style="width: 60px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                                            <button onclick="removeDropdownOption('${item.id}', ${optionIndex})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">❌</button>
                                        </div>
                                    `).join('')}
                                    <button onclick="addDropdownOption('${item.id}')" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; margin-top: 5px;">+ Optie Toevoegen</button>
                                </div>
                            </div>
                            <div style="width: 80px; margin-right: 15px; text-align: center; padding: 8px; color: #6c757d; font-size: 12px;">
                                Individuele<br>prijzen
                            </div>
                            <div style="display: flex; gap: 5px; align-items: center; justify-content: center;">
                                <button style="width: 40px; height: 32px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;" 
                                        onclick="removeAdditionalItem(${index})">🗑️</button>
                            </div>
                        </div>
                    `;
                } else {
                    // Regular items without dropdown
                    itemDiv.innerHTML = `
                        <div style="display: flex; align-items: center;">
                            <div style="flex: 1; margin-right: 10px;">
                                <input type="text" value="${item.name}" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px;" 
                                       onchange="updateAdditionalItem(${index}, 'name', this.value)">
                            </div>
                            <input type="number" value="${item.price}" style="width: 90px; margin-right: 10px; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px;" 
                                   onchange="updateAdditionalItem(${index}, 'price', this.value)">
                            <select style="width: 90px; margin-right: 10px; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px;" 
                                    onchange="updateAdditionalItem(${index}, 'type', this.value)">
                                <option value="Amount" ${item.type === 'Amount' ? 'selected' : ''}>Amount</option>
                                <option value="Percentage" ${item.type === 'Percentage' ? 'selected' : ''}>Percentage</option>
                            </select>
                            <input type="number" value="${item.quantity}" style="width: 70px; margin-right: 10px; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px;" 
                                   onchange="updateAdditionalItem(${index}, 'quantity', this.value)">
                            <button style="width: 40px; height: 32px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;" 
                                    onclick="removeAdditionalItem(${index})">🗑️</button>
                        </div>
                    `;
                }
                container.appendChild(itemDiv);
            });
        }

        function updateFixedItemPrice(itemId, price) {
            const item = surchargeItems.fixed.find(i => i.id === itemId);
            if (item) {
                item.price = parseFloat(price) || 0;
            }
        }

        function adjustFixedItemPrice(itemId, delta) {
            const item = surchargeItems.fixed.find(i => i.id === itemId);
            if (item) {
                item.price = Math.max(0, item.price + delta);
                renderFixedItems();
            }
        }

        function updateAdditionalItem(index, field, value) {
            if (surchargeItems.additional[index]) {
                surchargeItems.additional[index][field] = field === 'price' || field === 'quantity' ? parseFloat(value) || 0 : value;
            }
        }

        function addNewSurchargeItem() {
            surchargeItems.additional.push({
                id: 'new-item-' + Date.now(),
                name: 'New Item',
                price: 0,
                type: 'Amount',
                quantity: 1
            });
            renderAdditionalItems();
        }

        function removeAdditionalItem(index) {
            surchargeItems.additional.splice(index, 1);
            renderAdditionalItems();
        }

        function saveSurchargeItems() {
            // Add timestamp for update tracking
            const currentTime = Date.now();
            localStorage.setItem('surchargeItems', JSON.stringify(surchargeItems));
            localStorage.setItem('surchargeItemsUpdateTime', currentTime.toString());
            
            alert('✅ Surcharge items saved successfully!');
            
            // Sync to booking system
            syncSurchargeToBookingSystem();
        }

        // Google Settings Functions
        function loadGoogleSettings() {
            const saved = localStorage.getItem('googleSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('googleMapsApiKey').value = settings.googleMapsApiKey || '';
                document.getElementById('googlePlacesApiKey').value = settings.googlePlacesApiKey || '';
                document.getElementById('googleDirectionsApiKey').value = settings.googleDirectionsApiKey || '';
                document.getElementById('googleGeocodingApiKey').value = settings.googleGeocodingApiKey || '';
                document.getElementById('defaultLocation').value = settings.defaultLocation || '';
                document.getElementById('serviceArea').value = settings.serviceArea || '';
                console.log('✅ Google settings loaded:', settings);
            }
        }
        function saveGoogleSettings() {
            const mapsApiKey = document.getElementById('googleMapsApiKey').value.trim();
            const placesApiKey = document.getElementById('googlePlacesApiKey').value.trim();
            const directionsApiKey = document.getElementById('googleDirectionsApiKey').value.trim();
            const geocodingApiKey = document.getElementById('googleGeocodingApiKey').value.trim();
            const defaultLocation = document.getElementById('defaultLocation').value.trim();
            const serviceArea = document.getElementById('serviceArea').value.trim();
            
            // Save to localStorage
            const googleSettings = {
                googleMapsApiKey: mapsApiKey,
                googlePlacesApiKey: placesApiKey,
                googleDirectionsApiKey: directionsApiKey,
                googleGeocodingApiKey: geocodingApiKey,
                defaultLocation: defaultLocation,
                serviceArea: serviceArea,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('googleSettings', JSON.stringify(googleSettings));
            
            // Show success message
            const statusDiv = document.getElementById('googleStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.innerHTML = '✅ Google settings saved successfully!';
            
            // Hide message after 3 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
            
            console.log('✅ Google settings saved:', googleSettings);
        }
        
        function testGoogleMapsApi() {
            const apiKey = document.getElementById('googleMapsApiKey').value.trim();
            const statusDiv = document.getElementById('googleStatus');
            
            if (!apiKey) {
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
                statusDiv.innerHTML = '❌ Please enter a Google Maps API key first';
                return;
            }
            
            // Show testing message
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            statusDiv.style.border = '1px solid #ffeaa7';
            statusDiv.innerHTML = '🔍 Testing Google Maps API...';
            
            // Test the API by making a simple request
            const testUrl = `https://maps.googleapis.com/maps/api/geocode/json?address=Brussels,Belgium&key=${apiKey}`;
            
            fetch(testUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        statusDiv.style.background = '#d4edda';
                        statusDiv.style.color = '#155724';
                        statusDiv.style.border = '1px solid #c3e6cb';
                        statusDiv.innerHTML = '✅ Google Maps API is working correctly!';
                    } else {
                        statusDiv.style.background = '#f8d7da';
                        statusDiv.style.color = '#721c24';
                        statusDiv.style.border = '1px solid #f5c6cb';
                        statusDiv.innerHTML = `❌ API Error: ${data.status} - ${data.error_message || 'Unknown error'}`;
                    }
                })
                .catch(error => {
                    statusDiv.style.background = '#f8d7da';
                    statusDiv.style.color = '#721c24';
                    statusDiv.style.border = '1px solid #f5c6cb';
                    statusDiv.innerHTML = `❌ Network Error: ${error.message}`;
                });
            
            // Hide message after 10 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 10000);
        }

        function syncSurchargeToBookingSystem() {
            // Create booking system compatible data
            const bookingSurcharge = {
                fixed: surchargeItems.fixed.filter(item => item.enabled),
                additional: surchargeItems.additional
            };
            localStorage.setItem('bookingSurchargeItems', JSON.stringify(bookingSurcharge));
            
            // Also set timestamp for booking system updates
            const currentTime = Date.now();
            localStorage.setItem('bookingSurchargeItemsUpdateTime', currentTime.toString());
            
            console.log('✅ Surcharge items synced to booking system:', bookingSurcharge);
        }

        // Make functions globally available
        window.showSection = showSection;
        window.toggleMenu = toggleMenu;
        window.showBookingActions = showBookingActions;
        window.confirmBooking = confirmBooking;
        window.cancelBooking = cancelBooking;
        window.confirmAllBookings = confirmAllBookings;
        window.closeBookingModal = closeBookingModal;
        window.saveBookingChanges = saveBookingChanges;
        window.toggleStatusDropdown = toggleStatusDropdown;
        window.changeBookingStatus = changeBookingStatus;
        window.loadSurchargeItems = loadSurchargeItems;
        window.renderSurchargeItems = renderSurchargeItems;
        window.updateFixedItemPrice = updateFixedItemPrice;
        window.adjustFixedItemPrice = adjustFixedItemPrice;
        window.updateAdditionalItem = updateAdditionalItem;
        window.addNewSurchargeItem = addNewSurchargeItem;
        window.removeAdditionalItem = removeAdditionalItem;
        window.saveSurchargeItems = saveSurchargeItems;
        window.loadGoogleSettings = loadGoogleSettings;
        window.saveGoogleSettings = saveGoogleSettings;
        window.testGoogleMapsApi = testGoogleMapsApi;
        window.loadEmailSettings = loadEmailSettings;
        window.saveEmailSettings = saveEmailSettings;
        window.sendAdminTestEmail = sendAdminTestEmail;
        window.loadEmailTemplate = loadEmailTemplate;
        window.saveEmailTemplate = saveEmailTemplate;
        window.previewEmailTemplate = previewEmailTemplate;
        window.loadTranslation = loadTranslation;
        window.saveTranslation = saveTranslation;
        window.previewTranslationEmail = previewTranslationEmail;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📱 Admin panel initialized');
            
            // Initialize dispatch calendar and time
            initDispatchDateTime();
            
            // Auto-load vehicle pricing when Distance & Time section is opened
            setTimeout(() => {
                const section = document.getElementById('distance-time-section');
                if (section && section.classList.contains('active')) {
                    console.log('🔄 Auto-loading vehicle pricing for Distance & Time...');
                    loadVehiclePricing();
                }
            }, 1000);

            // Initialize surcharge items and sync to booking system
            loadSurchargeItems();
            syncSurchargeToBookingSystem();
            
            // Load Google settings
            loadGoogleSettings();
            
            // Load email settings
            loadEmailSettings();
            
            // Load email template
            loadEmailTemplate();
            
            // Load translation settings
            loadTranslation();
        });

        // Email Template Functions
        function loadSelectedTemplate() {
            const selectedType = document.getElementById('templateSelector').value;
            console.log('📝 Loading template:', selectedType);
            
            // Hide all templates
            document.querySelectorAll('.template-content').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show selected template
            document.getElementById(selectedType + 'Template').style.display = 'block';
            
            // Load saved data for this template
            loadEmailTemplate();
        }
        
        function loadEmailTemplate() {
            console.log('📝 Loading email templates from localStorage...');
            
            // Load all templates from localStorage
            const allTemplates = JSON.parse(localStorage.getItem('emailTemplates') || '{}');
            
            // Load Pending Template (Template 1)
            if (allTemplates.pending) {
                const pending = allTemplates.pending;
                if (pending.subject) document.getElementById('pendingSubject').value = pending.subject;
                if (pending.welcomeMessage) document.getElementById('pendingWelcomeMessage').value = pending.welcomeMessage;
                if (pending.statusMessage) document.getElementById('pendingStatusMessage').value = pending.statusMessage;
            }
            
            // Load Confirmed Template (Template 2)
            if (allTemplates.confirmed) {
                const confirmed = allTemplates.confirmed;
                if (confirmed.subject) document.getElementById('confirmedSubject').value = confirmed.subject;
                if (confirmed.welcomeMessage) document.getElementById('confirmedWelcomeMessage').value = confirmed.welcomeMessage;
                if (confirmed.statusMessage) document.getElementById('confirmedStatusMessage').value = confirmed.statusMessage;
            }
            
            // Load Cancelled Template (Template 3)
            if (allTemplates.cancelled) {
                const cancelled = allTemplates.cancelled;
                if (cancelled.subject) document.getElementById('cancelledSubject').value = cancelled.subject;
                if (cancelled.welcomeMessage) document.getElementById('cancelledWelcomeMessage').value = cancelled.welcomeMessage;
                if (cancelled.statusMessage) document.getElementById('cancelledStatusMessage').value = cancelled.statusMessage;
            }
            
            // Load shared contact info
            const sharedData = allTemplates.shared || {};
            if (sharedData.phone) document.getElementById('templatePhone').value = sharedData.phone;
            if (sharedData.whatsApp) document.getElementById('templateWhatsApp').value = sharedData.whatsApp;
            if (sharedData.email) document.getElementById('templateEmail').value = sharedData.email;
            if (sharedData.contactInfo) document.getElementById('templateContactInfo').value = sharedData.contactInfo;
            if (sharedData.companyName) document.getElementById('templateCompanyName').value = sharedData.companyName;
            if (sharedData.website) document.getElementById('templateWebsite').value = sharedData.website;
            if (sharedData.footer) document.getElementById('templateFooter').value = sharedData.footer;
            if (sharedData.modificationDeadlineHours) {
                document.getElementById('templateModificationDeadline').value = sharedData.modificationDeadlineHours;
                document.getElementById('deadlinePreview').textContent = sharedData.modificationDeadlineHours;
            }
            
            console.log('✅ Email templates loaded from localStorage');
        }

        function saveEmailTemplate(event) {
            event.preventDefault();
            
            console.log('💾 Saving email templates...');
            
            // Get current templates or create new object
            const allTemplates = JSON.parse(localStorage.getItem('emailTemplates') || '{}');
            
            // Save Template 1: Pending
            allTemplates.pending = {
                subject: document.getElementById('pendingSubject').value,
                welcomeMessage: document.getElementById('pendingWelcomeMessage').value,
                statusMessage: document.getElementById('pendingStatusMessage').value
            };
            
            // Save Template 2: Confirmed
            allTemplates.confirmed = {
                subject: document.getElementById('confirmedSubject').value,
                welcomeMessage: document.getElementById('confirmedWelcomeMessage').value,
                statusMessage: document.getElementById('confirmedStatusMessage').value
            };
            
            // Save Template 3: Cancelled
            allTemplates.cancelled = {
                subject: document.getElementById('cancelledSubject').value,
                welcomeMessage: document.getElementById('cancelledWelcomeMessage').value,
                statusMessage: document.getElementById('cancelledStatusMessage').value
            };
            
            // Save shared contact info
            allTemplates.shared = {
                phone: document.getElementById('templatePhone').value,
                whatsApp: document.getElementById('templateWhatsApp').value,
                email: document.getElementById('templateEmail').value,
                contactInfo: document.getElementById('templateContactInfo').value,
                companyName: document.getElementById('templateCompanyName').value,
                website: document.getElementById('templateWebsite').value,
                footer: document.getElementById('templateFooter').value,
                modificationDeadlineHours: document.getElementById('templateModificationDeadline').value,
                lastUpdated: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('emailTemplates', JSON.stringify(allTemplates));
            
            // Show success message
            const statusDiv = document.getElementById('emailTemplateStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.innerHTML = '✅ Email templates opgeslagen! Deze templates worden gebruikt voor de verschillende booking statussen.';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
            
            console.log('✅ Email templates saved successfully:', allTemplates);
        }

        function previewEmailTemplate() {
            console.log('👁️ Generating email template preview...');
            
            const selectedType = document.getElementById('templateSelector').value;
            let templateData = {};
            
            // Get the selected template data
            if (selectedType === 'pending') {
                templateData = {
                    subject: document.getElementById('pendingSubject').value,
                    welcomeMessage: document.getElementById('pendingWelcomeMessage').value,
                    statusMessage: document.getElementById('pendingStatusMessage').value,
                    templateType: 'pending'
                };
            } else if (selectedType === 'confirmed') {
                templateData = {
                    subject: document.getElementById('confirmedSubject').value,
                    welcomeMessage: document.getElementById('confirmedWelcomeMessage').value,
                    statusMessage: document.getElementById('confirmedStatusMessage').value,
                    templateType: 'confirmed'
                };
            } else if (selectedType === 'cancelled') {
                templateData = {
                    subject: document.getElementById('cancelledSubject').value,
                    welcomeMessage: document.getElementById('cancelledWelcomeMessage').value,
                    statusMessage: document.getElementById('cancelledStatusMessage').value,
                    templateType: 'cancelled'
                };
            }
            
            // Add shared data
            templateData.phone = document.getElementById('templatePhone').value;
            templateData.whatsApp = document.getElementById('templateWhatsApp').value;
            templateData.email = document.getElementById('templateEmail').value;
            templateData.contactInfo = document.getElementById('templateContactInfo').value;
            templateData.companyName = document.getElementById('templateCompanyName').value;
            templateData.website = document.getElementById('templateWebsite').value;
            templateData.footer = document.getElementById('templateFooter').value;
            
            // Generate preview email HTML
            const previewHTML = generateEmailPreview(templateData);
            
            // Open preview in new window
            const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
            
            console.log('✅ Email template preview opened');
        }

        function generateEmailPreview(templateData) {
            // Sample booking data for preview
            const sampleBooking = {
                bookingId: 'BK12345678',
                customer: {
                    firstName: 'Jan',
                    lastName: 'Janssen',
                    email: 'jan.janssen@email.com',
                    phone: '+32 496 12 34 56'
                },
                trip: {
                    fromLocation: 'Brussels Airport (BRU)',
                    toLocation: 'Leuven Centrum',
                    travelDate: '15/07/2025',
                    travelHour: '14',
                    travelMinute: '30'
                },
                vehicle: {
                    vehicle: { name: 'Saloon' },
                    pricing: { minimumPrice: '45.00' }
                }
            };
            
            // Determine colors and title based on template type
            let headerColor = '#007bff'; // Default blue
            let statusBadgeColor = '#ffc107'; // Default yellow
            let statusBadgeTextColor = '#212529';
            let title = 'Booking Bevestiging';
            
            if (templateData.templateType === 'pending') {
                headerColor = '#ffa500'; // Orange
                statusBadgeColor = '#ffc107'; // Yellow
                title = 'Booking Ontvangen - Wacht op Bevestiging';
            } else if (templateData.templateType === 'confirmed') {
                headerColor = '#28a745'; // Green
                statusBadgeColor = '#28a745'; // Green
                statusBadgeTextColor = 'white';
                title = '✅ Booking Bevestigd';
            } else if (templateData.templateType === 'cancelled') {
                headerColor = '#dc3545'; // Red
                statusBadgeColor = '#dc3545'; // Red
                statusBadgeTextColor = 'white';
                title = '❌ Booking Geannuleerd';
            }
            
            return `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>Email Template Preview - ${title}</title>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 20px; }
                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                    .header { background: ${headerColor}; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
                    .content { padding: 20px; background: #f9f9f9; }
                    .booking-details { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid ${headerColor}; }
                    .footer { text-align: center; padding: 20px; color: #666; font-size: 14px; background: #f1f1f1; border-radius: 0 0 8px 8px; }
                    .status-badge { background: ${statusBadgeColor}; color: ${statusBadgeTextColor}; padding: 8px 16px; border-radius: 20px; font-weight: bold; display: inline-block; margin: 10px 0; }
                    .contact-info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 15px 0; }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="header">
                        <h1>🚗 ${templateData.companyName || 'Marcel\'s Taxi'}</h1>
                        <h2>${title}</h2>
                    </div>
                    <div class="content">
                        <h3>Beste ${sampleBooking.customer.firstName} ${sampleBooking.customer.lastName},</h3>
                        <div style="margin-bottom: 20px;">
                            ${templateData.welcomeMessage.replace(/\n/g, '<br>')}
                        </div>
                        
                        <div class="status-badge">
                            ${templateData.statusMessage.split('\n')[0]}
                        </div>
                        
                        <div class="booking-details">
                            <h4>📋 Booking ${sampleBooking.bookingId}</h4>
                            <p><strong>Klant:</strong> ${sampleBooking.customer.firstName} ${sampleBooking.customer.lastName}</p>
                            <p><strong>📍 Van:</strong> ${sampleBooking.trip.fromLocation}</p>
                            <p><strong>📍 Naar:</strong> ${sampleBooking.trip.toLocation}</p>
                            <p><strong>📅 Datum:</strong> ${sampleBooking.trip.travelDate}</p>
                            <p><strong>🕐 Tijd:</strong> ${sampleBooking.trip.travelHour}:${sampleBooking.trip.travelMinute}</p>
                            <p><strong>🚗 Voertuig:</strong> ${sampleBooking.vehicle.vehicle.name}</p>
                            <p><strong>💰 Prijs:</strong> €${sampleBooking.vehicle.pricing.minimumPrice}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            ${templateData.statusMessage.replace(/\n/g, '<br>')}
                        </div>
                        
                        <div class="contact-info">
                            <h4>📞 Contact Informatie</h4>
                            <p><strong>Telefoon:</strong> ${templateData.phone}</p>
                            <p><strong>WhatsApp:</strong> ${templateData.whatsApp}</p>
                            <p><strong>Email:</strong> ${templateData.email}</p>
                            <div style="margin-top: 10px;">
                                ${templateData.contactInfo.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        <p><strong>${templateData.companyName || 'Marcel\'s Taxi'}</strong></p>
                        <p>${templateData.website}</p>
                        <div style="margin-top: 15px;">
                            ${templateData.footer.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                </div>
            </body>
            </html>
            `;
        }

        // Modification Deadline Functions
        function adjustModificationDeadline(delta) {
            const input = document.getElementById('templateModificationDeadline');
            const preview = document.getElementById('deadlinePreview');
            let currentValue = parseInt(input.value) || 24;
            
            // Apply delta with bounds checking
            currentValue = Math.max(1, Math.min(168, currentValue + delta)); // 1 hour to 7 days (168 hours)
            
            // Update input and preview
            input.value = currentValue;
            preview.textContent = currentValue;
            
            console.log('⏰ Modification deadline updated to:', currentValue, 'hours');
        }

        // Update preview when input changes directly
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('templateModificationDeadline');
            if (input) {
                input.addEventListener('input', function() {
                    const preview = document.getElementById('deadlinePreview');
                    if (preview) {
                        preview.textContent = this.value || '24';
                    }
                });
            }
        });

        // Translation Functions
        function loadTranslation() {
            console.log('🌐 Loading translation settings from localStorage...');
            
            // Load translation settings from localStorage
            const translationData = JSON.parse(localStorage.getItem('translationSettings') || '{}');
            
            // Update form fields if values exist
            if (translationData.companyName) document.getElementById('translationCompanyName').value = translationData.companyName;
            if (translationData.logoUrl) document.getElementById('translationLogoUrl').value = translationData.logoUrl;
            if (translationData.statusLine) document.getElementById('translationStatusLine').value = translationData.statusLine;
            if (translationData.mainMessage) document.getElementById('translationMainMessage').value = translationData.mainMessage;
            if (translationData.tripSection) document.getElementById('translationTripSection').value = translationData.tripSection;
            if (translationData.clientSection) document.getElementById('translationClientSection').value = translationData.clientSection;
            if (translationData.reservationSection) document.getElementById('translationReservationSection').value = translationData.reservationSection;
            if (translationData.dateTime) document.getElementById('translationDateTime').value = translationData.dateTime;
            if (translationData.pickupLocation) document.getElementById('translationPickupLocation').value = translationData.pickupLocation;
            if (translationData.destination) document.getElementById('translationDestination').value = translationData.destination;
            if (translationData.vehicle) document.getElementById('translationVehicle').value = translationData.vehicle;
            if (translationData.passengers) document.getElementById('translationPassengers').value = translationData.passengers;
            if (translationData.name) document.getElementById('translationName').value = translationData.name;
            if (translationData.phone) document.getElementById('translationPhone').value = translationData.phone;
            if (translationData.email) document.getElementById('translationEmail').value = translationData.email;
            if (translationData.referenceId) document.getElementById('translationReferenceId').value = translationData.referenceId;
            if (translationData.bookingDate) document.getElementById('translationBookingDate').value = translationData.bookingDate;
            if (translationData.summary) document.getElementById('translationSummary').value = translationData.summary;
            if (translationData.total) document.getElementById('translationTotal').value = translationData.total;
            if (translationData.payments) document.getElementById('translationPayments').value = translationData.payments;
            if (translationData.owedAmount) document.getElementById('translationOwedAmount').value = translationData.owedAmount;
            if (translationData.paymentStatus) document.getElementById('translationPaymentStatus').value = translationData.paymentStatus;
            if (translationData.cancellation) document.getElementById('translationCancellation').value = translationData.cancellation;
            if (translationData.changes) document.getElementById('translationChanges').value = translationData.changes;
            if (translationData.bookingAdvice) document.getElementById('translationBookingAdvice').value = translationData.bookingAdvice;
            if (translationData.driverInfo) document.getElementById('translationDriverInfo').value = translationData.driverInfo;
            
            console.log('✅ Translation settings loaded from localStorage');
        }

        function saveTranslation(event) {
            event.preventDefault();
            
            console.log('💾 Saving translation settings...');
            
            // Collect all translation data
            const translationData = {
                companyName: document.getElementById('translationCompanyName').value,
                logoUrl: document.getElementById('translationLogoUrl').value,
                statusLine: document.getElementById('translationStatusLine').value,
                mainMessage: document.getElementById('translationMainMessage').value,
                tripSection: document.getElementById('translationTripSection').value,
                clientSection: document.getElementById('translationClientSection').value,
                reservationSection: document.getElementById('translationReservationSection').value,
                dateTime: document.getElementById('translationDateTime').value,
                pickupLocation: document.getElementById('translationPickupLocation').value,
                destination: document.getElementById('translationDestination').value,
                vehicle: document.getElementById('translationVehicle').value,
                passengers: document.getElementById('translationPassengers').value,
                name: document.getElementById('translationName').value,
                phone: document.getElementById('translationPhone').value,
                email: document.getElementById('translationEmail').value,
                referenceId: document.getElementById('translationReferenceId').value,
                bookingDate: document.getElementById('translationBookingDate').value,
                summary: document.getElementById('translationSummary').value,
                total: document.getElementById('translationTotal').value,
                payments: document.getElementById('translationPayments').value,
                owedAmount: document.getElementById('translationOwedAmount').value,
                paymentStatus: document.getElementById('translationPaymentStatus').value,
                cancellation: document.getElementById('translationCancellation').value,
                changes: document.getElementById('translationChanges').value,
                bookingAdvice: document.getElementById('translationBookingAdvice').value,
                driverInfo: document.getElementById('translationDriverInfo').value,
                lastUpdated: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('translationSettings', JSON.stringify(translationData));
            
            // Show success message
            const statusDiv = document.getElementById('translationStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.innerHTML = '✅ Translation instellingen opgeslagen! Deze teksten worden gebruikt in alle booking emails.';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
            
            console.log('✅ Translation settings saved successfully:', translationData);
        }

        function previewTranslationEmail() {
            console.log('👁️ Generating professional email preview...');
            
            // Get current translation data
            const translationData = {
                companyName: document.getElementById('translationCompanyName').value,
                logoUrl: document.getElementById('translationLogoUrl').value,
                statusLine: document.getElementById('translationStatusLine').value,
                mainMessage: document.getElementById('translationMainMessage').value,
                tripSection: document.getElementById('translationTripSection').value,
                clientSection: document.getElementById('translationClientSection').value,
                reservationSection: document.getElementById('translationReservationSection').value,
                dateTime: document.getElementById('translationDateTime').value,
                pickupLocation: document.getElementById('translationPickupLocation').value,
                destination: document.getElementById('translationDestination').value,
                vehicle: document.getElementById('translationVehicle').value,
                passengers: document.getElementById('translationPassengers').value,
                name: document.getElementById('translationName').value,
                phone: document.getElementById('translationPhone').value,
                email: document.getElementById('translationEmail').value,
                referenceId: document.getElementById('translationReferenceId').value,
                bookingDate: document.getElementById('translationBookingDate').value,
                summary: document.getElementById('translationSummary').value,
                total: document.getElementById('translationTotal').value,
                payments: document.getElementById('translationPayments').value,
                owedAmount: document.getElementById('translationOwedAmount').value,
                paymentStatus: document.getElementById('translationPaymentStatus').value,
                cancellation: document.getElementById('translationCancellation').value,
                changes: document.getElementById('translationChanges').value,
                bookingAdvice: document.getElementById('translationBookingAdvice').value,
                driverInfo: document.getElementById('translationDriverInfo').value
            };
            
            // Generate professional preview email HTML
            const previewHTML = generateProfessionalEmailPreview(translationData);
            
            // Open preview in new window
            const previewWindow = window.open('', '_blank', 'width=800,height=900,scrollbars=yes');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
            
            console.log('✅ Professional email preview opened');
        }

        function generateProfessionalEmailPreview(translation) {
            // Sample booking data for preview - exactly like the screenshot
            const sampleBooking = {
                bookingId: 'KIGK23',
                customer: {
                    firstName: 'Kelly',
                    lastName: 'Mortelmans',
                    email: 'mortelmanskelly@gmail.com',
                    phone: '+32472950917',
                    passengers: '1'
                },
                trip: {
                    fromLocation: 'Boterveldstraat 2, 3390 Tielt-Winge, Belgium, Boterveldstraat 2, 3390 Tielt-winge',
                    toLocation: 'DAVO SINT-TRUIDEN Mini, Spookvliegerlaan, Sint-Truiden, Belgium, Davo, spookvliegerlaan sint-truiden',
                    travelDate: '27/06/2025',
                    travelHour: '09',
                    travelMinute: '00'
                },
                vehicle: {
                    vehicle: { name: 'Saloon' },
                    pricing: { minimumPrice: '63.00' }
                },
                bookingDate: '26/06/2025 09:36'
            };
            
            return `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>Professional Email Preview</title>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.4; color: #333; margin: 20px; background: #f5f5f5; }
                    .email-container { max-width: 600px; margin: 0 auto; background: white; border: 1px solid #ddd; }
                    .header { text-align: center; padding: 20px; border-bottom: 3px solid #333; background: white; }
                    .header h1 { margin: 0; font-size: 24px; color: #333; }
                    .content { padding: 20px; background: white; }
                    .status-line { color: #d9534f; font-weight: bold; margin-bottom: 15px; }
                    .main-message { margin-bottom: 20px; line-height: 1.5; }
                    .booking-id { color: #d9534f; font-weight: bold; }
                    .section { margin-bottom: 25px; }
                    .section-title { font-weight: bold; font-size: 16px; margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                    .info-table { width: 100%; }
                    .info-table td { padding: 5px 0; vertical-align: top; }
                    .info-table td:first-child { font-weight: bold; width: 150px; }
                    .footer-rules { margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 13px; line-height: 1.4; }
                    .footer-rules p { margin-bottom: 12px; }
                </style>
            </head>
            <body>
                <div class="email-container">
                    <div class="header">
                        ${translation.logoUrl ? `<img src="${translation.logoUrl}" alt="Logo" style="max-height: 50px; margin-bottom: 10px;">` : ''}
                        <h1>${translation.companyName}</h1>
                    </div>
                    <div class="content">
                        <div class="status-line">${translation.statusLine}</div>
                        
                        <div class="main-message">
                            ${translation.mainMessage.replace('[BOOKING_ID]', `<span class="booking-id">${sampleBooking.bookingId}</span>`).replace(/\n/g, '<br>')}
                        </div>
                        
                        <div class="section">
                            <div class="section-title">${translation.tripSection}</div>
                            <table class="info-table">
                                <tr>
                                    <td>${translation.dateTime}</td>
                                    <td>${sampleBooking.trip.travelDate} ${sampleBooking.trip.travelHour}:${sampleBooking.trip.travelMinute}</td>
                                </tr>
                                <tr>
                                    <td>${translation.pickupLocation}</td>
                                    <td>${sampleBooking.trip.fromLocation}</td>
                                </tr>
                                <tr>
                                    <td>${translation.destination}</td>
                                    <td>${sampleBooking.trip.toLocation}</td>
                                </tr>
                                <tr>
                                    <td>${translation.vehicle}</td>
                                    <td>${sampleBooking.vehicle.vehicle.name}</td>
                                </tr>
                                <tr>
                                    <td>${translation.passengers}</td>
                                    <td>${sampleBooking.customer.passengers}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">${translation.clientSection}</div>
                            <table class="info-table">
                                <tr>
                                    <td>${translation.name}</td>
                                    <td>${sampleBooking.customer.firstName} ${sampleBooking.customer.lastName}</td>
                                </tr>
                                <tr>
                                    <td>${translation.phone}</td>
                                    <td>${sampleBooking.customer.phone}</td>
                                </tr>
                                <tr>
                                    <td>${translation.email}</td>
                                    <td>${sampleBooking.customer.email}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">${translation.reservationSection}</div>
                            <table class="info-table">
                                <tr>
                                    <td>${translation.referenceId}</td>
                                    <td>${sampleBooking.bookingId}</td>
                                </tr>
                                <tr>
                                    <td>${translation.bookingDate}</td>
                                    <td>${sampleBooking.bookingDate}</td>
                                </tr>
                                <tr>
                                    <td>${translation.summary}</td>
                                    <td>Journey €${sampleBooking.vehicle.pricing.minimumPrice}</td>
                                </tr>
                                <tr>
                                    <td>${translation.total}</td>
                                    <td>€${sampleBooking.vehicle.pricing.minimumPrice}</td>
                                </tr>
                                <tr>
                                    <td>${translation.payments}</td>
                                    <td>€${sampleBooking.vehicle.pricing.minimumPrice} (Cash) - <span style="color: #f39c12;">${translation.paymentStatus}</span></td>
                                </tr>
                                <tr>
                                    <td>${translation.owedAmount}</td>
                                    <td>€${sampleBooking.vehicle.pricing.minimumPrice}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="footer-rules">
                            <p>${translation.cancellation}</p>
                            <p>${translation.changes}</p>
                            <p>${translation.bookingAdvice}</p>
                            <p>${translation.driverInfo}</p>
                        </div>
                    </div>
                </div>
            </body>
            </html>
            `;
        }

        // Load existing email settings from localStorage
        function loadEmailSettings() {
            console.log('📧 Loading existing email settings...');
            
            // Load individual settings
            const fromName = localStorage.getItem('adminFromName');
            const fromEmail = localStorage.getItem('adminFromEmail');
            const replyToEmail = localStorage.getItem('adminReplyToEmail');
            const adminEmail = localStorage.getItem('adminAdminEmail');
            const connectionType = localStorage.getItem('adminConnectionType');
            const provider = localStorage.getItem('adminProvider');
            const smtpHost = localStorage.getItem('adminSmtpHost');
            const smtpPort = localStorage.getItem('adminSmtpPort');
            const smtpUsername = localStorage.getItem('adminSmtpUsername');
            const smtpPassword = localStorage.getItem('adminSmtpPassword');
            const smtpSecurity = localStorage.getItem('adminSmtpSecurity');
            
            // Update form fields if values exist
            if (fromName) document.getElementById('adminFromName').value = fromName;
            if (fromEmail) document.getElementById('adminFromEmail').value = fromEmail;
            if (replyToEmail) document.getElementById('adminReplyToEmail').value = replyToEmail;
            if (adminEmail) document.getElementById('adminAdminEmail').value = adminEmail;
            if (connectionType) document.getElementById('adminConnectionType').value = connectionType;
            if (provider) document.getElementById('adminProvider').value = provider;
            if (smtpHost) document.getElementById('adminSmtpHost').value = smtpHost;
            if (smtpPort) document.getElementById('adminSmtpPort').value = smtpPort;
            if (smtpUsername) document.getElementById('adminSmtpUsername').value = smtpUsername;
            if (smtpPassword) document.getElementById('adminSmtpPassword').value = smtpPassword;
            
            // Set security radio button
            if (smtpSecurity) {
                const securityRadio = document.querySelector(`input[name="adminSmtpSecurity"][value="${smtpSecurity}"]`);
                if (securityRadio) securityRadio.checked = true;
            }
            
            // Update status display
            if (fromEmail && smtpHost && smtpUsername && smtpPassword) {
                document.getElementById('configStatus').textContent = 'Configured ✅';
                document.getElementById('configHost').textContent = smtpHost;
                document.getElementById('configEmail').textContent = fromEmail;
            }
            
            console.log('✅ Email settings loaded');
        }

        // Email configuration save function
        function saveEmailSettings(event) {
            event.preventDefault();
            
            console.log('💾 Saving email settings...');
            
            // Get form values
            const fromName = document.getElementById('adminFromName').value;
            const fromEmail = document.getElementById('adminFromEmail').value;
            const replyToEmail = document.getElementById('adminReplyToEmail').value;
            const adminEmail = document.getElementById('adminAdminEmail').value;
            const connectionType = document.getElementById('adminConnectionType').value;
            const provider = document.getElementById('adminProvider').value;
            const smtpHost = document.getElementById('adminSmtpHost').value;
            const smtpPort = document.getElementById('adminSmtpPort').value;
            const smtpUsername = document.getElementById('adminSmtpUsername').value;
            const smtpPassword = document.getElementById('adminSmtpPassword').value;
            
            // Get selected security option
            const securityRadio = document.querySelector('input[name="adminSmtpSecurity"]:checked');
            const smtpSecurity = securityRadio ? securityRadio.value : 'tls';
            
            // Validate required fields
            if (!fromName || !fromEmail || !smtpHost || !smtpUsername || !smtpPassword) {
                alert('⚠️ Vul alle verplichte velden in');
                return;
            }
            
            // Save to localStorage for booking system
            localStorage.setItem('adminFromName', fromName);
            localStorage.setItem('adminFromEmail', fromEmail);
            localStorage.setItem('adminReplyToEmail', replyToEmail);
            localStorage.setItem('adminAdminEmail', adminEmail);
            localStorage.setItem('adminConnectionType', connectionType);
            localStorage.setItem('adminProvider', provider);
            localStorage.setItem('adminSmtpHost', smtpHost);
            localStorage.setItem('adminSmtpPort', smtpPort);
            localStorage.setItem('adminSmtpUsername', smtpUsername);
            localStorage.setItem('adminSmtpPassword', smtpPassword);
            localStorage.setItem('adminSmtpSecurity', smtpSecurity);
            
            // Also save as complete email settings object
            const emailSettings = {
                fromName,
                fromEmail,
                replyToEmail,
                adminEmail,
                connectionType,
                provider,
                smtpHost,
                smtpPort,
                smtpUsername,
                smtpPassword,
                smtpSecurity,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('adminEmailSettings', JSON.stringify(emailSettings));
            
            // Update configuration status display
            document.getElementById('configStatus').textContent = 'Configured ✅';
            document.getElementById('configHost').textContent = smtpHost;
            document.getElementById('configEmail').textContent = fromEmail;
            
            // Show success message
            const statusDiv = document.getElementById('adminEmailStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.innerHTML = '✅ Email instellingen opgeslagen! Het booking systeem kan nu emails versturen.';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
            
            console.log('✅ Email settings saved successfully:', emailSettings);
        }

        // Email test function
        async function sendAdminTestEmail() {
            const testEmail = document.getElementById('adminTestEmail').value;
            if (!testEmail) {
                alert('⚠️ Vul een email adres in om te testen');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Verzenden...';

            try {
                const emailSettings = {
                    fromName: document.getElementById('adminFromName').value,
                    fromEmail: document.getElementById('adminFromEmail').value,
                    smtpHost: document.getElementById('adminSmtpHost').value,
                    smtpPort: document.getElementById('adminSmtpPort').value,
                    smtpUsername: document.getElementById('adminSmtpUsername').value,
                    smtpPassword: document.getElementById('adminSmtpPassword').value,
                    testEmail: testEmail
                };

                const response = await fetch('/api/send-test-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(emailSettings)
                });

                const result = await response.json();

                if (result.success) {
                    alert('✅ Test email verzonden! Controleer je inbox.');
                } else {
                    alert('❌ Email versturen mislukt: ' + result.error);
                }
            } catch (error) {
                alert('❌ Email versturen mislukt: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        // Translation Section Functions
        function loadTranslation() {
            console.log('🌍 Loading Translation settings...');
            
            const saved = localStorage.getItem('translationSettings');
            if (saved) {
                try {
                    const translation = JSON.parse(saved);
                    
                    // Load all form fields
                    document.getElementById('translationCompanyName').value = translation.companyName || '';
                    document.getElementById('translationLogoUrl').value = translation.logoUrl || '';
                    document.getElementById('translationStatusLine').value = translation.statusLine || '';
                    document.getElementById('translationMainMessage').value = translation.mainMessage || '';
                    document.getElementById('translationTripSection').value = translation.tripSection || '';
                    document.getElementById('translationDateTime').value = translation.dateTime || '';
                    document.getElementById('translationPickupLocation').value = translation.pickupLocation || '';
                    document.getElementById('translationDestination').value = translation.destination || '';
                    document.getElementById('translationVehicle').value = translation.vehicle || '';
                    document.getElementById('translationPassengers').value = translation.passengers || '';
                    document.getElementById('translationClientSection').value = translation.clientSection || '';
                    document.getElementById('translationName').value = translation.name || '';
                    document.getElementById('translationPhone').value = translation.phone || '';
                    document.getElementById('translationEmail').value = translation.email || '';
                    document.getElementById('translationReservationSection').value = translation.reservationSection || '';
                    document.getElementById('translationReferenceId').value = translation.referenceId || '';
                    document.getElementById('translationBookingDate').value = translation.bookingDate || '';
                    document.getElementById('translationSummary').value = translation.summary || '';
                    document.getElementById('translationTotal').value = translation.total || '';
                    document.getElementById('translationPayments').value = translation.payments || '';
                    document.getElementById('translationPaymentStatus').value = translation.paymentStatus || '';
                    document.getElementById('translationOwedAmount').value = translation.owedAmount || '';
                    document.getElementById('translationCancellation').value = translation.cancellation || '';
                    document.getElementById('translationChanges').value = translation.changes || '';
                    document.getElementById('translationBookingAdvice').value = translation.bookingAdvice || '';
                    document.getElementById('translationDriverInfo').value = translation.driverInfo || '';
                    
                    console.log('✅ Translation settings loaded');
                } catch (error) {
                    console.error('❌ Error loading translation settings:', error);
                }
            } else {
                // Set default values
                setDefaultTranslationValues();
            }
        }

        function setDefaultTranslationValues() {
            document.getElementById('translationCompanyName').value = 'Taxi Leuven';
            document.getElementById('translationStatusLine').value = 'Uw booking wacht op bevestiging. Bedankt voor uw booking bij Taxi Leuven. Uw reservatienummer is [BOOKING_ID].';
            document.getElementById('translationMainMessage').value = 'Een bevestigingsmail wordt naar uw e-mailadres verzonden binnen 1 uur. ALS U GEEN EMAIL ONTVANGEN HEBT, GELIEVE MET ONS CONTACT OP TE NEMEN!';
            document.getElementById('translationTripSection').value = 'Reis';
            document.getElementById('translationDateTime').value = 'Datum & tijd:';
            document.getElementById('translationPickupLocation').value = 'Ophaallocatie:';
            document.getElementById('translationDestination').value = 'Bestemming:';
            document.getElementById('translationVehicle').value = 'Voertuig:';
            document.getElementById('translationPassengers').value = 'Passagiers:';
            document.getElementById('translationClientSection').value = 'Klant';
            document.getElementById('translationName').value = 'Naam:';
            document.getElementById('translationPhone').value = 'Telefoonnummer:';
            document.getElementById('translationEmail').value = 'E-mail:';
            document.getElementById('translationReservationSection').value = 'Reservatie';
            document.getElementById('translationReferenceId').value = 'Referentie-ID:';
            document.getElementById('translationBookingDate').value = 'Boekingsdatum:';
            document.getElementById('translationSummary').value = 'Samenvatting:';
            document.getElementById('translationTotal').value = 'Totaal:';
            document.getElementById('translationPayments').value = 'Betalingen:';
            document.getElementById('translationPaymentStatus').value = 'Pending';
            document.getElementById('translationOwedAmount').value = 'Verschuldigd bedrag:';
            document.getElementById('translationCancellation').value = 'Annulatie binnen 24 uur: Bij annulering binnen 24 uur voor de geplande rit wordt het volledige bedrag van de rit in rekening gebracht.';
            document.getElementById('translationChanges').value = 'Wijzigingen binnen 24 uur: Voor aanpassingen aan een bestaande reservering binnen 24 uur (bijvoorbeeld door het missen van een vlucht) wordt een toeslag van €30 gerekend.';
            document.getElementById('translationBookingAdvice').value = 'Boekingsregels: Het rechtstreeks reserveren van een rit via een van onze chauffeurs is niet toegestaan. Voor een verzekerde en kwalitatieve dienstverlening verzoeken wij u uw taxi uitsluitend via ons officiële systeem te boeken.';
            document.getElementById('translationDriverInfo').value = 'Eén dag voor uw vertrek sturen wij u het nummer van de chauffeur, zodra wij onze planning hebben gemaakt.';
        }

        function saveTranslation(event) {
            event.preventDefault();
            
            console.log('💾 Saving Translation settings...');
            
            const translationData = {
                companyName: document.getElementById('translationCompanyName').value,
                logoUrl: document.getElementById('translationLogoUrl').value,
                statusLine: document.getElementById('translationStatusLine').value,
                mainMessage: document.getElementById('translationMainMessage').value,
                tripSection: document.getElementById('translationTripSection').value,
                dateTime: document.getElementById('translationDateTime').value,
                pickupLocation: document.getElementById('translationPickupLocation').value,
                destination: document.getElementById('translationDestination').value,
                vehicle: document.getElementById('translationVehicle').value,
                passengers: document.getElementById('translationPassengers').value,
                clientSection: document.getElementById('translationClientSection').value,
                name: document.getElementById('translationName').value,
                phone: document.getElementById('translationPhone').value,
                email: document.getElementById('translationEmail').value,
                reservationSection: document.getElementById('translationReservationSection').value,
                referenceId: document.getElementById('translationReferenceId').value,
                bookingDate: document.getElementById('translationBookingDate').value,
                summary: document.getElementById('translationSummary').value,
                total: document.getElementById('translationTotal').value,
                payments: document.getElementById('translationPayments').value,
                paymentStatus: document.getElementById('translationPaymentStatus').value,
                owedAmount: document.getElementById('translationOwedAmount').value,
                cancellation: document.getElementById('translationCancellation').value,
                changes: document.getElementById('translationChanges').value,
                bookingAdvice: document.getElementById('translationBookingAdvice').value,
                driverInfo: document.getElementById('translationDriverInfo').value,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('translationSettings', JSON.stringify(translationData));
            
            // Show success message
            const statusDiv = document.getElementById('translationStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.innerHTML = '✅ Translation settings saved successfully!';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
            
            console.log('✅ Translation settings saved:', translationData);
        }

        function previewTranslationEmail() {
            console.log('📧 Generating email preview...');
            
            // Get current translation values
            const translation = {
                companyName: document.getElementById('translationCompanyName').value || 'Taxi Leuven',
                logoUrl: document.getElementById('translationLogoUrl').value || '',
                statusLine: document.getElementById('translationStatusLine').value || 'Uw booking wacht op bevestiging.',
                mainMessage: document.getElementById('translationMainMessage').value || 'Bedankt voor uw booking.',
                tripSection: document.getElementById('translationTripSection').value || 'Reis',
                dateTime: document.getElementById('translationDateTime').value || 'Datum & tijd:',
                pickupLocation: document.getElementById('translationPickupLocation').value || 'Ophaallocatie:',
                destination: document.getElementById('translationDestination').value || 'Bestemming:',
                vehicle: document.getElementById('translationVehicle').value || 'Voertuig:',
                passengers: document.getElementById('translationPassengers').value || 'Passagiers:',
                clientSection: document.getElementById('translationClientSection').value || 'Klant',
                name: document.getElementById('translationName').value || 'Naam:',
                phone: document.getElementById('translationPhone').value || 'Telefoonnummer:',
                email: document.getElementById('translationEmail').value || 'E-mail:',
                reservationSection: document.getElementById('translationReservationSection').value || 'Reservatie',
                referenceId: document.getElementById('translationReferenceId').value || 'Referentie-ID:',
                bookingDate: document.getElementById('translationBookingDate').value || 'Boekingsdatum:',
                summary: document.getElementById('translationSummary').value || 'Samenvatting:',
                total: document.getElementById('translationTotal').value || 'Totaal:',
                payments: document.getElementById('translationPayments').value || 'Betalingen:',
                paymentStatus: document.getElementById('translationPaymentStatus').value || 'Pending',
                owedAmount: document.getElementById('translationOwedAmount').value || 'Verschuldigd bedrag:',
                cancellation: document.getElementById('translationCancellation').value || 'Annulatie regels...',
                changes: document.getElementById('translationChanges').value || 'Wijziging regels...',
                bookingAdvice: document.getElementById('translationBookingAdvice').value || 'Booking advies...',
                driverInfo: document.getElementById('translationDriverInfo').value || 'Chauffeur informatie...'
            };
            
            // Generate preview HTML
            const previewHTML = generateEmailPreview(translation);
            
            // Open in new window
            const previewWindow = window.open('', '_blank', 'width=700,height=800,scrollbars=yes');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        }

        // Initialize admin panel when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Admin panel DOM loaded');
            
            // Show dashboard by default
            showSection('dispatch');
            
            // Load email settings
            loadEmailSettings();
            
            // Load translation settings when translation section is opened
            const translationNav = document.querySelector('[onclick="showSection(\'translation\')"]');
            if (translationNav) {
                translationNav.addEventListener('click', () => {
                    setTimeout(loadTranslation, 100);
                });
            }
            
            // Test menu functionality after page load
            setTimeout(() => {
                console.log('🔧 Testing menu functionality...');
                
                // Test if menu elements exist
                const bookingsMenu = document.getElementById('bookings-menu');
                const settingsMenu = document.getElementById('settings-menu');
                const pricingMenu = document.getElementById('pricing-menu');
                
                console.log('📋 Bookings menu found:', !!bookingsMenu);
                console.log('⚙️ Settings menu found:', !!settingsMenu);
                console.log('💰 Pricing menu found:', !!pricingMenu);
                
                // Test toggle functionality
                if (settingsMenu) {
                    console.log('✅ Menu system ready');
                    updateTestResults('✅ Menu system initialized successfully');
                } else {
                    console.error('❌ Menu system failed to initialize');
                    updateTestResults('❌ Menu system failed to initialize');
                }
                
                // Initialize Meet and Greet when admin loads
                initializeMeetAndGreet();
            }, 500);
        });

        // Meet and Greet Location Management Functions
        let meetAndGreetLocations = {
            airports: [
                {
                    id: 'brussels-airport',
                    name: 'Brussels Airport (BRU)',
                    fullName: 'Brussels Airport',
                    code: 'BRU',
                    address: 'A201, 1930 Zaventem, Belgium',
                    enabled: true,
                    meetGreetEnabled: true,
                    pickupInstructions: 'Onze chauffeur wacht op u in de aankomsthal met een naambord. Locatie: bij de informatiebalie.'
                },
                {
                    id: 'charleroi-airport',
                    name: 'Brussels South Charleroi Airport (CRL)',
                    fullName: 'Brussels South Charleroi Airport',
                    code: 'CRL',
                    address: 'Rue des Frères Wright 8, 6041 Charleroi, Belgium',
                    enabled: true,
                    meetGreetEnabled: true,
                    pickupInstructions: 'Meet & Greet service beschikbaar in de aankomsthal. Onze chauffeur wacht bij de uitgang.'
                }
            ],
            stations: [
                {
                    id: 'brussels-central',
                    name: 'Brussels Central Station',
                    fullName: 'Gare Centrale / Centraal Station',
                    address: 'Carrefour de l\'Europe 2, 1000 Brussels, Belgium',
                    enabled: true,
                    meetGreetEnabled: true,
                    pickupInstructions: 'Onze chauffeur wacht bij de hoofdingang van het station.'
                }
            ],
            hotels: [
                {
                    id: 'hilton-brussels',
                    name: 'Hilton Brussels City',
                    fullName: 'Hilton Brussels City Hotel',
                    address: 'Place Eugène Flagey 20, 1050 Brussels, Belgium',
                    enabled: true,
                    meetGreetEnabled: true,
                    pickupInstructions: 'Onze chauffeur wacht in de lobby van het hotel.'
                }
            ]
        };

        function initializeMeetAndGreet() {
            // Load Meet and Greet settings from localStorage
            const savedLocations = localStorage.getItem('meetAndGreetLocations');
            if (savedLocations) {
                meetAndGreetLocations = JSON.parse(savedLocations);
            } else {
                // Save default locations to localStorage for first time use
                console.log('💾 No Meet & Greet locations found, saving defaults to localStorage');
                localStorage.setItem('meetAndGreetLocations', JSON.stringify(meetAndGreetLocations));
            }
            
            // Update Meet & Greet surcharge price from Item Surcharge
            updateMeetGreetSurchargeInfo();
            
            // Load locations when Meet and Greet section is shown
            if (document.getElementById('meet-and-greet-section')) {
                renderLocationTabs();
            }
        }

        function updateMeetGreetSurchargeInfo() {
            // Find Meet & Greet item in surchargeItems
            const meetGreetItem = surchargeItems.fixed.find(item => item.id === 'meet-greet');
            if (meetGreetItem) {
                const priceElement = document.getElementById('meetGreetSurchargePrice');
                const statusElement = document.getElementById('meetGreetSurchargeStatus');
                
                if (priceElement) {
                    priceElement.textContent = meetGreetItem.price.toFixed(2);
                }
                
                if (statusElement) {
                    if (meetGreetItem.enabled) {
                        statusElement.textContent = 'Actief';
                        statusElement.style.background = '#28a745';
                        statusElement.style.color = 'white';
                    } else {
                        statusElement.textContent = 'Uitgeschakeld';
                        statusElement.style.background = '#dc3545';
                        statusElement.style.color = 'white';
                    }
                }
            }
        }

        function switchLocationTab(type) {
            // Update tab appearance
            document.querySelectorAll('.location-tab').forEach(tab => {
                if (tab.dataset.type === type) {
                    tab.style.background = '#007bff';
                    tab.style.color = 'white';
                } else {
                    tab.style.background = '#6c757d';
                    tab.style.color = 'white';
                }
            });
            
            // Show/hide tab content
            document.querySelectorAll('.location-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(type + 'Tab').style.display = 'block';
            
            // Render locations for selected type
            renderLocations(type);
        }

        function renderLocationTabs() {
            // Default to airports tab
            switchLocationTab('airports');
        }

        function renderLocations(type) {
            const container = document.getElementById(type + 'List');
            const locations = meetAndGreetLocations[type] || [];
            
            if (locations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <div style="font-size: 48px; margin-bottom: 20px;">📍</div>
                        <p>Nog geen ${type === 'airports' ? 'luchthavens' : type === 'stations' ? 'stations' : 'hotels'} toegevoegd.</p>
                        <p style="font-size: 14px;">Klik op "+ Nieuwe ${type === 'airports' ? 'Luchthaven' : type === 'stations' ? 'Station' : 'Hotel'}" om te beginnen.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = locations.map((location, index) => `
                <div style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: ${location.enabled ? 'white' : '#f8f9fa'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <h5 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 16px;">
                                ${getLocationIcon(type)} ${location.name}
                            </h5>
                            <p style="margin: 0 0 5px 0; color: #6c757d; font-size: 14px;">${location.fullName}</p>
                            ${location.code ? `<span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: 600;">${location.code}</span>` : ''}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editLocation('${type}', ${index})" style="background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">✏️ Edit</button>
                            <button onclick="deleteLocation('${type}', ${index})" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">🗑️</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <p style="margin: 0; color: #495057; font-size: 14px;"><strong>Adres:</strong> ${location.address}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                            <input type="checkbox" ${location.meetGreetEnabled ? 'checked' : ''} onchange="toggleMeetGreet('${type}', ${index}, this.checked)">
                            <span>🤝 Meet & Greet service actief</span>
                        </label>
                    </div>
                    
                    ${location.meetGreetEnabled ? `
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; border-left: 4px solid #28a745;">
                        <h6 style="margin: 0 0 10px 0; color: #155724;">📝 Ophaalinstructies</h6>
                        <textarea onchange="updatePickupInstructions('${type}', ${index}, this.value)" 
                                  style="width: 100%; padding: 8px; border: 1px solid #c3e6cb; border-radius: 4px; resize: vertical; min-height: 60px; font-size: 13px;"
                                  placeholder="Beschrijf waar de klant opgehaald wordt...">${location.pickupInstructions || ''}</textarea>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function getLocationIcon(type) {
            switch(type) {
                case 'airports': return '✈️';
                case 'stations': return '🚉';
                case 'hotels': return '🏨';
                default: return '📍';
            }
        }

        function addNewLocation(type) {
            showAddLocationModal(type);
        }

        function showAddLocationModal(type) {
            const typeLabels = {
                'airports': 'Luchthaven',
                'stations': 'Station', 
                'hotels': 'Hotel'
            };
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #e9ecef; padding-bottom: 15px;">
                        <h3 style="margin: 0; color: #2c3e50; font-size: 24px;">
                            ${getLocationIcon(type)} Nieuwe ${typeLabels[type]} Toevoegen
                        </h3>
                        <button onclick="closeAddLocationModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d;">×</button>
                    </div>
                    
                    <form id="addLocationForm" onsubmit="submitNewLocation(event, '${type}')">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                📍 Naam van de ${typeLabels[type].toLowerCase()}:
                            </label>
                            <input type="text" id="locationName" required 
                                   placeholder="Bijv. Brussels Airport" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                🏠 Volledig adres:
                            </label>
                            <input type="text" id="locationAddress" required 
                                   placeholder="Bijv. A201, 1930 Zaventem, Belgium" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                        </div>
                        
                        ${type === 'airports' ? `
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                ✈️ Luchthaven code (optioneel):
                            </label>
                            <input type="text" id="locationCode" 
                                   placeholder="Bijv. BRU" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; text-transform: uppercase;" 
                                   maxlength="4">
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                📝 Ophaalinstructies:
                            </label>
                            <textarea id="locationInstructions" 
                                      placeholder="Bijv. Onze chauffeur wacht op u in de aankomsthal met een naambord."
                                      style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; min-height: 80px; resize: vertical;">${getDefaultPickupInstructions(type)}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 25px; background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="meetGreetEnabled" checked 
                                       style="margin-right: 10px; transform: scale(1.2);">
                                <span style="font-weight: 600; color: #155724;">
                                    🤝 Meet & Greet service inschakelen voor deze locatie
                                </span>
                            </label>
                            <p style="margin: 8px 0 0 0; font-size: 14px; color: #155724;">
                                Wanneer iemand boekt vanaf deze locatie wordt automatisch €5.00 Meet & Greet toeslag toegevoegd.
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 15px; justify-content: flex-end;">
                            <button type="button" onclick="closeAddLocationModal()" 
                                    style="padding: 12px 24px; border: 2px solid #6c757d; background: white; color: #6c757d; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                Annuleren
                            </button>
                            <button type="submit" 
                                    style="padding: 12px 24px; border: none; background: #28a745; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ${typeLabels[type]} Toevoegen
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('locationName').focus();
        }

        function closeAddLocationModal() {
            const modal = document.querySelector('[style*="position: fixed"][style*="z-index: 10000"]');
            if (modal) {
                modal.remove();
            }
        }

        function submitNewLocation(event, type) {
            event.preventDefault();
            
            const name = document.getElementById('locationName').value.trim();
            const address = document.getElementById('locationAddress').value.trim();
            const code = document.getElementById('locationCode')?.value.trim().toUpperCase() || '';
            const instructions = document.getElementById('locationInstructions').value.trim();
            const meetGreetEnabled = document.getElementById('meetGreetEnabled').checked;
            
            if (!name || !address) {
                alert('Naam en adres zijn verplicht.');
                return;
            }
            
            const newLocation = {
                id: name.toLowerCase().replace(/[^a-z0-9]/g, '-'),
                name: name,
                fullName: name,
                address: address,
                enabled: true,
                meetGreetEnabled: meetGreetEnabled,
                pickupInstructions: instructions || getDefaultPickupInstructions(type)
            };
            
            if (code) {
                newLocation.code = code;
            }
            
            if (!meetAndGreetLocations[type]) {
                meetAndGreetLocations[type] = [];
            }
            
            meetAndGreetLocations[type].push(newLocation);
            renderLocations(type);
            closeAddLocationModal();
            
            console.log(`✅ Nieuwe ${type} locatie toegevoegd:`, newLocation);
            
            // Show success message
            showNotification(`✅ ${newLocation.name} succesvol toegevoegd!`, 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: 600;
                max-width: 400px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        function getDefaultPickupInstructions(type) {
            switch(type) {
                case 'airports':
                    return 'Onze chauffeur wacht op u in de aankomsthal met een naambord.';
                case 'stations':
                    return 'Onze chauffeur wacht bij de hoofdingang van het station.';
                case 'hotels':
                    return 'Onze chauffeur wacht in de lobby van het hotel.';
                default:
                    return 'Onze chauffeur wacht op de afgesproken locatie.';
            }
        }

        function toggleMeetGreet(type, index, enabled) {
            meetAndGreetLocations[type][index].meetGreetEnabled = enabled;
            renderLocations(type);
            console.log(`🤝 Meet & Greet ${enabled ? 'ingeschakeld' : 'uitgeschakeld'} voor ${meetAndGreetLocations[type][index].name}`);
        }

        function updatePickupInstructions(type, index, instructions) {
            meetAndGreetLocations[type][index].pickupInstructions = instructions;
            console.log(`📝 Ophaalinstructies bijgewerkt voor ${meetAndGreetLocations[type][index].name}`);
        }

        function editLocation(type, index) {
            const location = meetAndGreetLocations[type][index];
            
            const newName = prompt('Naam:', location.name);
            if (newName === null) return;
            
            const newAddress = prompt('Adres:', location.address);
            if (newAddress === null) return;
            
            let newCode = location.code || '';
            if (type === 'airports') {
                newCode = prompt('Luchthaven code:', newCode) || '';
            }
            
            // Update location
            location.name = newName;
            location.fullName = newName;
            location.address = newAddress;
            if (newCode) {
                location.code = newCode.toUpperCase();
            }
            
            renderLocations(type);
            console.log(`✏️ Locatie bijgewerkt:`, location);
        }

        function deleteLocation(type, index) {
            const location = meetAndGreetLocations[type][index];
            if (confirm(`Weet je zeker dat je "${location.name}" wilt verwijderen?`)) {
                meetAndGreetLocations[type].splice(index, 1);
                renderLocations(type);
                console.log(`🗑️ Locatie verwijderd: ${location.name}`);
            }
        }

        function saveMeetAndGreetSettings() {
            try {
                // Save to localStorage
                localStorage.setItem('meetAndGreetLocations', JSON.stringify(meetAndGreetLocations));
                
                // Show success message
                const statusDiv = document.getElementById('meetGreetStatus');
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
                statusDiv.innerHTML = '✅ Meet & Greet instellingen succesvol opgeslagen!';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
                
                console.log('✅ Meet & Greet settings saved:', meetAndGreetLocations);
                
                // Update surcharge info
                updateMeetGreetSurchargeInfo();
                
            } catch (error) {
                console.error('❌ Failed to save Meet & Greet settings:', error);
                
                const statusDiv = document.getElementById('meetGreetStatus');
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
                statusDiv.innerHTML = '❌ Fout bij opslaan van instellingen: ' + error.message;
            }
        }

        // Function to check if a location requires Meet & Greet
        function checkMeetAndGreetRequired(fromLocation) {
            const allLocations = [
                ...meetAndGreetLocations.airports,
                ...meetAndGreetLocations.stations,
                ...meetAndGreetLocations.hotels
            ];
            
            // Check if the pickup location matches any registered Meet & Greet location
            for (const location of allLocations) {
                if (!location.enabled || !location.meetGreetEnabled) continue;
                
                // Simple text matching - in production you might want more sophisticated matching
                const locationNames = [
                    location.name.toLowerCase(),
                    location.fullName.toLowerCase(),
                    location.code?.toLowerCase()
                ].filter(Boolean);
                
                const fromLoc = fromLocation.toLowerCase();
                
                for (const locName of locationNames) {
                    if (fromLoc.includes(locName) || locName.includes(fromLoc)) {
                        return {
                            required: true,
                            location: location,
                            instructions: location.pickupInstructions
                        };
                    }
                }
            }
            
            return { required: false };
        }
    </script>
</body>
</html>